/* ==UserStyle==
@name           Dark Docs
@namespace      userstyles.world/user/winghongchan
@version        2023.06.24
@description    A new version of Dark Docs, made for Google Docs’ Material U redesign. 
@author         Walter winghongchan
@homepageURL    https://github.com/winghongchan/dark-docs
@supportURL     https://github.com/winghongchan/dark-docs/issues
@license        GPL-3.0-or-later
@preprocessor   less
@var            select document-filter "Document filter" {"none:None": "none", "dim:Dim": "contrast(80%) brightness(90%)", "invert:Invert*": "var(--darkfilter)"}
@var            number document-contrast "Document contrast while inverted" [76, 40, 100, 1, "%"]
@var            checkbox respect-pageless-document-color "Respect page color of pageless documents while a document filter is applied. May be laggy." 0
@var            checkbox has-selector-missing-warning "Warn me if the :has() selector is not available in my browser." 1
==/UserStyle== */

/* Dark Docs is licensed under the GNU GPL v3

Dark Docs: a Material You dark mode for Google Docs. 
Copyright (C) 2023 Walter <winghongchan> 

This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. 

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.

Read a copy of this license at https://www.gnu.org/licenses/gpl-3.0.html 
*/

/* Notice for Firefox (or LibreWolf, &c.) users
Dark Docs next uses the :has() selector, which is experimental on Firefox at the moment. To enable it, go to about:config and set layout.css.has-selector.enabled to true. Chromium‐based browsers have full support. 
Follow along with Mozilla’s development on the :has selector at https://bugzilla.mozilla.org/show_bug.cgi?id=418039 

If you are using an older version of Firefox (prior to version 113), you may not see some hover and focus effects because they rely on the color-mix() function to reduce the size of Dark Docs. To enable support for it, go to about:config and set layout.css.color-mix.enabled to true. Firefox 113 and newer has this enabled by default. 
*/

/* Notice for Chrome (or Vivaldi, Edge, &c.) users
Google Docs renders each page as a single <canvas> element, which may have made it impossible to un-invert images while using the Invert document filter in Dark Docs. If you need to view images un-inverted, open the Stylus extension, click on the cog beside “Dark Docs”, and change the Document filter to “Dim” or “None”.
*/
@-moz-document url-prefix("https://docs.google.com/document/d/"), url-prefix("https://docs.google.com/document/u/"), regexp("https:\\/\\/docs\\.google\\.com\\/sharing\\/boq\\/driveshare\\?[\\s\\S]+origin=https%3A%2F%2Fdocs\\.google\\.com"), url-prefix("https://docs.google.com/picker/v2/home?req=%5B%22ireq%22%2C%5Bnull%2C%5B%5B1%5D%2C%5B%5D%2C%5B%5D%2C%5B%5D%2C%"), url-prefix("https://docs.google.com/picker/v2/home?req=%5B%22ireq%22%2C%5Bnull%2C%5B%5B1%2C6%5D%2C%5B%5D%2C%5B%5D%2C%5B%5D%2C%5B2048%2C2048%5D%5D%2C%5B1%5D%2Cnull%2Cnull%2C%5B"), regexp("https:\\/\\/docs\\.google\\.com\\/picker\\/v2\\/home\\?req=.*%22Google%20Drive%22.*%22Replace%22.*%22replace-image%22.*&parent=https%3A%2F%2Fdocs\\.google\\.com&pfname=&rpctoken=[0-9]+"), regexp("(https:\\/\\/meet.google.com\\/_\\/frame\\?authUser=\\d+&frameType=2&origin=https%3A%2F%2Fdocs.google.com#cb=pip_frame)"), regexp("https:\\/\\/docs\\.google\\.com\\/picker\\/v2\\/home\\?req=.*%22explore-drive.*&parent=https%3A%2F%2Fdocs\\.google\\.com&pfname=&rpctoken=[0-9]+"), regexp("https:\\/\\/docs\\.google\\.com\\/picker\\/v2\\/home\\?req=.*%22Google%20Photos%22.*&parent=https%3A%2F%2Fdocs\\.google\\.com&pfname=&rpctoken=[0-9]+") {
// Variables
  :root {
    
    // Colour
    --ddocs-primary: #a8c7fa;
    --ddocs-primary-icon: invert(100%) hue-rotate(180deg) brightness(75%) saturate(400%);
    --ddocs-primary-hover: rgba(168, 199, 250, var(--ddocs-hover-state-layer-opacity)); // That’s right, standard (no fill or outline) icon buttons, when enabled (selected) and hovered, use a state layer of colour primary! Not on-primary-container or something. https://m3.material.io/components/icon-buttons/specs
    --ddocs-primary-focus: rgba(168, 199, 250, var(--ddocs-focus-state-layer-opacity));
    --ddocs-primary-pressed: rgba(168, 199, 250, var(--ddocs-pressed-state-layer-opacity));
    --ddocs-on-primary: #062e6f;
    --ddocs-on-primary-hover: #9bbaef;
    --ddocs-on-primary-focus: #94b4e9;
    --ddocs-on-primary-pressed: #94b4e9;
    --ddocs-primary-container: #004a77;
    --ddocs-on-primary-container: #c2e7ff;
    --ddocs-on-primary-container-icon: invert(100%) hue-rotate(180deg) saturate(150%);
    --ddocs-on-primary-container-hover: #0f5682;
    --ddocs-on-primary-container-focus: #185d88;
    --ddocs-on-primary-container-pressed: #185d88;
    --ddocs-secondary: #7fcfff;
    --ddocs-on-secondary: #003355;
    --ddocs-secondary-container: #0842a0;
    --ddocs-secondary-container-hover: #184fa8; // Determined the colour by overlapping the -on colour at 8% opacity on top of the container. Not a problem until Dark Docs begins support for custom colours. 
    --ddocs-secondary-container-focus: #2156ac;
    --ddocs-on-secondary-container: #d3e3fd;
    --ddocs-on-secondary-container-hover: rgba(211, 227, 253, var(--ddocs-hover-state-layer-opacity));
    --ddocs-on-secondary-container-focus: rgba(211, 227, 253, var(--ddocs-focus-state-layer-opacity));
    --ddocs-on-secondary-container-pressed: rgba(211, 227, 253, var(--ddocs-pressed-state-layer-opacity));
    --ddocs-tertiary: #6dd58c;
    --ddocs-on-tertiary: #0a3818;
    --ddocs-on-tertiary-hover: #64c882;
    --ddocs-on-tertiary-focus: #61c27e;
    --ddocs-on-tertiary-pressed: #61c27e;
    --ddocs-tertiary-container: #0f5223;
    --ddocs-on-tertiary-container: #c4eed0;
    --ddocs-error: #f2b8b5;
    --ddocs-on-error: #601410;
    --ddocs-error-container: #8C1D18;
    --ddocs-on-error-container: #F9DEDC;
    --ddocs-background: #1f1f1f;
    --ddocs-on-background: #e3e3e3;
    --ddocs-on-background-hover: rgba(227, 227, 227, var(--ddocs-hover-state-layer-opacity)); // Just the state layer.
    --ddocs-on-background-focus: rgba(227, 227, 227, var(--ddocs-focus-state-layer-opacity));
    --ddocs-on-background-pressed: rgba(227, 227, 227, var(--ddocs-pressed-state-layer-opacity));
    --ddocs-surface: #1f1f1f;
    --ddocs-surface-container-low: #28282a; // I’m stealing these from screenshots, so I don’t know the actual surface tint. (I tried to find it.)
    --ddocs-surface-container: #2d2e31;
    --ddocs-surface-container-high: #313336;
    --ddocs-on-surface: #e3e3e3;
    --ddocs-on-surface-disabled: rgba(227, 227, 227, 12%); 
    --ddocs-on-surface-hover: rgba(227, 227, 227, var(--ddocs-hover-state-layer-opacity)); 
    --ddocs-on-surface-focus: rgba(227, 227, 227, var(--ddocs-focus-state-layer-opacity)); 
    --ddocs-on-surface-pressed: rgba(227, 227, 227, var(--ddocs-pressed-state-layer-opacity)); 
    --ddocs-surface-container-highest: #444746; 
    --ddocs-on-surface-variant: #c4c7c5; 
    --ddocs-on-surface-variant-hover: rgba(196, 199, 197, var(--ddocs-hover-state-layer-opacity));
    --ddocs-on-surface-variant-focus: rgba(196, 199, 197, var(--ddocs-focus-state-layer-opacity));
    --ddocs-on-surface-variant-pressed: rgba(196, 199, 197, var(--ddocs-pressed-state-layer-opacity));
    --ddocs-outline: #8e918f;
    --ddocs-outline-variant: #444746;
    --ddocs-inverse-surface: #e3e3e3; // inverse colours taken from the “Signed in as” bar. Might be a relic of m2
    --ddocs-inverse-on-surface: #3c4043;
    --ddocs-inverse-on-surface-hover: #d5d6d6;
    --ddocs-inverse-on-surface-focus: #cfcfd0;
    --ddocs-inverse-on-surface-pressed: #cfcfd0;
    --ddocs-surface-tint: #6750A4; // Definitely not this.
    
    // State layers (a translucent overlay is placed over things that are hovered, focused, &c.)
    --ddocs-hover-state-layer-opacity: 8%;
    --ddocs-focus-state-layer-opacity: 12%;
    --ddocs-pressed-state-layer-opacity: 12%;
    --ddocs-dragged-state-layer-opacity: 16%;
    
    // Shape
    --ddocs-corner-none: 0rem;
    --ddocs-corner-xs: 0.25rem;
    --ddocs-corner-s: 0.5rem;
    --ddocs-corner-m: 0.75rem;
    --ddocs-corner-l: 1rem;
    --ddocs-corner-xl: 1.75rem;
    
    // Shadow
    --ddocs-level2: 0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);
    
    --paleblue-icons: hue-rotate(3.6deg) saturate(32.2%) brightness(170%); /* To desaturate blue icons to make them more legible against a dark background. If it is an inline SVG, changing its fill color to palerblue is preferable. */
    --palegreen-icons: hue-rotate(-2deg) saturate(38%) brightness(182%);
    --white-icons: brightness(280%) saturate(10%);
    --whiter-icons: brightness(325%);
    --darkfilter: invert(100%) hue-rotate(180deg) contrast(@document-contrast);
    --on: background-color 0.02s ease-in, border-color 0.06s ease, color 0.05s ease, filter 0.01s ease;
    --off: background-color 0.25s ease, border-color 0.1s ease, color 0.25s ease, filter 0.25s ease;
    
    // Dark Docs m2 variables (will be removed once side panels and the homepage get Material U’d)
    --palerblue: #8AB4F8; /* For blue text, icons, nearby items that need to be paleblue, and paleblue buttons on hover. */
    --paleblue: #669DF7; /* For blue buttons and other wider areas of paleblue. */
    --blue-ripple: #394457; /* Background color to indicate that something is active (toggled on or being clicked, for example). */
    --palergreen: #81C995; /* Mostly for suggesting mode. */
    --green-ripple: #37493F;
    --paleyellow: #FDD663; /* Mostly for comments. */
    --yellow-ripple: #454134;
    --lightestgray: #F8F9FA; /* For most text. */
    --lightergray: #DADCE0; 
    --lightgray: #BDC1C6; /* For subtext that gives more info, like a placeholder, an email below a name, or a description under an option. */
    --gray: #5F6368;
    --mediumdarkgray: #4A4E51; /* Hover state on menus. */
    --darkgray: #3C4043; /* Multiple purposes, like outlining dialog boxes to make them separate from what's behind them, or menus. */
    --darkergray: #303235; /* A hover state. */
    --darkestgray: #202124; /* For backgrounds. */
    
    /* Note to self: https://m3.material.io/foundations/interaction-states The state layer is an overlay with a fixed opacity for each state and uses the same color as the content. … components using the activated or selected states change the container and content color directly. 
    “The default for modern web browsers is 16px, so the conversion is SP_SIZE/16 = rem.” https://m3.material.io/styles/typography/type-scale-tokens So, 1rem = 16px font size. */
  }
}

.states() {
  transition: var(--off);
  &:is(.jfk-button-hover) {
    background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-hover-state-layer-opacity)));
    transition: var(--on);
  }
  &:is(.jfk-button-focused) {
    background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-focus-state-layer-opacity)));
  }
  &:is(.jfk-button-active) {
    background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-pressed-state-layer-opacity)));
  }
}

@-moz-document url-prefix("https://docs.google.com/document/d/"), url-prefix("https://docs.google.com/sharing/driveshare"), url-prefix("https://docs.google.com/document/u/") {
/* Basic elements */

  body {
    background-color: var(--darkestgray);
    color: var(--lightestgray);
  }

  /* Scrollbar */
  .docs-gm ::-webkit-scrollbar-thumb {
    background-color: var(--lightgray);
  }
}

.emoji-picker() {
  & .docsEmojisWizEmojiPickerTab {
    background-color: var(--ddocs-surface-container);
  }

  & .appsElementsEmojipickerSearchBar {
    background-color: var(--ddocs-surface-container-highest);
    border-color: $background-color;
    transition: var(--off);
    &:hover {
      border-color: var(--ddocs-outline);
      transition: var(--on);
    }
    &:focus-within {
      border-color: var(--ddocs-primary);
      box-shadow: inset 0 0 0 1px var(--ddocs-primary);
    }
    
    & .appsElementsEmojipickerSearchIcon {
      --icon-color: var(--ddocs-on-surface);
    }
    
    & .appsElementsEmojipickerSearchInput {
      background: none;
      color: var(--ddocs-on-surface);
      &::placeholder {
        color: var(--ddocs-on-surface-variant);
        opacity: 1;
      }
    }
  }

  & ul.appsElementsEmojipickerCategoryBar {
    border-bottom: 1px solid var(--ddocs-outline-variant);
    margin: 0;

    &>li {
      color: var(--ddocs-on-surface-variant);
      &.isSelected {
        color: var(--ddocs-primary);
      }
      
      & button {
        --mdc-ripple-color: currentColor;
        & svg {
          fill: currentColor;
        }
      }
      
      & .appsElementsEmojipickerCategorySelectedUnderline {
        background-color: currentColor;
      }
    }
  }

  & .appsElementsEmojipickerListNoContentMessage, 
  & .appsElementsEmojipickerListLabelRow {
    color: var(--ddocs-on-surface-variant);
  }

  & .appsElementsEmojipickerListEmojibuttonButton {
    --mdc-ripple-color: var(--ddocs-on-surface-variant);
    transition: var(--off);
    &:hover {
      background-color: var(--ddocs-on-surface-variant-hover);
      transition: var(--on);
    }
  }
  & .appsElementsEmojipickerListUnicodeAlternateTriggerButton::after {
    border-bottom-color: var(--ddocs-on-surface-variant);
  }

  & .appsElementsEmojipickerListAlternatepickerAlternateContainer {
    background-color: var(--ddocs-surface-container-highest);
  }
  & .appsElementsEmojipickerQuickEmojisSection .appsElementsEmojipickerQuickEmojisContainer {
    border-top: 1px solid var(--ddocs-outline-variant);
  }
}

@-moz-document url-prefix("https://docs.google.com/document/u/") {
// Homepage 
  
    .menu(@background-color: darkestgray) /* Dropdown menus */ {
    background: if(@background-color = darkergray, var(--darkgray), var(--darkergray));
    border: none;
    box-shadow: 0 2px 6px 2px rgba(0,0,0,.25);
    scrollbar-color: var(--gray) transparent;
    
    // Background colour change for hover and click
    &>.goog-menuitem {
      transition: var(--off);
      
      &.goog-menuitem-highlight {
        background-color: rgba(255, 255, 255, 4%);
        transition: var(--on);
      }
      &.goog-menuitem-active:not(.goog-submenu:not(.goog-option)) /* Double negative! In this case it’s because there are some menu items that can be clicked, like the items in the styles menu, which are marked with .goog-option. */ {
        background-color: rgba(255, 255, 255, 10%);
      }
    }
    
    // Menu item content
    &>.goog-menuitem>.goog-menuitem-content {
      &>.goog-menuitem-icon:has(div:not(.docs-icon-editors-ia-article-document-blue):not(.docs-icon-editors-ia-apps-script):not(.docs-icon-editors-ia-spreadsheet-green):not(.docs-icon-editors-ia-edit-pen-blue700):not(.docs-icon-editors-ia-comment-edit-green700)) {
        filter: var(--white-icons);
      }
      &>.goog-menuitem-label, 
      &>span /* Needed >span because File→Language submenu is weird */, 
      & /* The zoom menu (left of the styles menu) and font size menu puts text directly into .goog-menuitem-content */ {
        color: var(--lightestgray);
      }
      &>.goog-menuitem-accel /* Keyboard shortcut */ {
        color: var(--lightgray);
        font-weight: lighter;
      }
      &>.goog-submenu-arrow /* Arrows indicating nested menus */ {
        color: var(--lightgray);
        opacity: 100%;
      }
    }
    &>.goog-menuitem.goog-menuitem-disabled {
      opacity: 38%;
      
      &>.goog-menuitem-content>.goog-menuitem-icon {
        opacity: 100%; // Didn’t want opacities to compound and make the icons extra transparent
      }
    }
    &>.apps-hoverable-menu-separator-container>.apps-hoverable-menu-separator-bottom, 
    &>.goog-menuseparator /* Dividers */ {
      border-top-color: var(--mediumdarkgray);
    }
    
    // A bit of eye candy? Moves the arrow that indicates a submenu to the right when the menu opens.
    &>.goog-menuitem.goog-submenu-open.goog-submenu:not(.goog-menuitem-disabled) .goog-submenu-arrow {
      color: var(--lightestgray);
      transform: translateX(5px);
      transition: color 0.3s, transform 0.3s;
    }
  }
  
  @media (prefers-reduced-motion) {
    .goog-menuitem.goog-submenu-open.goog-submenu:not(.goog-menuitem-disabled) .goog-submenu-arrow {
      transform: none !important;
    }
  }

  html, body {
    background-color: var(--darkestgray);
    scrollbar-color: var(--gray) transparent;
  }

  body::-webkit-scrollbar-track-piece {
    background-color: var(--darkestgray);
  }
  ::-webkit-scrollbar-thumb {
    background-color: var(--gray);
    box-shadow: none !important;
  }
  ::-webkit-scrollbar-thumb:hover {
    background-color: var(--lightgray);
  }
  ::-webkit-scrollbar-thumb:active {
    background-color: var(--paleblue);
  }

  /* Header */
  header {
    background-color: var(--darkestgray) !important;
    
    div[role="button"]:has(path[d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"]) svg /* Main menu button */, 
    form#aso_search_form_anchor svg:has(path[d="M20.49,19l-5.73-5.73C15.53,12.2,16,10.91,16,9.5C16,5.91,13.09,3,9.5,3S3,5.91,3,9.5C3,13.09,5.91,16,9.5,16 c1.41,0,2.7-0.47,3.77-1.24L19,20.49L20.49,19z M5,9.5C5,7.01,7.01,5,9.5,5S14,7.01,14,9.5S11.99,14,9.5,14S5,11.99,5,9.5z"], path[d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"]) /* Search and × icon */ {
      color: var(--lightergray);
    }
    
    & a[href^="https://docs.google.com/document/"]>img[srcset="https://www.gstatic.com/images/branding/product/1x/docs_2020q4_48dp.png 1x, https://www.gstatic.com/images/branding/product/2x/docs_2020q4_48dp.png 2x "]+span /* “Docs” */ {
      color: var(--lightestgray);
    }
    
    form#aso_search_form_anchor svg[fill="#808080"]:has(path[d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"]) /* Search result magnifying glass icon */ {
      fill: var(--lightergray);
    }
  }

  .gb_Se.gb_Te button svg /* 🔍 and × when search field is in focus */,
  .gb_4d.gb_1c, .gb_cd .gb_Md, .gb_cd .gb_Nd /* “Docs” */{
    color: var(--lightergray);
  }
    
  .gb_Hc svg /* Menu button */ {
    fill: var(--lightestgray);
  }

  header form[role="search"] /* Search bar */ {
    background-color: var(--darkergray);
    transition: var(--off);
    
    &:focus-within /* Active search bar */ {
      background-color: var(--darkgray);
      box-shadow: none;
      transition: var(--on);
      
      & button svg {
        color: var(--lightergray);
      }
    }
    
    & button.gb_7e.gb_9e svg,
    & button.gb_uf.gb_wf svg /* 🗙 icon */, 
    & button.gb_4e.gb_5e svg,
    & button.gb_rf.gb_sf svg /* 🔍 icon */ {
      fill: var(--lightgray);
    }
    
    & input {
      caret-color: var(--palerblue);
      color: var(--lightestgray) !important;
      &::placeholder {
        color: var(--lightgray) !important;
        opacity: 100%;
      }
    }
  }

  td.gssb_e /* Search suggestions box */,
  .docs-homescreen-search-ac-renderer {
    background-color: var(--darkergray);
    border-color: var(--gray);
    box-shadow: none;
    
    & .docs-homescreen-search-ac-row {
      border-left-color: transparent;
    }
    & .docs-homescreen-search-ac-active {
      background-color: var(--darkgray);
    }
  }
  table.gssb_m /* Search suggestions area inside box, which excludes the bottom edge which serves as “padding” */ {
    background: none;
    color: var(--lightestgray);
  }
  .ASO_SUGGESTIONS_CONTAINER tr /* Search results */ {
    transition: var(--off);
  }
  .asor.asor_i5 /* Recent item icon */ {
    filter: invert(100%);
    opacity: 100%;
  }
  .ASO_SUGGESTIONS_CONTAINER tr.gssb_i.ASO_SUGGESTION_HIGHLIGHTED /* Highlighted search result */ {
    background-color: var(--darkgray);
    transition: var(--on);
  }
  tr[role="separator"] .gssb_l /* Line between recent terms and search results */ {
    background-color: var(--mediumdarkgray);
  }
  .gstq_c /* Email address if search term matches it */,
  .asor_e /* Owner of file in search result */ {
    color: var(--lightgray);
    font-family: Roboto, sans-serif;
  }
  .gsan_a /* No results message */ {
    color: var(--lightgray);
  }

  .gb_Re /* Account and apps area */ {
    background: none;
  }
  a[href="https://www.google.ca/intl/en/about/products"] svg path /* Apps waffle */ {
    fill: var(--lightergray);
  }
  :is(.gb_ia, .gb_Ba) /* Google Workspace organization logo box */ {
    background-color: var(--darkestgray);
    border-color: var(--darkgray);
    transition: var(--off);
    &:hover {
      background-color: var(--darkergray);
      border-color: var(--darkgray);
      transition: var(--on);
    }
    &:focus, 
    &[aria-expanded="true"] {
      background-color: var(--darkgray);
    }
  }

  /* Left side menu */
  .goog-menu.docs-homescreen-leftmenu {
    background-color: var(--darkergray);
  }
  .docs-homescreen-nav-google-logo::before /* Google logo */ {
    filter: brightness(500%) saturate(0%);
  }
  .docs-homescreen-leftmenu-material-menu-header-text /* “Docs” */ {
    color: var(--lightestgray);
    padding-left: 6px;
  }
  .docs-homescreen-leftmenu-menuseparator /* Separators */ {
    border-color: var(--gray);
  }
  .docs-homescreen-leftmenu-menuitem /* Menu items */ {
    & .docs-homescreen-leftmenu-menuitem-text {
      color: var(--lightestgray);
    }
    &.goog-menuitem-highlight {
      background-color: var(--mediumdarkgray);
      .docs-homescreen-leftmenu-menuitem-text {
        color: var(--lightestgray);
      }
    }
  }
  .docs-homescreen-leftmenu {
    & .docs-homescreen-gear-24, 
    & .docs-homescreen-help-outline-24 {
      filter: var(--white-icons);
    }
  }
  .docs-homescreen-leftmenu-tos-links-container {
    & .ogb-link {
      color: var(--lightgray);
      text-decoration: underline;
      text-decoration-color: transparent;
      transition: var(--off), 0.2s text-decoration-color ease;
    }
    & .ogb-link:hover {
      color: var(--lightestgray);
      text-decoration: underline;
      transition: var(--on), 0.15s text-decoration-color ease;
    }
    & span {
      color: var(--lightgray);
      user-select: none;
    }
  }

  /* Template gallery */
  .docs-homescreen-templates-bar /* “Templates” title bar, shown when template gallery is expanded */ {
    background-color: var(--darkestgray);
  }
  .docs-homescreen-templates-bar-header {
    color: var(--lightestgray);
  }

  .docs-hs-tmp-expandedcontentholder-tabbarrow /* Templates gallery tabbar (shown for organizations) */ {
    background-color: var(--darkestgray);
    
    & .docs-tabbar-tab {
      color: var(--lightgray);
      &-selected {
        color: var(--palerblue) !important;
      }
      
      & .docs-tabbar-tablabel {
        color: currentColor !important;
      }
      &::before {
        border-top-color: currentColor;
      }
    }
  }

  .docs-homescreen-fcc-content /* Template gallery background */ {
    background-color: var(--darkergray);
  }

  .docs-hs-tmp-contractedheader-text /* “Start a new document ” */ {
    color: var(--lightestgray);
  }

  .docs-hs-tmp-sc-showcase .docs-homescreen-grid-header-title.docs-homescreen-grid-header-title, /* “Recently used” */
  .docs-hs-tmp-sc-default .docs-homescreen-grid-header-title.docs-homescreen-grid-header-title /* Other template group titles */ {
    background-color: transparent;
    color: var(--lightestgray);
  }
  .jfk-button.docs-hs-tmp-contractedheader-more /* “Template gallery” button */ {
    background-color: transparent;
    color: var(--lightestgray);
    transition: var(--off);
    &.jfk-button-hover, 
    &.jfk-button-focused {
      background-color: var(--darkgray);
      transition: var(--on);
    }
    &.jfk-button-active {
      background-color: var(--blue-ripple);
    }
    &+.docs-hs-tmp-contractedheader-separator {
      border-color: var(--gray);
      transition: 3s border-color ease;
    }
    &.jfk-button-hover, 
    &.jfk-button-focused,
    &.jfk-button-active {
      &+.docs-hs-tmp-contractedheader-separator {
        border-color: transparent;
        transition: var(--on);
      }
    }
  }
  .docs-hs-tmp-contractedheader-actions .docs-homescreen-icon /* Template gallery button icons */ {
    filter: var(--white-icons);
  }
  .goog-menu-button.docs-hs-tmp-contractedheader-overflow /* Template gallery overflow menu */ {
    transition: var(--off);
  }
  .goog-menu-button-hover.docs-hs-tmp-contractedheader-overflow,
  .goog-menu-button-focused.docs-hs-tmp-contractedheader-overflow {
    background-color: var(--darkgray);
    transition: var(--on);
  }
  .goog-menu-button-open.docs-hs-tmp-contractedheader-overflow {
    background-color: var(--blue-ripple);
  }
  .docs-hs-tmp-contractedheader-actions .goog-menu-button-open .docs-homescreen-icon {
    filter: var(--paleblue-icons);
  }
  
  .docs-hs-tmp-contractedheader-actions>.docs-hs-tmp-contractedheader-overflow+.jfk-bubble /* Template gallery overflow menu */ {
    background-color: var(--darkgray);
    box-shadow: rgba(0,0,0,.2) 0px 1px 3px;
    
    & .goog-menuitem {
      color: var(--lightestgray);
      transition: var(--off);
      &.goog-menuitem-highlight {
        background-color: var(--ddocs-on-surface-hover);
        transition: var(--on);
        &>.goog-menuitem-content {
          color: var(--lightestgray);
        }
      }
      &.goog-menuitem-active {
        background-color: var(--ddocs-on-surface-pressed);
      }
    }
  }

  /* OPENED TEMPLATE GALLERY */
  
  .docs-homescreen-templates-bar-back /* Back button */ {
    transition: var(--off);
    & .docs-homescreen-back-grey700-24 {
      filter: var(--white-icons);
    }
    &.jfk-button-hover, 
    &.jfk-button-focused {
      background-color: var(--darkgray);
      transition: var(--on);
    }
    &.jfk-button-active {
      background-color: var(--blue-ripple);
    }
  }
  .docs-hs-tmp-emptydomaingallery-image /* No templates empty state */ {
    display: none; /* sorry I couldn’t darken this empty state photo nicely */
  }
  .docs-hs-tmp-emptydomaingallery-header {
    color: var(--lightestgray);
  }
  .docs-hs-tmp-emptydomaingallery-msg {
    color: var(--lightergray);
  }
  .docs-hs-tmp-submitbutton-embossed /* “Submit template” button */ {
    background-color: transparent;
    border: 1px solid var(--mediumdarkgray);
    border-radius: 4px;
    box-shadow: none;
    transition: var(--off);
  }
  .docs-hs-tmp-submitbutton-embossed.docs-hs-tmp-submitbutton-embossed-hover {
    background-color: var(--mediumdarkgray);
    transition: var(--on);
  }
  .docs-hs-tmp-submitbutton-embossed.docs-hs-tmp-submitbutton-embossed-active {
    background-color: var(--blue-ripple);
    border-color: var(--blue-ripple);
  }
  .docs-hs-tmp-submitbutton-icon {
    filter: var(--paleblue-icons);
  }
  .docs-hs-tmp-submitbutton-label {
    color: var(--palerblue);
  }

  .docs-homescreen-templates-templateview-preview /* Template thumbnail */ {
    background-color: var(--mediumdarkgray);
    border-color: var(--mediumdarkgray);
    transition: var(--off);
  }
  .docs-homescreen-templates-templateview-preview:hover {
    border-color: var(--gray);
    transition: var(--on);
  }
  .goog-control-active .docs-homescreen-templates-templateview-preview {
    border-color: var(--paleblue);
    transition: var(--on);
  }
  .docs-homescreen-templates-templateview-preview img /* Template preview image */ {
    filter: opacity(75%) contrast(80%);
    transition: filter 0.5s ease;
  }
  .docs-homescreen-templates-templateview-preview img:hover {
    filter: none;
    transition: filter 0.25s ease;
  }

  .docs-homescreen-templates-templateview-title /* Template names */ {
    color: var(--lightestgray);
  }
  .docs-homescreen-templates-templateview-brandauthor,
  .docs-homescreen-templates-templateview-style /* Template info */ {
    color: var(--lightergray);
    font-weight: 400;
  }
  .docs-homescreen-templates-templateview-addon /* “Add-on” badge */ {
    background-color: var(--paleblue);
    color: var(--darkestgray);
  }

  /* RECENT DOCUMENTS LIST */
  
  .docs-homescreen-container /* Homepage background */ {
    background-color: transparent;
  }
  .docs-homescreen-floater-header, /* “Recent documents” and sorting buttons bar */
  .docs-homescreen-grid-header, .docs-homescreen-list-header {
    background-color: var(--darkestgray);
  }
  .docs-homescreen-floater-header-shadow,
  .docs-homescreen-floater-header-shadow>.docs-homescreen-floater-header /* Sorting buttons bar, but once the view is scrolled enough */ {
    background-color: var(--darkergray);
    box-shadow: none;
  }
  .docs-homescreen-floater-header /* “Recent documents” */ {
    color: var(--lightestgray);
  }
  .docs-homescreen-owner-filter-button /* “Owned by…” */ {
    background-color: transparent;
    color: var(--lightestgray);
    transition: var(--off);
    & .docs-homescreen-dropdown-arrow-24::before {
      filter: var(--white-icons);
    }
    &.goog-menu-button-hover, 
    &.goog-menu-button-focused {
      background-color: var(--darkgray);
      transition: var(--on);
    }
    &.goog-menu-button-hover {
      cursor: pointer /* The whole button is clickable, but the cursor only changes to a pointer when hovering over the text or triangle. This fixes that. */ ;
    }
    &.goog-menu-button-open {
      background-color: var(--blue-ripple);
    }
    &+.docsshared-menu-bubble {
      background: none;
      box-shadow: none;
      
      .goog-menu {
        .menu();
        
        & .goog-option-selected .goog-menuitem-checkbox {
          filter: invert(100%);
        }
      }
    }
  }

  .docs-homescreen-floater-header-buttons .docs-homescreen-editorbar-actionbutton /* Grid/list, sort, open */ {
    & .docs-homescreen-img {
      filter: var(--white-icons);
    }
    &.jfk-button-hover::before,
    &.jfk-button-focused::before, 
    &.goog-menu-button-hover::before, 
    &.goog-menu-button-focused::before {
      background-color: var(--darkgray); 
    }
    &.jfk-button-active::before, 
    &.goog-menu-button-open::before {
      background-color: var(--blue-ripple);
    }
    &.jfk-button-active .docs-homescreen-img {
      filter: brightness(500%) saturate(0%);
    }
    &.goog-menu-button-open .docs-homescreen-img {
      filter: var(--paleblue-icons);
    }
  }
  .docs-homescreen-editorbar-actionbutton+.docsshared-menu-bubble {
    background: none;
    box-shadow: none;
    
    & .goog-menu {
      .menu();
      
      & .goog-option-selected .goog-menuitem-checkbox {
        filter: invert(100%);
      }
    }
  }

  /* Empty state */
  .docs-homescreen-empty-section-notice {
    background-color: transparent;
    box-shadow: none;
  }
  .docs-homescreen-empty-section-new-user-notice-heading {
    color: var(--lightestgray);
  }
  .docs-homescreen-empty-section-notice-message {
    color: var(--lightgray);
  }

  /* Thumbnail view */
  .docs-homescreen-grid-item {
    background-color: var(--darkestgray);
    border-color: var(--darkgray);
    transition: var(--off);
  }
  .docs-homescreen-grid-item.goog-control-hover {
    background-color: var(--darkgray);
    border-color: var(--gray);
    transition: var(--on);
  }
  .docs-homescreen-grid-item.goog-control-focused {
    background-color: var(--darkgray);
    border-color: var(--paleblue);
    transition: var(--on);
  }
  .docs-homescreen-grid-item.goog-control-active {
    background-color: var(--blue-ripple);
    border-color: var(--paleblue);
    transition: var(--on);
  }
  .docs-homescreen-grid-item-thumbnail {
    filter: invert(100%) hue-rotate(180deg) contrast(80%);
  }
  .docs-homescreen-grid-item-metadata-container /* Textbox below thumbnails */ {
    background-color: transparent;
    border-color: var(--darkgray);
  }
  .docs-homescreen-grid-item-title {
    color: var(--lightestgray);
  }
  .docs-homescreen-grid-item .docs-homescreen-grid-item-shared-icon .docs-homescreen-img, /* Icon for shared items */
  .docs-homescreen-grid-item .docs-homescreen-item-overflow .docs-homescreen-img /* More options (kebab) */ {
    filter: brightness(165%) saturate(70%);
  }
  .docs-homescreen-grid-item-time-container {
    color: var(--lightgray);
  }

  /* File options menu */
  .docs-homescreen-item-overflow /* Menu button */ {
    transition: var(--off);
  }
  .docs-homescreen-item-overflow:hover,
  .docs-homescreen-item-overflow:focus {
    background-color: var(--gray);
    transition: var(--on);
  }
  .docs-homescreen-grid-item>.docsshared-menu-bubble {
    background-color: transparent;
    box-shadow: none;
    
    & .docs-homescreen-iconmenu {
      .menu();
      
      & .docs-homescreen-icon>.docs-homescreen-img::before {
        filter: var(--white-icons);
      }
    }
  }

  /* List view */
  .docs-homescreen-list-item /* Each row */ {
    background-color: transparent;
    border-color: var(--darkgray);
    border-radius: 0;
    color: var(--lightestgray);
    transition: var(--off);
  }
  .docs-homescreen-list-item.goog-control-hover, .docs-homescreen-list-item.goog-control-focus {
    background-color: var(--darkgray);
    border-color: transparent;
    border-radius: 0;
    outline: none;
    transition: var(--on);
  }
  .docs-homescreen-list-item.goog-control-active {
    background-color: var(--blue-ripple);
    transition: var(--on);
  }
  .docs-homescreen-list-item-icon /* Filetype icon */ {
    border-color: transparent;
  }
  .docs-homescreen-list-item-owner,
  .docs-homescreen-list-item-time /* File details */ {
    color: var(--lightgray);
  }
  .docs-homescreen-list-item .docs-homescreen-list-item-shared-icon .docs-homescreen-img, /* Icon for shared items */
  .docs-homescreen-list-item .docs-homescreen-item-overflow .docs-homescreen-img /* More options (kebab) */ {
    filter: brightness(165%) saturate(70%);
  }

  .docs-homescreen-fab /* The round button in the corner that appears when you scroll down */ {
    background-color: var(--darkgray);
    transition: var(--off);
  }
  .docs-homescreen-fab.jfk-button-hover,
  .docs-homescreen-fab.jfk-button-focused {
    background-color: var(--mediumdarkgray);
    transition: var(--on);
  }
  .docs-homescreen-fab.jfk-button-active {
    background-color: var(--blue-ripple);
  }
  .docsHomescreenUiWizfabbuttonMenuItemFab /* Same button, when the template gallery is set to not show */, 
  .docsHomescreenUiWizfabbuttonMenuButtonFab {
    background-color: var(--darkgray);
    transition: var(--off);
    &:hover, :focus {
      background-color: var(--gray);
      transition: var(--on);
    }
    & .docs-homescreen-edit-pencil-outline-24, .docs-homescreen-template-24 {
      filter: var(--paleblue-icons);
    }
  }
  .quantumWizButtonFloatingactionbuttonHoverOverlay /* FAB overlay that makes it brighter on hover than I set it */ {
    visibility: hidden;
  }
  
  .docs-homescreen-settings-dialog.docs-homescreen-modaldialog {
    background-color: var(--darkergray);
    
    &>.modal-dialog-title {
      background: none;
      color: var(--lightestgray);
    }
    
    &>.modal-dialog-content {
      background: none;
      
      & a {
        color: var(--palerblue) !important;
      }
      & .docs-homescreen-settings-itemlabel {
        color: var(--lightestgray);
      }
      & .docs-homescreen-settings-bidi-checkbox-wrapper, .docs-homescreen-settings-show-templates-checkbox-wrapper, 
      & .docs-homescreen-settings-itemvalue {
        color: var(--lightergray);
      }
      & .docs-homescreen-settings-analytics-status-description {
        color: var(--lightgray);
      }
      & .docs-material-gm-checkbox {
        border-color: var(--lightergray);
        &.docs-material-gm-checkbox-checked {
          background-color: var(--paleblue);
          border-color: $background-color;
          &::before {
            filter: invert();
          }
        }
      }
      & .docs-homescreen-ui-slide-switch {
        &>.docs-homescreen-ui-slide-switch-rail {
          background-color: var(--mediumdarkgray);
          border-color: $background-color;
        }
        &>.docs-homescreen-ui-slide-switch-knob {
          background-color: var(--lightergray);
          border-color: $background-color;
        }
        
        &.docs-homescreen-ui-slide-switch-checked {
          &>.docs-homescreen-ui-slide-switch-rail {
            background-color: var(--blue-ripple);
            border-color: $background-color;
          }
          &>.docs-homescreen-ui-slide-switch-knob {
            background-color: var(--paleblue);
            border-color: $background-color;
          }
        }
      }
      & .docs-homescreen-settings-ok-button {
        background-color: var(--paleblue);
        color: var(--darkestgray);
        transition: var(--off);
        &.jfk-button-hover {
          background-color: var(--palerblue);
          transition: var(--on);
        }
      }
    }
  }
}

@-moz-document url-prefix("https://docs.google.com/document/d/") {
  // Main editor
  
  body.docs-gm.docs-grille-gm3 {
    background-color: var(--ddocs-background);
  }
  
  body.docs-grille-gm3 .jfk-tooltip {
    background-color: var(--ddocs-surface-container-highest);
    color: var(--ddocs-on-surface);
    & .scb-tooltip-title /* Share button tooltip */ {
      color: var(--ddocs-on-surface);
    }
    &.docos-emoji-counter-button-tooltip /* Who reacted with which emoji */ {
      box-shadow: none;
    }
  }
  
  body.docs-grille-gm3 .docs-bubble-material {
    background-color: var(--ddocs-surface-container-high);
    border-radius: var(--ddocs-corner-m); /* I’m treating these like cards */ 
    box-shadow: 0 1px 2px rgba(0,0,0,.3),0 2px 6px 2px rgba(0,0,0,.15);
  }
  
  .docs-grille-gm3 .docs-gm-promo.jfk-bubble.docs-promo-bubble /* New feature promotions, like the watermark promo */ {
    background-color: var(--ddocs-primary-container);
    
    & * {
      color: var(--ddocs-on-primary-container);
    }
    & .jfk-bubble-arrowup .jfk-bubble-arrowimplafter {
      border-color: var(--ddocs-primary-container) transparent;
    }
  }
  
  @supports not selector(:has(div)) {
    #docs-butterbar-container::before when (@has-selector-missing-warning=1) {
      background-color: var(--ddocs-inverse-surface);
      border-radius: 4px;
      box-shadow: 0 0 16px var(--darkestgray);
      color: var(--ddocs-inverse-on-surface);
      content: "Your browser does not support the :has() selector, so Dark Docs may not work correctly. On Firefox 103 and newer, you may enable it by going to about:config and setting layout.css.has-selector.enabled to true, then reloading this tab. To hide this message, click on the Stylus extension on your browser’s toolbar or extensions menu, click on the gear beside “Dark Docs”, and turn off “Warn me if the :has() selector is not available in my browser”, then disable and re-enable Dark Docs if necessary.";
      display: inline-block;
      font-size: var(--docs-material-font-size-normal,13px);
      line-height: 1.5em;
      margin: 0 16px;
      max-width: 50vw;
      padding: 16px 24px;
      position: relative;
      text-align: left;
    }
  }
  
  .checkbox() {
    /* Labeled checkboxes */
    &>.docs-material-gm-labeled-checkbox-checkbox /* Enabled */ {
      &.docs-material-gm-labeled-checkbox-unchecked {
        background-color: transparent;
        border-color: var(--ddocs-on-surface);
        transition: var(--off);
      }
      &.docs-material-gm-labeled-checkbox-checked {
        background-color: var(--ddocs-primary);
        border-color: $background-color;
        &::before {
          filter: var(--ddocs-primary-icon);
        }
      }
      &+.docs-material-gm-labeled-checkbox-circle {
        transition: var(--off);
      }
    }
    &.docs-material-gm-labeled-checkbox-hover>.docs-material-gm-labeled-checkbox-checkbox {
      &.docs-material-gm-labeled-checkbox-unchecked {
        &+.docs-material-gm-labeled-checkbox-circle {
          background-color: var(--ddocs-on-surface-hover);
        }
      }
      &.docs-material-gm-labeled-checkbox-checked {
        &+.docs-material-gm-labeled-checkbox-circle {
          background-color: var(--ddocs-primary-hover);
        }
      }
      &+.docs-material-gm-labeled-checkbox-circle {
        opacity: 100%;
        transition: var(--on);
      }
    }
    &.docs-material-gm-labeled-checkbox-focused>.docs-material-gm-labeled-checkbox-checkbox {
      &.docs-material-gm-labeled-checkbox-unchecked {
        &+.docs-material-gm-labeled-checkbox-circle {
          background-color: var(--ddocs-on-surface-focus);
        }
      }
      &.docs-material-gm-labeled-checkbox-checked {
        &+.docs-material-gm-labeled-checkbox-circle {
          background-color: var(--ddocs-primary-focus);
        }
      }
      &+.docs-material-gm-labeled-checkbox-circle {
        opacity: 100%;
        transition: var(--on);
      }
    }
    
    /* “Unlabeled” checkboxes */
    &:is(.docs-material-gm-checkbox, .docs-material-gm-checkbox-unchecked) {
      background: none;
      border-color: var(--ddocs-on-surface);
      transition: var(--off);
      &:is(.docs-material-gm-checkbox-hover) { // Not a proper state layer, but this’ll do for the next little while.
        background-color: var(--ddocs-on-surface-hover);
        transition: var(--on);
      }
      &:is(.docs-material-gm-checkbox-focused) {
        background-color: var(--ddocs-on-surface-focus);
        transition: var(--on);
      }
      &:is(.docs-material-gm-checkbox-active) {
        background-color: var(--ddocs-on-surface-pressed);
        transition: var(--on);
      }
    }
    &:is(.docs-material-gm-checkbox-checked) {
      background-color: var(--ddocs-primary);
      border-color: $background-color;
      transition: var(--off);
      &:is(.docs-material-gm-checkbox-hover) { // Not a proper state layer, but this’ll do for the next little while.
        background-color: var(--ddocs-on-primary-hover);
        border-color: $background-color;
        transition: var(--on);
      }
      &:is(.docs-material-gm-checkbox-focused) {
        background-color: var(--ddocs-on-primary-focus);
        border-color: $background-color;
        transition: var(--on);
      }
      &:is(.docs-material-gm-checkbox-active) {
        background-color: var(--ddocs-on-primary-pressed);
        border-color: $background-color;
        transition: var(--on);
      }
      
      &::before /* The checkmark icon */ { 
        filter: var(--ddocs-primary-icon);
      }
    }
    
    & .docs-material-gm-labeled-checkbox-content {
      & label {
        color: var(--ddocs-on-surface);
      }
      & .docs-material-gm-labeled-checkbox-description {
        color: var(--ddocs-on-surface-variant);
      }
    }
  }
  .docs-material-gm-checkbox, .docs-material-gm-labeled-checkbox, .jfk-checkbox {
    .checkbox();
  }
  
  .checkmark-fix() /* This is for the menus that use the older grayish non-90° checkmark */ { 
    background: none;
    &.goog-menuitem-highlight {
      background-color: var(--ddocs-on-surface-hover);
    }
    & .goog-menuitem-checkbox {
      background: no-repeat url(//ssl.gstatic.com/docs/common/material_common_sprite477.svg) 0 -1056px;
      filter: invert(100%);
      height: 21px;
      margin-top: -9px;
      top: 50%;
    }
  }
  body.docs-grille-gm3 {
    & :is(.kix-embedded-entity-options-margins-menu, .kix-embedded-entity-options-relative-base-menu, .kix-bordersshadingdialog-menu, .kix-toc-sidebar-tab-leader-menu, .kix-toc-sidebar-heading-indent-menu, .docs-explore-citation-format-picker-menu) {
      background-color: var(--ddocs-surface-container-high) !important;
      & .goog-option-selected {
        .checkmark-fix();
        & .goog-menuitem-checkbox {
          left: 9px;
        }
      }
    }
  }
  
  .custom-colour-picker() {
    & .docs-material-color-picker-saturation-value-background {
      border: none;
    }
    & .docs-material-color-swatch-wrapper {
      box-shadow: none;
      outline: 2px solid var(--ddocs-inverse-surface);

      & .docs-material-color-swatch-checkbox-background {
        filter: invert(100%);
      }
    }
    & .docs-material-color-picker-dragger {
      border-color: var(--ddocs-inverse-surface);
      box-shadow: none;
    }
    & .docs-icon-colorize-24 {
      filter: var(--whiter-icons);
    }
    & .docs-material-color-input-wrapper {
      &>div {
        color: var(--ddocs-on-surface);
      }
      &>input {
        .outlined-text-field();
        outline: none;
        &::spelling-error {
          text-decoration: none; // Google Docs team should’ve used spellcheck="false"
        }
      }
      &>.docs-material-hex-input {
        width: calc(2rem + 7ch + 2px) !important;
      }
      &>input:is(.docs-material-rgba-red-input, .docs-material-rgba-green-input, .docs-material-rgba-blue-input, .docs-material-rgba-alpha-input) {
        width: calc(2rem + 3ch + 2px) !important;
      }
    }
  }
  
  .date-picker() /* With month-view you can click on */ {
    background-color: var(--ddocs-surface-container-high);
    border-radius: var(--ddocs-corner-l);
    box-shadow: none;
    outline: none;
    & .goog-date-picker {
      background: none;
    }
    & .goog-date-picker-head, 
    & .goog-date-picker-monthyear /* Month and year */ {
      color: var(--ddocs-on-surface-variant);
    }
    & button.goog-date-picker-previousMonth, button.goog-date-picker-nextMonth {
      filter: var(--whiter-icons) brightness(80%);
      transition: var(--off);
      &:hover {
        background-color: var(--ddocs-on-surface-variant-hover);
        transition: var(--on);
      }
      &:focus {
        background-color: var(--ddocs-on-surface-variant-focus);
      }
    }
    & .goog-date-picker-wday /* S M T W T F S */ {
      color: var(--ddocs-on-surface);
    }
    & .goog-date-picker-date /* Dates on the calendar */ {
      color: var(--ddocs-on-surface);
      &:hover::before {
        background-color: var(--ddocs-on-surface-variant-hover);
        transition: var(--on);
      }
      // Doesn’t seem to handle :focus in the expected way, so I’m not putting an effect for it.
      &:active::before {
        background-color: var(--ddocs-on-surface-variant-pressed);
      }
      
      &.goog-date-picker-other-month /* Dates from other month */ {
        color: var(--ddocs-on-surface-variant);
      }
      &.goog-date-picker-today {
        color: var(--ddocs-primary);
        &:hover::before {
          background-color: var(--ddocs-primary-hover);
          transition: var(--on);
        }
        &:active::before {
          background-color: var(--ddocs-primary-pressed);
        }
        
        &::before {
          border-color: var(--ddocs-primary);
        }
      }
      &.goog-date-picker-selected {
        color: var(--ddocs-on-primary) !important;
        &:hover::before {
          background-color: var(--ddocs-on-primary-hover);
          transition: var(--on);
        }
        &:active::before {
          background-color: var(--ddocs-on-primary-pressed);
        }
        
        &::before {
          background-color: var(--ddocs-primary);
        }
      }
    }
    & .docs-date-picker-action-row {
      & .docs-material-button-text-default {
        .text-button();
      }
    }
  }
  
  .dialog() /* Dialog boxes */ {
    background-color: var(--ddocs-surface-container-high); 
    border: none;
    border-radius: 28px;
    box-shadow: 0 4px 8px 3px rgba(0,0,0,.15);
    color: var(--ddocs-on-surface);
    
    &>:is(.docs-material-gm-dialog-title, .modal-dialog-title) /* More like titlebar */ {
      background-color: transparent;
      color: currentColor;
      &:is(.docs-material-gm-dialog-title-draggable, .modal-dialog-title-draggable) {
        cursor: move;
      }
      
      &>:is(.docs-material-gm-dialog-title-text, .modal-dialog-title-text) {
        color: currentColor;
      }
      &>:is(.docs-material-gm-dialog-title-close, .modal-dialog-title-close) {
        color: currentColor;
        opacity: 100%;
        transition: var(--off);
        .standard-icon-button();
        &::after {
          filter: invert(100%) brightness(500%);
        }
      }
    }
    
    &>.modal-dialog-content, 
    &>.docs-material-gm-dialog-content {
      background-color: transparent;
      color: currentColor;
      
      & a {
        color: var(--ddocs-primary);
      }
      
      & .jfk-button-action {
        .filled-button();
      }

      & button, 
      & .jfk-button-standard {
        .outlined-button();
        border-color: var(--ddocs-outline) !important; // Couldn’t do this in the mixin because the comments button, which doesn’t have an outline, still has this class. 
      }
      
      & .goog-flat-menu-button {
        .outlined-exposed-dropdown-menu();
      }
      
      & .jfk-radiobutton {
        .radio-button();
      }
      
      & .docs-horizontal-button-group .docs-material-button {
        .toggle-button();
      }
    }
    
    & .jfk-textinput { // The “Name current version” dialog prefers to not put its content in a .modal-dialog-content
      .outlined-text-field();
    }
    
    &>.modal-dialog-buttons {
      
      &>button:not(.jfk-button-action, .goog-buttonset-action), 
      &>.jfk-button-standard {
        .outlined-button();
        border-color: var(--ddocs-outline) !important;
      }
      
      &>.goog-buttonset-action {
        .filled-button();
      }
    }
  }
  .docs-gm :is(.modal-dialog, .docs-dialog, .docs-material-gm-dialog) {
    .dialog();
  }
  body.docs-grille-gm3 :is(.modal-dialog, .docs-dialog, .docs-material-gm-dialog) /* Dialog box fixes */ {
    &.color-dialog /* Custom colour picker */ {
      .custom-colour-picker();
    }
    
    & .pub-dialog-content /* Publish to the web */ {
      
      & .pub-dialog-info {
        color: var(--ddocs-on-surface);
        &.pub-dialog-state-published {
          color: var(--ddocs-secondary);
        }
      }
      
      & #pub-dialog-links-tab-bar {
        border-bottom-color: var(--ddocs-outline-variant) !important;
        
        &>.pub-dialog-tab {
          color: var(--ddocs-on-surface-variant);
          transition: var(--off);
          &.goog-tab-hover {
            background-color: var(--ddocs-on-surface-variant-hover);
            transition: var(--on);
            &:not(.goog-tab-selected) {
              border: none;
            }
          }
          &.goog-tab-active {
            background-color: var(--ddocs-on-surface-variant-pressed);
          }
          &.goog-tab-selected {
            background: none !important;
            border-color: currentColor;
            color: var(--ddocs-primary);
            transition: var(--off);
            &.goog-tab-hover {
              background-color: var(--ddocs-primary-hover) !important;
              transition: var(--on);
            }
            &.goog-tab-active {
              background-color: var(--ddocs-primary-pressed) !important;
            }
          }
        }
      }
      
      & hr.pub-dialog-sep {
        border-color: var(--ddocs-outline-variant);
      }
      
      & #pub-dialog-settings-header.pub-dialog-zippy-header {
        color: var(--ddocs-on-surface);
        &>.pub-dialog-settings-zippy-icon {
          filter: invert(80%);
          transition: transform 0.2s;
        }
      }
      
      & #pub-dialog-publish-button {
        color: var(--ddocs-primary);
      }
      & #pub-dialog-dom-signin-req-dropdown-container>.jfk-select {
        .outlined-text-field();
      }
    }
    
    &.kix-pagesetupdialog-modal {
      & .kix-pagesetupdialog-document-mode-toggle /* Pages or pageless */ {
        &>.docs-material-button {
          .outlined-button();
          &:not(.docs-material-button-selected) {
            color: var(--ddocs-on-surface);
          }
          &.docs-material-button-selected {
            background-color: var(--ddocs-primary-pressed);
            color: var(--ddocs-primary);
            &.docs-material-button-focused {
              background-color: var(--ddocs-primary-pressed);
            }
            
            &>.docs-material-button-content {
              color: var(--ddocs-primary);
            }
          }
        }
      }
      & #kix-pagesetupdialog-apply-selection, #kix-pagesetupdialog-paper-size, #kix-pagesetupdialog-page-color-button>.docs-flatcolormenubutton {
        .outlined-text-field();
        margin-top: 5px !important;
      }
      & .kix-pagesetupdialog-margins-container {
        & .kix-pagesetupdialog-units {
          color: var(--ddocs-on-surface);
          opacity: 100%;
        }
        & .kix-pagesetupdialog-margin-input {
          width: calc(2rem + 3ch);
        }
      }
      
      & .kix-pagesetupdialog-pageless-image {
        filter: var(--darkfilter);
      }
      & .kix-pagesetupdialog-canvas-description-text {
        color: var(--ddocs-on-surface);
      }
      & #kix-pagesetupdialog-canvas-unsupported-model-features-warning /* Headers, &c. won’t be visible in pageless mode */ {
        background-color: var(--ddocs-error-container);
        & .docs-icon-warning-filled-red700 {
          filter: invert() hue-rotate(180deg) brightness(140%);
        }
        &>.kix-pagesetupdialog-canvas-unsupported-model-features-warning-text {
          color: var(--ddocs-on-error-container);
        }
      }
    }
    
    &.docs-details-dialog {
      & .docs-details-field {
        color: var(--ddocs-on-surface-variant);
      }
      & .docs-details-value {
        color: var(--ddocs-on-surface);
        &>#docs-details-folder .docs-icon-img {
          filter: var(--whiter-icons);
        }
      }
    }
    
    &.docs-findandreplacedialog {
      & #docs-findandreplacedialog-findinput {
        &>.docs-findinput-container {
          background: none;
          border-color: var(--ddocs-outline);
          font-size: 1rem;
          height: 3rem;
          padding: 0 1rem;
          transition: var(--off);
          &:has(input:hover):not(.docs-findinput-container-focus) {
            border-color: var(--ddocs-on-surface);
            transition: var(--on);
          }
          &.docs-findinput-container-focus {
            border-color: var(--ddocs-primary);
            padding: 0 calc(1rem - 1px);
          }
          
          & .docs-findinput-input {
            caret-color: var(--ddocs-primary);
            color: var(--ddocs-on-surface);
            font-size: 1rem;
            height: unset;
            &::selection {
              background-color: var(--ddocs-primary);
              color: var(--ddocs-on-primary);
            }
          }
          & .docs-findinput-count {
            color: var(--ddocs-on-surface-variant);
          }
        }
      }
    }
    
    &.google-url-picker /* Insert Image dialog */ {
      .dialog();
      overflow: hidden; // Crops the image preview (mainly the top corners) so it’s borderless on three sides. 

      /* This is a very weird dialog box that calls for many fixes */

      & .picker-urlview {
        padding: 0;

        &>.picker-urlview-header {
          color: currentColor;
          font-family: "Google Sans", Roboto, RobotoDraft, Helvetica, Arial, sans-serif;
          font-size: 22px;
          font-weight: 400;
          line-height: 28px;
        }

        &>.picker-urlview-inner-input {
          .outlined-text-field(@height: 56px); 
          padding-right: 52px; ;
          &:has(+.picker-urlview-loading-icon[style="display: none;"]) {
            padding-right: 16px; 
          }
        }
        &>.picker-urlview-loading-icon {
          box-sizing: border-box;
          height: 56px;
          left: -36px;
          padding: 0;
          position: relative;
          top: 6px;
          width: 0;
        }

        &>.picker-urlview-error-container {
          color: var(--ddocs-error);
          margin-top: 4px;
        }

        &>.picker-urlview-disclaimer-container {
          box-sizing: border-box;
          color: var(--ddocs-on-surface-variant);
          font-size: 12px;
          margin-top: 4px;
          padding: 0;
        }
      }

      &>.picker-urlview-actionbar {
        margin-top: 24px;
        padding: 0;

        &>.picker-urlview-cancelbutton {
          .outlined-button();
          margin-right: 12px;
          text-transform: capitalize;
        }

        &>.picker-urlview-insertbutton {
          .filled-button();
          border-color: $background-color !important;
          text-transform: capitalize;
        }
      }

      & button.picker-urlview-close-icon /* The button that removes the image preview from the "By URL" image selector. I don’t know why it’s a close button, so I changed it to a back button. */ {
        background-color: var(--ddocs-surface-container-high) !important;
        border: 1px solid var(--ddocs-outline);
        border-radius: 20px !important;
        display: grid;
        height: 40px;
        left: 0;
        margin: 24px;
        padding: 2px 0 0 !important;
        place-items: center;
        right: auto;
        transition: var(--off);
        width: 40px;
        &:hover {
          background-color: var(--ddocs-surface-container-highest) !important;
          transition: var(--on);
        }

        &>svg {
          display: none;
        }
        &::after {
          content: url(https://fonts.gstatic.com/s/i/materialiconsoutlined/arrow_back/v17/24px.svg);
          filter: invert(100%);
        }
      }

      & .picker-urlview-image {
        margin: -25px -24.7px 0;
      }
    }
    
    &.kix-dropdown-configuration-dialog /* Insert dropdown */ {
      & .kix-dropdown-entity-configuration-dialog-title-naming-component-header {
        background-color: var(--ddocs-surface-container-high);
        color: var(--ddocs-on-surface);
      }
      & .kix-dropdown-entity-configuration-dialog-title-naming-component-input {
        .outlined-text-field();
        outline: none !important;
      }
      
      & .kix-dropdown-configuration-dialog-items-container {
        scrollbar-color: var(--ddocs-outline) transparent;
        width: unset;
        
        &>.kix-dropdown-configuration-dialog-item-component {
          height: unset;
          &.kix-dropdown-configuration-dialog-item-component-active-drag {
            background-color: #4e5052 /* on surface container high drag */;
            z-index: 1;
          }
          
          & .kix-dropdown-configuration-dialog-item-component-color-menu-button {
            .outlined-text-field();
            flex-shrink: 0;
            margin: 0 6px !important;
            &.goog-flat-menu-button-open {
              border-color: var(--ddocs-primary) !important;
              box-shadow: inset 0 0 0 1px var(--ddocs-primary);
            }
          }
          & .kix-dropdown-configuration-dialog-item-component-display-value-input {
            .outlined-text-field();
            &:focus-visible {
              outline: none;
            }
          }
        }
      }
      
      & .kix-dropdown-entity-configuration-dialog-add-button {
        color: var(--ddocs-primary);
        
        & svg {
          fill: currentColor !important;
        }
        &>.kix-dropdown-entity-configuration-dialog-add-button-text {
          color: currentColor;
        }
      }
    }
    
    &.ita-cp-whole-pad /* Insert special characters */ {
      padding: 1.5rem;
      & .modal-dialog-title {
        align-items: center;
        display: flex;
        height: 1.5rem;
        margin-bottom: 1rem;
        &>.modal-dialog-title-text {
          flex-grow: 1;
        }
      }
      & .modal-dialog-title-close {
        box-sizing: border-box;
        cursor: pointer;
        display: grid;
        float: right;
        height: 2.5rem;
        left: 8px;
        padding: 0;
        place-items: center;
        position: relative;
        width: $height;
        &::after {
          background: url("https://www.gstatic.com/images/icons/material/system/2x/close_white_24dp.png");
          background-size: contain;
          display: block;
          filter: none; 
          height: 24px;
          position: static;
          width: 24px;
        }
      }
      & .ita-cp-menubar {
        & .jfk-select /* These are effectively filter chips */ {
          .filter-chip();
          &:first-of-type {
            margin-left: 0;
          }
          &[style*="display: none;"]+.jfk-select {
            margin-left: 0; // Removes unnecessary gap to the left of the category selector 
          }
        }
      }
      
      & .ita-cp-cell .goog-char-picker-grid {
        border-color: var(--ddocs-outline-variant);
        scrollbar-color: var(--ddocs-outline) transparent;
        
        &>.goog-flat-button {
          border-color: var(--ddocs-outline-variant);
          transition: var(--off);
          &.goog-flat-button-hover {
            background-color: var(--ddocs-on-surface-hover);
            transition: var(--on);
          }
          &.goog-flat-button-active {
            background-color: var(--ddocs-on-surface-pressed);
          }
        }
      }
      
      & .ita-cp-cell .ita-cp-search {
        border-color: var(--ddocs-outline-variant);
        &>.ita-cp-lens {
          filter: invert();
        }
        &>.ita-cp-input {
          background: none;
          color: var(--ddocs-on-surface);
        }
      }
      & .ita-cp-cell .ita-cp-hwt {
        background: none;
        border-color: var(--ddocs-outline-variant);
        & .ita-cp-hwt-hint {
          border-color: var(--ddocs-outline);
          & .ita-hwt-canvas {
            filter: brightness(2);
          }
        }
        & .ita-cp-backspace-img.ita-kd-img {
          filter: invert();
        }
      }
    }
    
    &.kix-pagenumberdialog-container {
      & .kix-pagenumberdialog-title {
        color: var(--ddocs-on-surface);
      }
      & .kix-pagenumberdialog-radio-button-group-controls {
        & .jfk-radiobutton-checked .jfk-radiobutton-radio {
          border-color: var(--ddocs-primary);
          &::after {
            border: none;
            height: 1rem;
            width: 1rem;
          }
        }
        & .jfk-radiobutton:not(.jfk-radiobutton-disabled, .jfk-radiobutton-checked) .jfk-radiobutton-radio {
          border-color: var(--ddocs-outline);
        }
      }
      & .docs-material-gm-checkbox-checked::before {
        height: 0.9375rem;
        width: $height;
        position: absolute;
      }
      & .docs-material-gm-dialog-buttons {
        padding: 0;
      }
    }
    
    & .kix-bordersshadingdialog {
      & #kix-bordersshadingdialog-borderposition .jfk-button {
        background-color: transparent;
        border-color: var(--ddocs-outline) !important;
        padding: 0 !important;
        width: 2.5rem;
        &.jfk-button-hover {
          background-color: var(--ddocs-on-surface-variant-hover);
          transition: var(--on);
        }
        &.jfk-button-focused {
          background-color: var(--ddocs-on-surface-variant-focus);
        }
        &.jfk-button-active {
          background-color: var(--ddocs-on-surface-variant-pressed);
        }
        
        & .docs-icon-img {
          filter: var(--whiter-icons);
        }
        
        &.jfk-button-checked {
          background-color: var(--ddocs-primary-container);
          border: 1px solid $background-color !important;
          &.jfk-button-hover {
            background-color: var(--ddocs-on-primary-container-hover);
            border-color: $background-color !important;
          }
          &.jfk-button-focused {
            background-color: var(--ddocs-on-primary-container-focus);
            border-color: $background-color !important;
          }
          &.jfk-button-active {
            background-color: var(--ddocs-on-primary-container-pressed);
            border-color: $background-color !important;
          }
        }
      }
      & .kix-bordersshadingdialog-section {
        height: 48px;
      }
      & .goog-flat-menu-button {
        .outlined-text-field();
        
        &#kix-bordersshadingdialog-borderdash .docs-icon-line-type {
          filter: var(--whiter-icons);
        }
        &#kix-bordersshadingdialog-borderdash div[style*="rgb(0, 0, 0)"] {
          border-color: var(--ddocs-on-surface) !important;
        }
      }
    }
    
    & .docs-indentationdialoggm-content {
      & .docs-indentationdialoggm-units {
        color: var(--ddocs-on-surface);
        opacity: 100%;
      }
      & .docs-indentationdialoggm-input-error {
        border-color: var(--ddocs-error) !important;
        caret-color: var(--ddocs-error);
        &:focus {
          box-shadow: inset 0 0 0 1px var(--ddocs-error);
        }
      }
      & .docs-indentationdialoggm-error {
        color: var(--ddocs-error);
      }
      & #docs-indentationdialog-indentation-special-type {
        .outlined-text-field();
      }
    }
    
    & .kix-headerfooterdialog-section {
      & .kix-headerfooterdialog-title, .kix-headerfooterdialog-input-label, .kix-headerfooterdialog-units {
        color: var(--ddocs-on-surface);
      }
    }
    
    & .docs-customspacingdialog-content {
      color: var(--ddocs-on-surface);

      & input#docs-customspacingdialog-linespacing {
        width: 5em;
      }
    }
    
    & .kix-columnoptionsdialog-content { 
      & .kix-columnoptionsdialog-section {
        align-items: center;
        display: flex;
        height: 48px;
        & .kix-columnoptionsdialog-title {
          color: var(--ddocs-on-surface);
          font-size: 1rem;
          margin: 0;
        }
        & .kix-columnoptionsdialog-units {
          color: var(--ddocs-on-surface-variant);
        }
        & .kix-columnoptionsdialog-control>.goog-flat-menu-button {
          .outlined-text-field();
        }
      }

      & #kix-columnoptionsdialog-number-of-columns {
        width: 5em;
      }
      & #kix-columnoptionsdialog-column-spacing {
        width: 5em;
      }
      & #kix-columnoptionsdialog-line-between.docs-material-gm-checkbox {
        .checkbox();
      }
    }
    
    & .kix-documentmetricsdialog-row {
      border-bottom: 1px solid var(--ddocs-outline-variant); // Word count dialog’s dividers between metrics
    }
    
    &.kix-pageorientationdialog-container {
      & .kix-pageorientationdialog-title {
        color: var(--ddocs-on-surface);
      }
      & .kix-pageorientationdialog-apply-to-container {
        margin-bottom: 1.5rem;
      }
      & #kix-pageorientationdialog-apply-selection {
        .outlined-text-field();
      }
      & .kix-pageorientationdialog-control .jfk-radiobutton {
        .radio-button();
      }
    }
    
    &.kix-tablesplitcelldialog /* Split cells */ {
      padding: 0;
      
      &>.docs-material-gm-dialog-content {
        & .docs-icon-img {
          filter: var(--whiter-icons);
        }
        & .docs-material-text-field-input {
          .outlined-text-field();
          color-scheme: dark; // Not super beautiful but I’m surprised this is an option. Currently there is no way to customize the increment buttons on input[type="number"] elements. 
        }
      }
    }
    
    & .docs-userdictionarydialog-content /* Personal dictionary dialog */ .docs-userdictionarydialog-list-container {
      background: none;
      border-color: var(--ddocs-outline-variant);
      
      &>.docs-userdictionarydialog-row-container {
        border-bottom-color: var(--ddocs-outline-variant);
        transition: var(--off);
        &.docs-userdictionarydialog-row-container-hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
        &.docs-userdictionarydialog-row-container-active {
          background-color: var(--ddocs-on-surface-pressed);
        }
        
        &>.docs-userdictionarydialog-row-content {
          color: var(--ddocs-on-surface);
        }
      }
      
      & .docs-icon-delete-grey600-24 {
        filter: var(--whiter-icons);
      }
    }
    
    & .kix-translatedialog /* Translate document dialog */ {
      width: 100%;
      
      &>.kix-translatedialog-desc {
        color: var(--ddocs-on-surface);
      }
      & .kix-translatedialog-label {
        color: var(--ddocs-on-surface-variant);
      }
      & #kix-translatedialog-title-input {
        width: 100%;
      }
      & #kix-translatedialog-lang-input>.goog-flat-menu-button {
        .outlined-text-field();
      }
    }
    
    & .docos-ssd-content /* Notification settings */ {
      &>p {
        color: var(--ddocs-on-surface-variant);
      }
      &>.docos-ssd-radio-button-group {
        &>.jfk-radiobutton {
          gap: 1rem;
        }
        & .jfk-radiobutton-radio {
          flex-shrink: 0;
          left: unset;
          position: relative;
          top: 12px;
          &::before {
            border: none;
            height: 2.5rem;
            left: -11.5px;
            top: -11.5px;
            width: $height;
          }
        }
        
        & .jfk-radiobutton-label {
          &>label {
            color: var(--ddocs-on-surface);
          }
          &>span {
            color: var(--ddocs-on-surface-variant);
          }
        }
        
        & .jfk-radiobutton-checked {
          & .jfk-radiobutton-label label {
            color: var(--ddocs-primary);
          }
        }
      }
      &>hr {
        border-color: var(--ddocs-outline-variant);
      }
    }
    
    &.docs-preferencesdialog-modal {
      & .docs-preferencesdialog-tabbed-menu-tabbar .docs-tabbar-tab {
        color: var(--ddocs-on-surface-variant);
        transition: var(--off);
        &.docs-tabbar-tab-hover {
          background-color: var(--ddocs-on-surface-variant-hover);
          transition: var(--on);
        }
        &.docs-tabbar-tab-active {
          background-color: var(--ddocs-on-surface-variant-pressed);
        }
          
        &>.docs-tabbar-tablabel {
          color: currentColor;
        }
        
        &.docs-tabbar-tab-selected {
          color: var(--ddocs-primary);
          &.docs-tabbar-tab-hover {
            background-color: var(--ddocs-primary-hover);
          }
          &.docs-tabbar-tab-active {
            background-color: var(--ddocs-primary-pressed);
          }
          &::before {
            border-color: currentColor;
          }
        }
      }
      
      & .docs-preferencesdialog-submenu-container {
        scrollbar-color: var(--ddocs-outline) transparent;
        
        & .docs-preferencesdialog-subtext {
          color: var(--ddocs-on-surface-variant);
        }
        
        &>#docs-preferencesdialog-substitutions-submenu .docs-preferencesdialog-list-body {
          background: none;
          border: none;
          
          & .docs-preferencesdialog-list-title {
            color: var(--ddocs-on-surface);
          }
          & .docs-icon-close-small {
            filter: brightness(5) opacity(80%);
          }
        }
      }
    }
    
    &.a11y-settings-dialog /* Accessibility settings */ .docs-icon-help {
      filter: var(--white-icons);
    }
    
    &.docs-autocorrect-feedbackdialog {
      & .docs-autocorrect-feedbackdialog-other-feedback-header-text {
        color: var(--ddocs-on-surface);
      }
      & .docs-autocorrect-feedbackdialog-legal-information-text {
        color: var(--ddocs-on-surface-variant);
      }
      & .docs-autocorrect-feedbackdialog-product-info-display-text {
        color: var(--ddocs-primary);
      }
    }
    
    &.docs-spell-feedback-product-info-dialog /* What info will be shared with Google? (from the autocorrect feedback dialog) */ {
      max-width: unset;
      
      &>.docs-material-gm-dialog-content {
        scrollbar-color: var(--ddocs-outline) transparent;
      }
    }
  }
  #document-details-bubble-container /* Available while in viewing mode */ {
    background-color: var(--ddocs-surface-container-high);
    &>#document-details-bubble-header {
      color: var(--ddocs-on-surface);
    }
    & .document-details-entry-text {
      color: var(--ddocs-on-surface-variant);
    }
  }
  .docs-save-indicator-popup /* When you click on the save indicator */ {
    background-color: var(--ddocs-surface-container-high);
    & .docs-save-indicator-popup-header {
      background-color: var(--ddocs-primary-container);
    }
    & .docs-save-indicator-popup-icon, .docs-save-indicator-popup-subtitle-icon {
      filter: var(--whiter-icons);
    }
    & .docs-save-indicator-popup-title {
      color: var(--ddocs-on-primary-container);
    }
    & .docs-save-indicator-popup-text, .docs-save-indicator-popup-subtitle {
      color: var(--ddocs-on-surface);
    }
  }
  body.docs-grille-gm3 .docs-chat-message-tooltip-container /* When someone sends you a chat message */ {
    background-color: var(--ddocs-surface-container-high);
    border-color: transparent;
    box-shadow: none;
    color: var(--ddocs-on-surface);
    & .docs-chat-message-tooltip-content {
      color: var(--ddocs-on-surface);
    }
    & .docs-chat-join.docs-material-button-flat-primary.docs-material-button {
      .text-button();
    }
  }
  body.docs-grille-gm3 .goog-char-picker-hovercard /* When you hover over a character in the character picker */ {
    .rich-tooltip();
    background-color: var(--ddocs-surface-container-highest);
    border: none !important;
    &>.goog-char-picker-unicode {
      color: var(--ddocs-on-surface-variant);
    }
  }
  
  .filled-button() {
    background-color: var(--ddocs-primary);
    border: none !important;
    border-radius: 20px !important;
    box-sizing: border-box;
    color: var(--ddocs-on-primary);
    display: grid;
    &:is(.goog-inline-block, .docs-material-button) {
      display: inline-grid;
    }
    font-size: 0.875rem;
    height: 40px !important;
    padding: 0 24px !important;
    place-items: center;
    transition: var(--off);
    &:is(.docs-material-button-disabled, .jfk-button-disabled, [disabled]) {
      background-color: rgba(227, 227, 227, 12%) !important;
      color: rgba(227, 227, 227, 38%) !important;
      transition: var(--off);
    }
    &:is(.docs-material-button-hover, .jfk-button-hover, :hover) {
      background-color: var(--ddocs-on-primary-hover);
      border: none !important; // The OK button in Word Count is particularly fussy
      color: var(--ddocs-on-primary);
      transition: var(--on);
    }
    &:is(.docs-material-button-focused, .jfk-button-focused, :focus), 
    &:is(.jfk-button-hover):is(.jfk-button-focused) {
      background-color: var(--ddocs-on-primary-focus);
      border: none !important;
      color: var(--ddocs-on-primary);
      transition: var(--on);
    }
    &:is(.docs-material-button-active, :active) {
      background-color: var(--ddocs-on-primary-pressed);
      transition: var(--on);
    }
  }
  :is(.docs-material-button-fill-primary.docs-material-button) {
    .filled-button();
  }
  
  .filled-text-field() {
    background-color: var(--ddocs-surface-container-highest);
    border-bottom-color: var(--ddocs-on-surface-variant);
    color: var(--ddocs-on-surface);
    transition: background-color 0.25s ease, border-color 0.1s ease;
    &:hover {
      background-color: color-mix(in srgb, var(--ddocs-surface-container-highest), var(--ddocs-on-surface) var(--ddocs-hover-state-layer-opacity));
      border-bottom-color: var(--ddocs-on-surface);
      transition: background-color 0.02s ease-in, border-color 0.06s ease;
    }
    &:focus-within {
      border-bottom-color: var(--ddocs-primary);
    }
    &:disabled {
      background-color: color-mix(in srgb, var(--ddocs-on-surface), transparent 96%);
      border-bottom-color: $color;
      color: color-mix(in srgb, var(--ddocs-on-surface), transparent 62%);
    }
  }
  
  .filled-tonal-button() {
    background-color: var(--ddocs-secondary-container);
    border-radius: 20px;
    color: var(--ddocs-on-secondary-container);
    height: 40px;
    transition: var(--off);
    &.jfk-button-hover {
      background-color: var(--ddocs-secondary-container-hover);
      transition: var(--on);
    }
    &.jfk-button-focused {
      background-color: var(--ddocs-secondary-container-focus);
      transition: var(--on);
    }
  }
  
  .filter-chip() {
    border: 1px solid var(--ddocs-outline);
    border-radius: 0.5rem;
    color: var(--ddocs-on-surface-variant);
    &.goog-inline-block {
      display: inline-flex;
      gap: 0.5rem;
      justify-content: center;
      padding-top: 0;
      padding-bottom: 0;
    }
    height: 2rem;
    padding-left: 1rem;
    padding-right: 1rem;
    &:has(.docs-material-menu-button-flat-default-dropdown, .goog-flat-menu-button-dropdown) {
      padding-right: 0.5rem;
    }
    transition: var(--off);
    &:is(.docs-material-menu-button-flat-default-hover, .goog-flat-menu-button-hover) {
      background-color: var(--ddocs-on-surface-variant-hover);
      transition: var(--on);
    }
    &:is(.docs-material-menu-button-flat-default-focused, .goog-flat-menu-button-focused) {
      background-color: var(--ddocs-on-surface-variant-focus);
    }
    
    &>.docs-icon {
      flex-shrink: 0;
      margin: 0;
    }
    &>:is(.docs-material-menu-button-flat-default-caption, .goog-flat-menu-button-caption) {
      color: inherit;
      font-weight: 500;
      margin: 0;
      white-space: nowrap;
    }
    &>.goog-flat-menu-button-dropdown {
      filter: var(--whiter-icons) brightness(80%);
      flex-shrink: 0;
    }
    &:not(.filter-applied)>.docs-material-menu-button-flat-default-dropdown svg {
      fill: var(--ddocs-on-surface-variant);
    }
    &.filter-applied {
      background-color: var(--ddocs-primary-container);
      border: none;
      color: var(--ddocs-on-primary-container);
      padding-left: 0.5rem;
      &.docs-material-menu-button-flat-default-hover {
        background-color: var(--ddocs-on-primary-container-hover);
        transition: var(--on);
      }
      &.docs-material-menu-button-flat-default-focused {
        background-color: var(--ddocs-on-primary-container-focus);
      }
      &.docs-material-menu-button-flat-default-open {
        background-color: var(--ddocs-on-primary-container-pressed);
      }
      
      &>.docs-material-menu-button-flat-default-dropdown svg {
        fill: var(--ddocs-on-primary-container);
      }
    }
    
    &>.docs-icon .docs-icon-img {
      filter: brightness(5) hue-rotate(60deg) saturate(90%);
    }
    
    &>.docs-material-menu-button-flat-default-dropdown {
      flex-shrink: 0;
      height: 1.125rem;
      margin: 0;
      width: $height;
      
      & svg {
        height: 100%;
        width: $height;
      }
    }
  }
  
  .menu() /* Dropdown menus */ {
    background: var(--ddocs-surface-container-high);
    border: none;
    box-shadow: 0 2px 6px 2px rgba(0,0,0,.25);
    scrollbar-color: var(--ddocs-outline) transparent;
    
    // Background colour change for hover and click
    &>.goog-menuitem {
      padding-top: 6px; padding-bottom: 6px;
      transition: var(--off);
      
      &.goog-menuitem-highlight {
        background-color: var(--ddocs-on-surface-hover);
        border: none;
        transition: var(--on);
      }
      &.goog-menuitem-active:not(.goog-submenu:not(.goog-option)) /* Double negative! In this case it’s because there are some menu items that can be clicked, like the items in the styles menu, which are marked with .goog-option. */ {
        background-color: var(--ddocs-on-surface-pressed);
        transition: var(--on);
      }
    }
    
    // Menu item content
    &>.goog-menuitem>.goog-menuitem-content {
      &>.goog-menuitem-icon:has(div:not(.docs-icon-editors-ia-article-document-blue):not(.docs-icon-editors-ia-apps-script):not(.docs-icon-editors-ia-spreadsheet-green)) {
        filter: var(--whiter-icons);
      }
      &>.goog-menuitem-label, 
      &>span /* Needed >span because File→Language submenu is weird */, 
      & /* The zoom menu (left of the styles menu) and font size menu puts text directly into .goog-menuitem-content */ {
        color: var(--ddocs-on-surface);
      }
      &>.goog-menuitem-accel /* Keyboard shortcut */ {
        color: var(--ddocs-on-surface-variant);
        font-weight: lighter;
      }
      &>.goog-submenu-arrow /* Arrows indicating nested menus */ {
        color: var(--ddocs-on-surface-variant);
        opacity: 100%;
      }
    }
    &>.goog-menuitem.goog-menuitem-disabled {
      opacity: 38%;
      
      &>.goog-menuitem-content>.goog-menuitem-icon {
        opacity: 100%; // Didn’t want opacities to compound and make the icons extra transparent
      }
    }
    &>.apps-hoverable-menu-separator-container>.apps-hoverable-menu-separator-bottom, 
    &>.goog-menuseparator /* Dividers */ {
      border-top-color: var(--ddocs-outline-variant);
    }
    
    // A bit of eye candy? Moves the arrow that indicates a submenu to the right when the menu opens.
    &>.goog-menuitem.goog-submenu-open.goog-submenu:not(.goog-menuitem-disabled) .goog-submenu-arrow {
      color: var(--ddocs-on-surface);
      transform: translateX(5px);
      transition: color 0.3s, transform 0.3s;
    }
  }
  
  @media (prefers-reduced-motion) {
    .goog-submenu-arrow {
      transform: none !important;
    }
  }
  
  .docs-gm .goog-menu:not(:has(.goog-menuitem-label[style*="color: rgb("])) /* Don’t do the menu stuff for the styles menu if in light mode, basically */ {
    .menu();
  }
  body.docs-gm .docs-material.goog-menu .apps-menuitem.goog-option-selected .goog-menuitem-checkbox {
    filter: invert() brightness(140%); // Modern checkmark fix
  }
  .goog-menu:not(.ia-primary-menu):has(span[lang="en_CA"]) .goog-menuitem.goog-option-selected:not(.apps-menuitem) /* Document language menu fix */ {
    .checkmark-fix();
  }
  .goog-menu>.goog-dimension-picker {
    .goog-dimension-picker-unhighlighted,
    .goog-dimension-picker-highlighted {
      filter: invert(100%) hue-rotate(180deg) contrast(80%) brightness(200%); // Table size menu fix
    }
    .goog-dimension-picker-status {
      color: var(--ddocs-on-surface-variant);
    } 
  }
  .goog-menu.docs-dropdown-item-color-menu /* Dropdown option colour menu (not a normal colour menu) */ {
    background-color: var(--ddocs-surface-container-high) !important;
    
    &>.docs-dropdown-item-color-menu-header {
      color: var(--ddocs-on-surface-variant);
    }
    &>.docs-material-colorpalette-hover .goog-control-hover>.docs-material-colorpalette-colorswatch {
      border: 2px solid var(--ddocs-outline-variant);
      box-shadow: none;
      outline: 2px solid var(--ddocs-primary);
    }
    &>.docs-dropdown-item-color-menu-customize-button {
      color: var(--ddocs-primary);
    }
    &>.docs-dropdown-item-color-menu-reset-button {
      .outlined-button();
      display: grid;
      place-items: center;
      
      & .docs-icon { 
        margin-right: 0.5em;
        &>.docs-icon-no-color {
          filter: invert();
          opacity: 80%;
        }
      }
    }
    & .docs-dropdown-item-preview-control-title {
      color: var(--ddocs-on-surface);
    }
  }
  .goog-menu.docs-dropdown-item-custom-color-menu {
    background-color: var(--ddocs-surface-container-high) !important;
    
    & .docs-dropdown-item-preview-control-title {
      color: var(--ddocs-on-surface);
    }
    
    & .docs-tabbar-tab {
      border: none;
      color: var(--ddocs-on-surface-variant);
      transition: var(--off);
      &.docs-tabbar-tab-hover {
        background-color: var(--ddocs-on-surface-variant-hover);
        transition: var(--on);
      }
      &.docs-tabbar-tab-active {
        background-color: var(--ddocs-on-surface-variant-pressed);
      }
      
      &>.docs-tabbar-tablabel {
        color: currentColor;
      }
      
      &.docs-tabbar-tab-selected {
        color: var(--ddocs-primary);
        &.docs-tabbar-tab-hover {
          background-color: var(--ddocs-primary-hover);
        }
        &.docs-tabbar-tab-active {
          background-color: var(--ddocs-primary-pressed);
        }
        &::before {
          border-top-color: currentColor;
        }
      }
    }
    
    & .docs-material-hsv-color-picker {
      .custom-colour-picker();
    }
    
    & .docs-dropdown-item-custom-color-menu-cancel-button {
      .outlined-button();
      line-height: 2.5rem;
    }
    & .docs-dropdown-item-custom-color-menu-okay-button {
      .filled-button();
      max-width: unset;
    }
  }
  
  .goog-menu>.goog-palette:is(.kix-multicolumn-palette, .kix-pagenumber-palette) {
    & .goog-palette-cell .docs-preview-palette-item {
      border-color: var(--ddocs-outline);
      border-radius: var(--ddocs-corner-xs);
      transition: var(--off);
      
      &>.kix-pagenumber-img {
        filter: invert() contrast(70%) brightness(170%);
      }
      &>.kix-multicolumn-img {
        filter: brightness(75%);
      }
    }
    & .goog-palette-cell-hover .docs-preview-palette-item {
      background-color: var(--ddocs-on-surface-variant-hover);
      border-color: var(--ddocs-on-surface-variant);
      transition: var(--on);
    }
    &.goog-palette-active .goog-palette-cell-hover .docs-preview-palette-item {
      background-color: var(--ddocs-on-surface-variant-pressed);
    }
    & .goog-palette-cell-selected .docs-preview-palette-item {
      border: 1px solid var(--ddocs-primary);
      box-shadow: inset 0 0 0 1px var(--ddocs-primary);
      margin: 1px;
    }
  }
  
  .goog-menu>.docs-bulletpreset-palette /* Format → Bullets & numbering → List options */ {
    & .docs-bulletpreset {
      border-color: var(--ddocs-outline);
      border-radius: var(--ddocs-corner-xs);
      transition: var(--off);
      
      & .docs-icon-checkbox-hollow {
        filter: invert();
      }
    }
    & .goog-palette-cell-hover .docs-bulletpreset {
      border-color: var(--ddocs-on-surface-variant);
      transition: var(--on);
    }
    /* & .goog-palette-cell-selected .docs-bulletpreset {
      border-color: var(--ddocs-primary);
      box-shadow: inset 0 0 0 1px var(--ddocs-primary);
      Yes this would do something but the class may appear on the wrong button
    } */
  }
  
  body.docs-gm .goog-menu .docs-omnibox-input {
    background-color: var(--ddocs-surface-container-highest); // Help menu search bar fix
    box-shadow: none;
    caret-color: var(--ddocs-primary);
    color: var(--ddocs-on-surface-variant);
    &:focus[aria-expanded="true"] {
      border-bottom-color: var(--ddocs-outline-variant);
    }
    &::placeholder {
      color: var(--ddocs-on-surface-variant);
      opacity: 100%;
    }
    &::selection {
      background-color: var(--ddocs-primary);
      color: var(--ddocs-on-primary);
    }
  }
  body.docs-gm :is(.docs-toolbar-mode-switcher-menu, .goog-menu) .goog-menuitem {
    & .current-mode :is(.docs-toolbar-mode-switcher-editing-menu-item, .docs-toolbar-mode-switcher-commenting-menu-item) .docs-toolbar-mode-switcher-menu-label {
      color: var(--ddocs-on-surface);
    }
    & .docs-toolbar-mode-switcher-menu-description {
      color: var(--ddocs-on-surface-variant); // Mode switcher fix
    }
    & .docs-toolbar-mode-switcher-menu-selected-icon .docs-icon-img {
      filter: var(--white-icons);
    }
  }
  .goog-menu:not(.ia-menu):has(.goog-menuitem-label[style*="color: rgb("]) /* Styles menu */ {
    & when not (@document-filter = var(--darkfilter)) {
      &>.goog-menuitem.goog-submenu-open.goog-submenu:not(.goog-menuitem-disabled) .goog-submenu-arrow {
        transform: translateX(5px); // Still gonna give you that eye candy for nested menus
        transition: color 0.3s, transform 0.3s;
      }
    }
    & when (@document-filter = var(--darkfilter)) {
      .menu();
      &>.goog-menuitem.docs-submenuitem {
        border-bottom: 1px solid var(--ddocs-outline-variant); // They decided to implement menu dividers a little differently in the styles menu
        &.goog-option-selected {
          .checkmark-fix();
          &.goog-menuitem-active {
            background-color: var(--ddocs-on-surface-pressed);
          }
        }
      }
      & .goog-menuitem-label[style*="color: rgb("] /* style*= needed again, to exclude the “Options” item */ {
        filter: @document-filter; // Styles menu fix
      } 
    }
  }
  body.docs-gm.docs-grille-gm3>.docs-fontmenu /* Font picker fix */ {
    &>.goog-menuitem.goog-menuitem-disabled:has(.docs-fonts-section-header) /* Why is the section header “RECENT” considered a disabled menu item? */ {
      opacity: 100%;
      &>.goog-menuitem-content>.docs-fonts-section-header {
        color: var(--ddocs-on-surface-variant);
      }
    }
    & .goog-option-selected, 
    &~.goog-menu:has([style*="font-family: \"docs-"]) .goog-option-selected /* The font submenus need this too */ {
      .checkmark-fix();
    }
    &>.docs-fontmenu-fonts /* The rest of the fonts are in a menu within the font menu‽ */ {
      .menu();
      box-shadow: none;
    }
  }
  .goog-menu>.docs-border-selection-palette .goog-palette-cell {
    transition: var(--off);
    &.goog-palette-cell-hover {
      background-color: var(--ddocs-on-surface-hover);
      transition: var(--on);
    }
    
    & .docs-icon-img {
      filter: var(--whiter-icons);
    }
    
    &.goog-palette-cell-selected {
      background-color: var(--ddocs-primary-container);
      
      & .docs-icon-img {
        filter: brightness(290%) saturate(255%) hue-rotate(20deg);
      }
    }
  }
  .colour-menu-fix() /* Colour picker with a bunch of presets and your custom colours at the bottom. It’s called a fix because it’s applied on top of .menu(). */ {
    & .docs-material-colorpalette-cell {
      // filter: @document-filter; /* do people want the colour palete to be inverted like their document? */
      & :is(.docs-material-colorpalette-colorswatch, .docs-material-colorpalette-colorswatch-translucent-wrapper.docs-material-colorpalette-colorswatch-overlay) {
        transition: border-radius 0.2s, transform 0.2s;
      }
    }
    & .docs-material-colorpalette-cell.docs-material-colorpalette-cell-hover :is(.docs-material-colorpalette-colorswatch, .docs-material-colorpalette-colorswatch-translucent-wrapper.docs-material-colorpalette-colorswatch-overlay) {
      border-radius: 4px;
      box-shadow: 0 0 3px 1px var(--ddocs-surface);
      transform: scale(125%);
      z-index: 1; // This all makes a better effect than a white glow. 
    }
    & .docs-colormenuitems-custom-header /* “CUSTOM” */ {
      color: var(--ddocs-on-surface);
    }
    & .docs-colormenuitems-custom-palette :is(.docs-customcolorpalette-add-custom-color-button, .docs-customcolorpalette-eyedropper-button) {
      border-radius: 50%;
      transition: var(--off);
      &:hover {
        background-color: var(--ddocs-on-surface-hover);
        border-radius: 0.25rem;
        transition: var(--on), border-radius 0.2s;
      }
      & .docs-icon-img {
        filter: var(--whiter-icons);
      }
    }
  }
  body.docs-gm .goog-menu.docs-colormenuitems {
    .colour-menu-fix();
  }
  
  @media (prefers-reduced-motion) {
    .docs-material-colorpalette-cell.docs-material-colorpalette-cell-hover :is(.docs-material-colorpalette-colorswatch, .docs-material-colorpalette-colorswatch-translucent-wrapper.docs-material-colorpalette-colorswatch-overlay) {
      border: 2px solid var(--ddocs-outline-variant);
      border-radius: 50% !important;
      outline: 2px solid var(--ddocs-outline);
      transform: none !important;
    }
  }
  
  body.docs-grille-gm3 .goog-menu>.docs-listpreset-palette .goog-palette-cell {
    & .docs-preview-palette-item {
    border-color: var(--ddocs-outline-variant);
      
      & .docs-listpreset-img /* List style preview images */ {
        filter: contrast(65%) sepia(3.2%) invert() hue-rotate(5deg) brightness(119%);
        transition: var(--off);
      }
    }
    &.goog-palette-cell-hover:not(.goog-palette-cell-selected) .docs-preview-palette-item {
      box-shadow: none;
      
      & .docs-listpreset-img {
        filter: contrast(65%) sepia(3.2%) invert() hue-rotate(5deg) brightness(150%);
        transition: var(--on);
      }
    }
    &.goog-palette-cell-selected .docs-preview-palette-item {
      background-color:  var(--ddocs-primary-container);
      border: 1px solid var(--ddocs-primary-container);
      box-shadow: none;
      margin: 1px;
      &>div /* List style preview images */ {
        filter: invert(100%) contrast(70%) sepia(100%) hue-rotate(162deg) saturate(526.3%) brightness(135%);
        transition: var(--on);
      }
    }
  }
  body.docs-grille-gm3 .goog-menu>.goog-menuitem .goog-menuitem-checkbox+div>div /* Table border style previews */ {
    border-color: var(--ddocs-on-surface) !important;
  }
  body.docs-grille-gm3 .docs-ruler-context-menu /* The ruler menu has an arrow pointing out of it. */ {
    &>.docs-ruler-context-menu-arrow-horizontal>.docs-ruler-context-menu-arrow-after {
      border-color: var(--ddocs-surface-container) transparent;
    }
    &>.docs-ruler-context-menu-arrow-vertical>.docs-ruler-context-menu-arrow-after {
      border-color: transparent var(--ddocs-surface-container);
    }
  }
  body.docs-grille-gm3 .goog-menu>.kix-equation-toolbar-palette {
    & .kix-equation-toolbar-palette-item {
      border-color: transparent;
      filter: invert(100%);
    }
    & .goog-palette-cell-hover {
      &>.kix-equation-toolbar-palette-item {
        border-color: var(--ddocs-outline);
        box-shadow: none;
      }
    }
  }
  .goog-menu .docs-autocorrect-bubble-option .docs-icon-img {
    filter: var(--whiter-icons);
  }
  .goog-menu>.docs-embedded-content-controls-menu-item /* Linked object menu */ .docs-embedded-content-controls-menu-item-content-icon {
    opacity: 100%;
    
    & .docs-icon-img {
      filter: invert();
    }
  }
  .goog-menu.docs-dropdown-entity-items-preview-menu /* In the @Insert menu, when you choose to insert a dropdown and hover over the preset dropdowns */ .docs-dropdown-entity-items-preview-menu-header {
    color: var(--ddocs-on-surface-variant);
  }
  body.docs-grille-gm3 :is(.kix-citations-format-select-menu, .kix-citations-source-type-select-menu, .kix-citations-accessed-by-select-menu) {
    width: 236px;
    &>.goog-menuitem /* There’s unnecessary padding to the left MLA, APA &c */ {
      padding: 8px 12px;
    }
  }
  
  .outlined-button() {
    background-color: transparent;
    border: 1px solid var(--ddocs-outline) !important;
    border-radius: 20px !important;
    color: var(--ddocs-primary);
    height: 40px !important;
    padding: 0 24px !important;
    transition: var(--off);
    &:is(.jfk-button-disabled, [disabled]) {
      background: none !important;
      border-color: rgba(227, 227, 227, 12%) !important; // var(--ddocs-on-surface) at 12% opacity
      color: rgba(227, 227, 227, 38%) !important;
      opacity: 100%;
    }
    &:is(.docs-material-button-hover, .jfk-button-hover, :hover) {
      background-color: var(--ddocs-primary-hover);
      border: 1px solid var(--ddocs-outline);
      color: var(--ddocs-primary);
      transition: var(--on);
    }
    &:is(.docs-material-button-focused, .jfk-button-focused, :focus), 
    &:is(.jfk-button-hover):is(.jfk-button-focused) {
      background-color: var(--ddocs-primary-focus);
      border: 1px solid var(--ddocs-primary);
      color: var(--ddocs-primary);
    }
    &:is(.docs-material-button-active, :active) {
      background-color: var(--ddocs-primary-pressed);
      border: 1px solid var(--ddocs-outline);
      transition: none;
    }
    &.docs-material-button-collapse-left {
      border-top-left-radius: 0 !important;
      border-bottom-left-radius: 0 !important;
    }
    &.docs-material-button-collapse-right {
      border-top-right-radius: 0 !important;
      border-bottom-right-radius: 0 !important
    }
    &.jfk-button-standard {
      line-height: 38px !important;
    }
    
    &>span.docs-material-button-content {
      line-height: 38px;
    }
  }
  :is(.docs-material-button-hairline-primary.docs-material-button) {
    .outlined-button();
  }
  
  .outlined-exposed-dropdown-menu() {
    
  }
  
  .outlined-text-field(@height: 48px) { // Material defaults to 56px, but that’s huuuge especially if there’s a lot of them
    background-color: transparent;
    border: 1px solid var(--ddocs-outline);
    border-radius: 4px;
    box-sizing: border-box;
    caret-color: var(--ddocs-primary);
    color: var(--ddocs-on-surface);
    font-size: 1rem;
    height: @height;
    padding: 16px;
    transition: var(--off);
    &.goog-flat-menu-button-disabled {
      border-color: var(--ddocs-outline);
    }
    &:hover:not(.goog-flat-menu-button-disabled) {
      border-color: var(--ddocs-on-surface);
      transition: var(--on);
    }
    &:focus, 
    &:hover:focus {
      border-color: var(--ddocs-primary);
      border-width: 1px;
      box-shadow: inset 0 0 0 1px var(--ddocs-primary); // This way there is no shifting of input text. 
      padding: 16px;
      transition: var(--on);
    }
    
    &::selection {
      background-color: var(--ddocs-primary);
      color: var(--ddocs-on-primary);
    }
    &::placeholder {
      color: var(--ddocs-on-surface-variant);
      opacity: 100%;
    }
    
    &.goog-flat-menu-button { // Menu buttons are now text fields with a dropdown arrow
      gap: 1rem;
      margin: 0;
      text-align: left;
      &.docs-flatcolormenubutton .goog-flat-menu-button-caption {
        border-color: var(--ddocs-outline);
      }
      & .goog-flat-menu-button-caption { 
        color: var(--ddocs-on-surface);
        font-size: 1rem;
      }
      & .goog-flat-menu-button-dropdown {
        filter: var(--white-icons);
        flex: none;
        height: 18px;
        transition: transform 0.2s;
        width: 18px;
      }
    } 
  }
  
  @media (prefers-reduced-motion) {
    .goog-flat-menu-button .goog-flat-menu-button-dropdown {
      transition: transform 0s !important;
    }
  }
  
  .radio-button() {
    align-items: center;
    cursor: pointer;
    display: flex;
    gap: 0.5rem;
    
    & .jfk-radiobutton-radio {
      border-color: var(--ddocs-on-surface-variant);
      border-width: 0.125rem;
      display: grid;
      height: 1.25rem;
      place-items: center;
      position: static;
      transition: var(--off);
      width: $height;
      
      &::before {
        background-color: transparent;
        border-radius: 50%;
        content: "";
        height: 2.55rem;
        position: absolute;
        transition: var(--off);
        width: $height;
        z-index: -1;
      }
      
      &::after {
        background-color: transparent;
        border: none;
        border-radius: 50%;
        content: "";
        height: 1rem;
        left: unset;
        position: static;
        top: unset;
        transform: scale(20%);
        transition: transform 0.25s, var(--off);
        width: $height;
      }
    }
    
    & .jfk-radiobutton-label {
      color: var(--ddocs-on-surface);
      cursor: pointer;
      margin: 0;
      
      &>label {
        cursor: pointer;
      }
    }
    
    &:is(.jfk-radiobutton-hover, :hover)>.jfk-radiobutton-radio {
      border-color: var(--ddocs-on-surface);
      transition: var(--on);

      &::before {
        background-color: var(--ddocs-on-surface-hover);
        transition: var(--on);
      }
    }
    &.jfk-radiobutton-focused>.jfk-radiobutton-radio {
      border-color: var(--ddocs-on-surface);
      
      &::before {
        background-color: var(--ddocs-on-surface-focus);
      }
    }
    &:is(.jfk-radiobutton-active, :active)>.jfk-radiobutton-radio {
      background: none;
      border-color: var(--ddocs-on-surface);
      
      &::before {
        background-color: var(--ddocs-on-surface-pressed);
      }
    }
    &.jfk-radiobutton-disabled {
      cursor: not-allowed;
      opacity: 38%;
      &>.jfk-radiobutton-radio {
        background: none;
        border: 2px solid var(--ddocs-on-surface);
      }
      &>.jfk-radiobutton-label {
        cursor: inherit;
        &>label {
          cursor: inherit;
        }
      }
    }
    &.jfk-radiobutton-checked {
      &>.jfk-radiobutton-radio {
        border-color: var(--ddocs-primary) !important;
        
        &::after {
          background-color: var(--ddocs-primary);
          border: none;
          height: 1rem;
          transform: scale(65%);
          width: $height;
        }
      }
      
      &.jfk-radiobutton-hover>.jfk-radiobutton-radio::before {
        background-color: var(--ddocs-primary-hover);
      }
      &.jfk-radiobutton-focused>.jfk-radiobutton-radio::before {
        background-color: var(--ddocs-primary-focus);
      }
      &.jfk-radiobutton-active>.jfk-radiobutton-radio::before {
        background-color: var(--ddocs-primary-pressed);
      }
    }
  }
  .docs-sidebar-tile .jfk-radiobutton /* Wasn’t going to copy this into the side panels section */, 
  .jfk-radiobutton {
    .radio-button();
  }
  
  @media (prefers-reduced-motion) {
    .jfk-radiobutton-radio::after {
      transition: transform 0s !important;
    }
  }
  
  .rich-tooltip() {
    background-color: var(--ddocs-surface-container);
    border: none;
    border-radius: 0.75rem;
    box-shadow: 0 1px 8px #0007;
  }
  
  .standard-icon-button(@colour: "grey") {
    border-radius: 50%;
    color: if(@colour = "primary", var(--ddocs-primary), var(--ddocs-on-surface));
    transition: var(--off);
    user-select: none;
    &:not(.goog-toolbar-button-checked) /* Also works for buttons that can’t be selected */ {
      background-color: transparent;
      &:is(.jfk-button-disabled) {
        background: none !important;
      }
      &:is(.docs-material-button-hover, .jfk-button-hover, :hover) {
        background-color: var(--ddocs-on-surface-variant-hover);
        transition: var(--on);
      }
      &:is(.jfk-button-focused, :focus) {
        background-color: var(--ddocs-on-surface-variant-focus);
        outline: none;
        transition: var(--on);
      }
      &:is(.goog-flat-button-active, .jfk-button-active, :active), 
      &:is(.jfk-button-checked) /* “Selected”, to use m3 terms */ {
        background-color: var(--ddocs-on-surface-variant-pressed);
      }
      
      & .docs-icon-img when (@colour = "grey") {
        filter: var(--whiter-icons);
      }
      & .docs-icon-img when (@colour = "primary") {
        filter: var(--ddocs-on-primary-container-icon);
      }
      & .docs-material-button-ripple-element {
        background-color: var(--ddocs-on-surface-variant-pressed);
      }
    }
    &.goog-toolbar-button-checked {
      background-color: var(--ddocs-primary-container);
      &:hover, 
      &:focus {
        background-color: var(--ddocs-on-primary-container-hover);
        transition: var(--on);
      }
      &:active {
        background-color: var(--ddocs-on-primary-container-pressed);
      }
      
      & .docs-icon-img {
        filter: var(--ddocs-on-primary-container-icon) saturate(30%) brightness(150%);
      }
    }
  }
  
  .suggestion-chip() {
    background-color: transparent;
    border-color: var(--ddocs-outline);
    box-sizing: border-box;
    color: var(--ddocs-on-surface-variant);
    border-radius: 0.5rem;
    font-weight: 500;
    line-height: $height;
    height: 2rem;
    padding: 0 1rem;
    transition: var(--off);
    &.jfk-button-hover {
      background-color: var(--ddocs-on-surface-variant-hover);
      transition: var(--on);
    }
    &-focused {
      background-color: var(--ddocs-on-surface-variant-focus);
      border-color: var(--ddocs-on-surface-variant);
    }
    &.jfk-button-active {
      background-color: var(--ddocs-on-surface-variant-pressed);
    }
  }
  
  .text-button() {
    border-radius: 20px;
    color: var(--ddocs-primary);
    font-size: 0.875rem;
    height: 40px;
    line-height: 40px;
    padding: 0 12px;
    transition: var(--off);
    &:is(.jfk-button-disabled) {
      color: var(--ddocs-on-surface);
      opacity: 38%;
    }
    &:is(.docs-material-button-hover, .goog-flat-button-hover, .jfk-button-hover) {
      background-color: var(--ddocs-primary-hover);
      transition: var(--on);
    }
    &:is(.docs-material-button-focused, .goog-flat-button-focused, .jfk-button-focused) {
      background-color: var(--ddocs-primary-focus);
      transition: var(--on);
    }
    &:is(.goog-flat-button-active, .jfk-button-active) {
      background-color: var(--ddocs-primary-pressed);
    }
    
    &:is(.docs-material-button-text-default) /* Fancy buttons with ripple effect */ {
      &>.docs-material-button-content {
        color: inherit;
      }
      &>.docs-material-button-ripple-element {
        background-color: var(--ddocs-primary-pressed);
      }
    } 
    
    &:has(/*.kix-citations-flat-button-icon*/) /* Button with icon */ {
      padding: 0 16px 0 12px;
    }
  }
  
  .toggle-button() {
    
  }
  
  .docs-grille-gm3 #docs-chrome:not(.docs-hub-chrome) /* Top bar */ {
    background: none;
    border-bottom-color: transparent;
    transition: background-color 0.1s;
    &.docs-toolbar-scrolled, 
    &.docs-toolbar-scrolled .docs-titlebar-buttons-view-mode {
      background-color: var(--ddocs-surface-container) !important;
    }
    
    & #docs-titlebar #docs-title-widget /* File name */ {
      & #docs-title-input-label-inner {
        visibility: hidden;
      }
      & input.docs-title-input {
        color: var(--ddocs-on-background);
        transition: var(--off);
        visibility: visible !important;
        &:hover {
          border-color: var(--ddocs-outline);
          transition: var(--on);
        }
        &:focus {
          border: 1px solid var(--ddocs-primary) !important;
          box-shadow: inset 0 0 0 1px var(--ddocs-primary);
          margin: 0;
        }
      }
    }
    & #docs-parent-collections-container-outer /* “in My Drive,” etc. */ {
      & .docs-parent-collections-container-prefix, 
      & .docs-parent-collections-container-text /* “in” */ {
        color: var(--ddocs-on-surface-variant);
      }
      & .docs-parent-collections-container /* Click target */ {
        border-radius: 2px;
        transition: var(--off);
        &:hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
      }
      & .docs-parent-collections-container-icon>.docs-icon-img {
        filter: var(--white-icons);
      }
      & .docs-parent-collections-container-folder-name {
        color: var(--ddocs-on-surface);
      }
    }
    
    & #docs-titlebar+.docs-titlebar-buttons /* Changelog, comments, share, &c. */ {
      background-color: transparent;
      &.docs-titlebar-buttons-view-mode {
        background: none !important;
      }
      
      & .jfk-button-standard /* Changelog and comments buttons */ {
        .standard-icon-button();
      }
      & .docs-meet-in-editors-entrypoint-container #docs-meet-in-editors-entrypointbutton.goog-flat-menu-button /* Google Meet button */ {
        .standard-icon-button();
        border-radius: 20px;
        &>.goog-flat-menu-button-dropdown {
          border-color: var(--ddocs-on-background) transparent;
        }
        &.goog-flat-menu-button-open {
          background-color: var(--ddocs-on-background-pressed) !important;
        }
      }
      & .docs-revisions-new-changes-badge /* Blue dot on recent changes button */, 
      & .docs-chat-badge /* Blue dot on chat button */ {
        background-color: var(--ddocs-secondary);
      }
      &>#titlebar-mode-indicator-container>.kix-titlebar-mode-switcher {
        border-color: var(--ddocs-outline);
        transition: var(--off);
        &.docs-material-menu-button-flat-primary-hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
        &.docs-material-menu-button-flat-primary-focused {
          background-color: var(--ddocs-on-surface-focus);
        }
        
        & .docs-icon-visibility-24 {
          filter: var(--whiter-icons);
        }
        & svg.docs-material-menu-button-flat-primary-dropdown-icon>path {
          fill: var(--ddocs-on-surface) !important;
        }
      }
      & .titlebar-request-access-button {
        .outlined-button();
        &>.docs-material-button-content {
          color: var(--ddocs-secondary);
        }
      }
      &>#docs-script-button-bar>.jfk-button /* Turn In button */ {
        .outlined-button();
        box-sizing: border-box;
        font-size: 14px;
        height: 40px !important;
        text-transform: unset;
      }
      &>#docs-titlebar-share-client-button>.jfk-button-action /* Share button */ {
        .filled-tonal-button();
        &>.scb-button-icon {
          filter: hue-rotate(180deg) invert(100%) brightness(90%);
        }
      }
    }
    
    & .docs-titlebar-badges /* Star, Move, Status icons */ {
      & .docs-titlebar-badge:not(.docs-save-indicator /* This button’s weird */) {
        .standard-icon-button();
        &.docs-titlebar-badge-selected {
          background-color: var(--ddocs-on-surface-variant-pressed);
        }
        &#docs-star {
          &.goog-control-hover {
            background-color: var(--ddocs-primary-hover);
          }
          &.goog-control-focused {
            background-color: var(--ddocs-primary-focus);
          }
          &.goog-control-active {
            background-color: var(--ddocs-primary-pressed);
          }
          & .docs-icon-star-filled-20-blue600 {
            filter: none;
            filter: var(--ddocs-primary-icon);
          }
        }
      }
      & #docs-save-indicator-badge {
        & .docs-save-indicator-icon {
          transition: var(--off);
        }
        &.goog-control-hover .docs-save-indicator-icon {
          background-color: var(--ddocs-on-surface-variant-hover);
          transition: var(--on);
        }
        &.goog-control-focused .docs-save-indicator-icon {
          background-color: var(--ddocs-on-surface-variant-focus);
        }
        &.goog-control-active .docs-save-indicator-icon {
          background-color: var(--ddocs-on-surface-variant-pressed);
        }
        & .docs-titlebar-badge-selected .docs-save-indicator-icon {
          background-color: var(--ddocs-on-surface-variant-pressed);
        }
        
        & .docs-icon-img {
          filter: var(--whiter-icons);
        }
      }
      & .docs-save-indicator-caption /* “Saved to Drive, etc” */ {
        color: var(--ddocs-on-background);
      }
    }
    
    & #docs-menubar>.goog-control /* Menubar: “File”, “Edit”, &c. */ {
      color: var(--ddocs-on-background);
      transition: var(--off);
      &.goog-control-hover {
        background-color: var(--ddocs-on-background-hover);
        transition: var(--on);
      }
      &:focus, 
      &.goog-control-open {
        background-color: var(--ddocs-on-background-focus);
        transition: var(--on);
      }
    }
  }
  
  .docs-grille-gm3 #docs-chrome-cover-container .docs-revisions-chromecover-content-color-default /* Version history top bar showing the edit time */ {
    background: none;
    color: var(--ddocs-on-surface);
    
    & .docs-revisions-chromecover-titlebar-button-back-container {
      margin-right: 1rem;
      
      & .docs-revisions-chromecover-titlebar-button-back {
        .standard-icon-button();
        display: inline-grid;
        height: 2.5rem;
        place-items: center;
        width: $height;
      }
    }
    
    & .docs-revisions-chromecover-titlebar-button-action {
      .filled-tonal-button();
      background-color: var(--ddocs-primary-container);
      color: var(--ddocs-on-primary-container);
      transition: var(--off);
      &.goog-flat-button-hover {
        background-color: var(--ddocs-on-primary-container-hover);
        transition: var(--on);
      }
      &.goog-flat-button-focused {
        background-color: var(--ddocs-on-primary-container-focus);
        filter: none;
      }
      &.goog-flat-button-active {
        background-color: var(--ddocs-on-primary-container-pressed);
      }
    }
  }
  
  .docs-grille-gm3 .docs-docos-activitybox /* Comment box (from the comments button in the top right) */ {
    background-color: var(--ddocs-surface-container-low);
    
    & .docos-streampane-header {
      background-color: var(--ddocs-surface-container-high);
      border: none;
      
      & .docos-comment-text.docos-comment-header-title {
        color: var(--ddocs-on-surface);
      }
      
      & .docos-filter-settings .docs-material-menu-button-flat-default {
        background: none;
        border-color: var(--ddocs-outline);
        .filter-chip();
        
        &+.goog-menu .goog-option-selected {
          .checkmark-fix();
          & .goog-menuitem-checkbox {
            left: 9px;
          }
        }
      }
      
      & .docs-material-button {
        .standard-icon-button();
        
        & .docos-search-comments-icon-path {
          fill: currentColor;
        }
      }
      & .docos-new-comment-button {
        .standard-icon-button();
        
        & .docos-new-comment-icon-path {
          fill: currentColor;
        }
      }
    }

    & .docos-streampane-searchbar-container {
      background-color: var(--ddocs-surface-container-high);
      border-bottom: none;
      padding-top: 0;
      
      & .docos-streampane-searchbar input {
        background-color: var(--ddocs-surface-container-highest);
        border-color: $background-color;
        border-radius: 18px;
        color: var(--ddocs-on-surface);
        transition: var(--off);
        &:hover {
          border-color: var(--ddocs-on-surface-variant);
          transition: var(--on);
        }
        &:focus {
          border-color: var(--ddocs-primary);
          box-shadow: inset 0 0 0 1px var(--ddocs-primary);
        }
      }
      
      & .docs-material-button {
        .standard-icon-button();
        padding: 0 6px;
      }
    }
    
    & #docos-stream-view {
      color: var(--ddocs-on-surface);
      scrollbar-color: var(--ddocs-outline) transparent;
      
      &>.docos-streamdocoview {
        background-color: var(--ddocs-surface-container);
        outline: none;
        &>.docos-streamdocoview-header-container {
          background: none;
          // transition: var(--off); Unfortunately this led to a bright flash when you opened comment history for the first time after reloading. 
        }
        &:hover {
          &>.docos-streamdocoview-header-container {
            background-color: var(--ddocs-on-surface-hover);
            transition: var(--on);
          }
        }
        &.docos-docoview-active {
          &>.docos-streamdocoview-header-container {
            background-color: var(--yellow-ripple);
          }
        }
        &.docos-docoview-resolved {
          background-color: var(--ddocs-surface-container);
        }
        
        & :is(.streamdocoview-header-quote-expand-button, .streamdocoview-header-quote-collapse-button) .docs-material-button /* Button to expand/collapse comment with many replies */ {
          .standard-icon-button();
        }
        
        & .docos-streamdocoview-author, .docos-streamdocoview-body, .docos-streamreplyview-body {
          color: var(--ddocs-on-surface);
        }
        & .docos-streamdocoview-timestamp, .docos-action-text {
          color: var(--ddocs-on-surface-variant);
          opacity: 1;
        }
        & .docos-replyview-resolve-button {
          .standard-icon-button(@colour: "primary");
        }
        & .docos-docomenu-dropdown {
          .standard-icon-button();
          
          & .docos-icon-overflow-three-dots::before {
            filter: invert() brightness(95%);
          }
        }
        & .docos-streamdocoview-input-pane .docos-input-textarea, .docos-input-textarea {
          background-color: var(--ddocs-surface-container-highest);
          border-color: $background-color;
          caret-color: var(--ddocs-primary);
          color: var(--ddocs-on-surface);
          outline: none;
          transition: border 0.1s ease;
          &:hover {
            border-color: var(--ddocs-on-surface-variant);
            transition: var(--on);
          }
          &:focus {
            border-color: var(--ddocs-primary);
            box-shadow: inset 0 0 0 1px var(--ddocs-primary);
          }
          &:empty::before {
            color: var(--ddocs-on-surface-variant);
          }
        }
        & .docos-input-buttons-post {
          .filled-button();
        }
        & .docos-input-cancel {
          .outlined-button();
          color: var(--ddocs-primary) !important;
        }
      }
    }
    
    &.docs-docos-activitybox-round-corners .streampane-dragger {
      border-color: var(--ddocs-outline-variant);
      border-radius: 0 0 8px 8px;
      transition: var(--off);
      &:hover {
        background-color: var(--ddocs-on-surface-hover);
        transition: var(--on);
      }
    }
  }
  
  .docs-grille-gm3 #docs-chrome #docs-toolbar-wrapper {
    background-color: var(--ddocs-surface-container);
  }
  .docs-grille-gm3 .jfk-bubble.docs-toolbar-more-bubble {
    background-color: transparent;
    & .docs-toolbar-more-toolbar {
      background-color: var(--ddocs-surface-container-high);
    }
  }
  :is(.docs-grille-gm3, .docs-grille-gm3.docs-body-pageless) #docs-align-palette {
    background-color: var(--ddocs-surface-container-high);
  }
  
  .docs-grille-gm3 #docs-chrome #docs-toolbar-wrapper #docs-omnibox-toolbar:not(.assisted-actions) .docs-omnibox-autocomplete /* “Search the menus (Alt+/) */ {
    // Google’s trying something out with the .assisted-actions for some users which will make a command search button persistent on the toolbar.
    margin: 4px 0 4px -6px;
    padding-left: 0;
    & input.docs-omnibox-input {
      background-color: var(--ddocs-surface-container-highest);
      color: var(--ddocs-on-surface-variant);
      &[aria-expanded="true"] {
        border-radius: 14px 14px 0 0;
      }

      &::placeholder {
        color: var(--ddocs-on-surface-variant);
      }
      &::selection {
        background-color: var(--ddocs-primary);
        color: var(--ddocs-on-primary);
      }
    }
  }
  .docs-gm #docs-omnibox-toolbar.assisted-actions {
    .docs-icon-search-20 {
      filter: var(--whiter-icons);
    }
    .docs-omnibox-input {
      background-color: var(--ddocs-surface-container-highest);
      color: var(--ddocs-on-surface);
      &::placeholder {
        color: var(--ddocs-on-surface-variant);
        opacity: 1;
      }
    }
    
    @media screen and (max-width: 1600px) {
      .docs-omnibox-input {
        background: transparent;
        color: var(--ddocs-on-surface);
        &:hover {
          background-color: var(--ddocs-on-surface-variant-hover);
        }
        &:focus-within {
          background-color: var(--ddocs-surface-container-highest);
        }
      }
    }
  }
  
  .docs-grille-gm3 #docs-chrome #docs-toolbar-wrapper /* Toolbar: undo, bold, &c. */, 
  .docs-grille-gm3 .docs-toolbar-more-bubble .docs-toolbar-more-toolbar /* Toolbar extension */,
  .docs-grille-gm3 #docs-align-palette {

    & .goog-toolbar-separator {
      border-color: var(--ddocs-outline-variant);
    }
    & .goog-toolbar-button { // Yep. Custom implementation of buttons because these are not standard icon buttons.
      color: var(--ddocs-on-surface);
      transition: var(--off);
      &:not(.goog-toolbar-button-checked) /* Also works for buttons that can’t be selected */ {
        background-color: transparent;
        &.goog-toolbar-button-hover, 
        &.goog-toolbar-button-focus /* Not a mistake, https://m3.material.io/components/icon-buttons/specs said so */ {
          background-color: var(--ddocs-on-surface-variant-hover);
          transition: var(--on);
        }
        &.goog-toolbar-button-active {
          background-color: var(--ddocs-on-surface-variant-pressed);
        }

        & .docs-icon-img {
          filter: var(--whiter-icons);
        }
      }
      &.goog-toolbar-button-checked /* “selected”, to use m3 terminology */ {
        background-color: var(--ddocs-primary-container);
        transition: var(--off);
        &.goog-toolbar-button-hover {
          background-color: var(--ddocs-on-primary-container-hover);
          transition: var(--on);
        }
        &.goog-toolbar-button-focused {
          background-color: var(--ddocs-on-primary-container-focus);
          transition: var(--on);
        }
        &.goog-toolbar-button-active {
          background-color: var(--ddocs-on-primary-container-pressed);
        }

        & .docs-icon-img {
          filter: var(--ddocs-on-primary-container-icon);
        }
      }
    }
    & .goog-toolbar-combo-button /* Combo buttons are the menu buttons you can type in (zoom and font size) */ {
      background-color: transparent;
      border-width: 1px !important;
      caret-color: var(--ddocs-primary);
      color: var(--ddocs-on-surface);
      transition: var(--off);
      &#fontSizeSelect.docs-font-size-inc-dec-combobox:not(.goog-toolbar-combo-button-hover, .goog-toolbar-combo-button-focus, .goog-toolbar-combo-button-open) {
        border-color: var(--ddocs-outline) !important;
      }
      &.goog-toolbar-combo-button-hover, 
      &.goog-toolbar-combo-button-focus {
        background-color: var(--ddocs-on-surface-variant-hover);
        transition: var(--on);
        &#fontSizeSelect {
          border-color: var(--ddocs-on-surface) !important;
        }
      }
      &.goog-toolbar-combo-button-open {
        background-color: var(--ddocs-on-surface-variant-pressed);
        border-color: var(--ddocs-primary) !important;
        &#zoomSelect {
          margin: 5px 1px;
        }
        &#fontSizeSelect {
          margin: 0 3px;
        }
        &:focus-within {
          border-color: var(--ddocs-primary) !important;
          box-shadow: inset 0 0 0 1px var(--ddocs-primary);
        }
        & input.goog-toolbar-combo-button-input::selection {
          background-color: var(--ddocs-primary);
          color: var(--ddocs-on-primary);
        }
      }
      & .goog-toolbar-combo-button-input {
        color: currentColor;
      }
      & .docs-icon-img {
        filter: var(--whiter-icons);
      }
    }
    & .goog-toolbar-menu-button { 
      background-color: transparent;
      color: var(--ddocs-on-surface);
      transition: var(--off);
      &:is(#textColorButton, #bgColorButton) .goog-color-menu-button-indicator { // Inverts the colour swatches below the font colour and highlight colour buttons
        filter: @document-filter;
        & .docs-icon-img {
          filter: if(@document-filter = var(--darkfilter), invert(100%) hue-rotate(180deg) brightness(0%), brightness(600%));
          filter: if(@document-filter = none, brightness(310%), );
        }
      }
      &.goog-toolbar-menu-button-hover, 
      &.goog-toolbar-menu-button-focus,  {
        background-color: var(--ddocs-on-surface-variant-hover);
        transition: var(--on);
      }
      &.goog-toolbar-menu-button-active, 
      &.goog-toolbar-menu-button-open {
        background-color: var(--ddocs-on-surface-variant-pressed);
      }

      &#docs-toolbar-mode-switcher /* Editing, suggesting, viewing */ {
        & .goog-toolbar-menu-button-caption {
          color: var(--ddocs-on-surface);
        }
        & .goog-toolbar-menu-button-dropdown {
          border-top-color: var(--ddocs-on-surface);
        }

        &.suggest-mode {
          background-color: var(--ddocs-primary-container);
          transition: var(--off);
          &.goog-toolbar-menu-button-hover {
            background-color: var(--ddocs-on-primary-container-hover);
            transition: var(--on);
          }
          &.goog-toolbar-menu-button-focused {
            background-color: var(--ddocs-on-primary-container-focus);
            transition: var(--on);
          }
          &.goog-toolbar-menu-button-active {
            background-color: var(--ddocs-on-primary-container-pressed);
          }

          & .goog-toolbar-menu-button-caption {
            color: var(--ddocs-on-primary-container);
          }
          & .goog-toolbar-menu-button-dropdown {
            border-top-color: var(--ddocs-on-primary-container);
          }
          & .docs-icon-img {
            filter: var(--ddocs-on-primary-container-icon);
          }
        }
      }
      & .docs-icon-img {
        filter: var(--whiter-icons);
      }
    }
  }
  
  #docs-toolbar-iterator-label /* Number of edits (in version history, on the toolbar) */ {
    color: var(--ddocs-on-surface);
  }
  
  .docs-omnibox-autocomplete .ac-renderer /* Command search results */ {
    background-color: var(--ddocs-surface-container-highest);
    border-radius: 0 0 14px 14px;
    &>.ac-row {
      & .docs-icon.goog-option-selected {
        background: no-repeat url(//ssl.gstatic.com/docs/common/material_common_sprite477.svg) -3px -3484px;
        filter: var(--ddocs-primary-icon);
      }
      & .docs-icon-img:not(.docs-icon-editors-ia-article-document-blue, .docs-icon-editors-ia-spreadsheet-green, .docs-icon-editors-ia-apps-script) {
        filter: var(--whiter-icons);
      }
      & .goog-menuitem {
        color: var(--ddocs-on-surface);
      }
      & .goog-menuitem-accel {
        color: var(--ddocs-on-surface-variant);
      }
      
      &.ac-active {
        background-color: var(--ddocs-on-surface-hover);
      }
    }
  }
  .docs-labelinputmenuitem.goog-menuitem-highlight .goog-menuitem-content {
    color: var(--ddocs-on-surface);
  }
  .docs-labelinputmenuitem.goog-menuitem-highlight .ac-renderer {
    border-radius: 0 0 8px 8px;
  }
  
  body.docs-grille-gm3 #docs-equationtoolbar {
    background: none;
    border-bottom-color: var(--ddocs-outline-variant);
    & .goog-toolbar-button, .goog-toolbar-menu-button {
      background-color: transparent;
      color: var(--ddocs-on-surface);
      transition: var(--off);
      &.goog-toolbar-button-disabled {
        color: var(--ddocs-on-surface) !important;
      }
      &:is(.goog-toolbar-button-hover, .goog-toolbar-menu-button-hover) {
        background-color: var(--ddocs-on-surface-hover);
        transition: var(--on);
      }
      &:is(.goog-toolbar-button-active, .goog-toolbar-menu-button-active, .goog-toolbar-menu-button-open) {
        background-color: var(--ddocs-on-surface-pressed);
      }
    }
    & .goog-toolbar-menu-button {
      width: 7ch;
      & .goog-toolbar-menu-button-caption {
        padding-top: 0;
      }
      
      & .kix-equation-toolbar-icon {
        background: none;
        &::after {
          color: var(--ddocs-on-surface);
        }
      }
      & .kix-equation-toolbar-icon-character::after {
        content: "αβΔ";
      }
      & .kix-equation-toolbar-icon-misc::after {
        content: "×÷∃";
      }
      & .kix-equation-toolbar-icon-relation::after {
        content: "<≠⊃";
      }
      & .kix-equation-toolbar-icon-integral::after {
        content: "√()𝑥ʸ";
      }
      & .kix-equation-toolbar-icon-arrow::after {
        content: "←↑⇒";
      }
      
      & .docs-gm-arrow.goog-toolbar-menu-button-dropdown {
        filter: var(--whiter-icons);
        margin-left: 4px;
        &>.docs-icon {
          transition: transform 0.2s;
        }
      }
      &.goog-toolbar-menu-button-open .docs-gm-arrow>.docs-icon {
        transform: rotate(180deg);
      }
    }
    
    & #hide-equation-toolbar-button {
      .standard-icon-button();
      &.goog-toolbar-button-active {
        background-color: var(--ddocs-on-surface-pressed) !important;
      }
      & .goog-toolbar-button-outer-box, .goog-toolbar-button-inner-box {
        height: 100%; width: 100%;
      }
    }
  }  
  @media (prefers-reduced-motion) {
    #docs-equationtoolbar .goog-toolbar-menu-button-open .docs-gm-arrow>.docs-icon {
      transform: none !important;
    }
  }
  #docs-toolbar-wrapper:not(.docs-toolbar-margin-collapsed)+#docs-equationtoolbar {
    margin-bottom: 4px;
  }
  @supports selector(:has(+#docs-equationtoolbar:not([style*="display: none;"]))) and selector(::-webkit-scrollbar-track) {
    // Using the + selector means it’s incompatible with Firefox for now. This is deliberate. This code block visually merges the main toolbar with the equation toolbar and requires that the :has() selector responds immediately to changes in the webpage, which Firefox does not do. I didn’t have to use the + selector but then the main toolbar would look weird and not respond immediately to the equation toolbar appearing and disappearing. 
    #docs-bars:has(#docs-equationtoolbar:not([style*="display: none;"]))>#docs-toolbar-wrapper {
      border-bottom: 1px solid var(--ddocs-outline-variant);
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
      margin-bottom: 0;
    }
    body.docs-grille-gm3 .docs-material #docs-equationtoolbar {
      border: none;
      padding-left: 16px;
      padding-right: 16px;
      
      &::before {
        background-color: var(--ddocs-surface-container);
        border-radius: 0 0 24px 24px;
        content: "";
        height: 100%;
        left: 16px;
        position: absolute;
        right: 16px;
      }
      
      &>#insert-equation-button {
        font-family: Google Sans,Roboto,sans-serif;
        font-size: 14px;
        margin-left: 11px;
      }
      &>#hide-equation-toolbar-button {
        margin-right: 13px;
      }
    }
    #kix-appview-editor, .kix-appview-editor {
      width: 100%;
    }
  }
  
  body.docs-gm.docs-grille-gm3 :is(#docs-editor-container, #docs-editor) /* Your document */, 
  body.docs-gm:not(.docs-body-pageless) .kix-appview-editor {
    background: none !important;
  }
  body.docs-gm.docs-body-pageless .kix-appview-editor { // A whole load of pageless mode tweaks
    &[style*="background-image"] when (@respect-pageless-document-color = 0) or not (@document-filter = var(--darkfilter)) {
      background-image: linear-gradient(var(--ddocs-outline-variant), var(--ddocs-outline-variant)), linear-gradient(var(--ddocs-background), var(--ddocs-background)) !important; // Hijack the way Google Docs makes the border between the pageless document and comments area, if there are comments.
    }
    &[style*="background-image: linear-gradient(rgb(248, 249, 250), rgb(248, 249, 250)), linear-gradient(rgb(199, 199, 199), rgb(199, 199, 199)), linear-gradient(rgb(255, 255, 255), rgb(255, 255, 255))"] when (@respect-pageless-document-color = 0) or not (@document-filter = var(--darkfilter)) {
      background-image: linear-gradient(var(--ddocs-background), var(--ddocs-background)), linear-gradient(var(--ddocs-outline-variant), var(--ddocs-outline-variant)), linear-gradient(var(--ddocs-background), var(--ddocs-background)) !important;
    }
    & when not (@document-filter = none) and not (@document-filter = var(--darkfilter)) /* Seems like Less is incapable of detecting (@document-filter = contrast(80%) brightness(90%)) correctly so I’m just detecting that it’s not the other two options instead */ and (@respect-pageless-document-color = 0) {
      background-color: #cecece !important; // Pageless, dim, don’t respect page background colour. Important because this is set in Google Docs with the style attribute.
      scrollbar-color: var(--ddocs-outline) transparent;
    }
    & when (@document-filter = var(--darkfilter)) and (@respect-pageless-document-color = 0) {
      background-color: var(--ddocs-background) !important; 
    }
    &::before when not (@document-filter = none) and (@respect-pageless-document-color = 1) { // Puts a child element immediately in front of the .kix-appview-editor, which is colored by the page color. It’s laggy (at least on Firefox) but it does respect the page color. We don’t have the luxury of directly changing the backgroud-color of .kix-appview-editor according to the original colour like Dark Reader does. 
      backdrop-filter: @document-filter; // Pageless, respect page background colour. 
      content: "";
      display: block;
      height: 100%;
      width: 100%;
      pointer-events: none; // Allows the user to click through this filter to access the document’s scrollbar. 
      position: fixed; 
    }
  }
  
  body.docs-gm.docs-grille-gm3 .kix-appview-editor {
    scrollbar-color: var(--ddocs-outline) transparent;
    
    & .kix-page-paginated /* Pages got an outline since m3 */ {
      outline-color: var(--ddocs-outline-variant);
    }
    
    & .kix-paginateddocumentplugin /* Might be obsolete */,
    & .kix-canvas-tile-content /* Actual document itself */,
    & .kix-cursor .kix-cursor-caret {
      filter: @document-filter;
    }
    
    /* Fix to un-unvert images (From my understanding, Google Docs uses a canvas to render the document on Chrome, so this only works on Firefox where Google Docs uses SVG instead.) */
    .kix-canvas-tile-content image,
    svg.kix-embeddedobject-image,
    .kix-embeddedobject-image image {
      filter: if((@document-filter = var(--darkfilter)), brightness(80%) invert(100%) hue-rotate(180deg), none);
    }
  }
  
  body.docs-grille-gm3 #kix-appview :is(#kix-horizontal-ruler-container, #kix-vertical-ruler-container) /* Rulers */ {
    &>:is(#kix-horizontal-ruler, #kix-vertical-ruler) {
      background: none !important;
      border-color: var(--ddocs-outline-variant);
      & .docs-ruler-background-inner /* Length that is within margins */ {
        background: none !important;
        border-bottom-color: var(--ddocs-outline);
      }
      & .docs-ruler-face-inner :not(.docs-ruler-division-active) /* Outside margins */ {
        &.docs-ruler-face-first-division>.docs-ruler-face-number /* Numbers */ {
          color: var(--ddocs-on-surface-variant);
          &+.docs-ruler-face-minor-division {
            border-color: var(--ddocs-outline);
          }
        }
        &.docs-ruler-face-minor-division, 
        &.docs-ruler-face-major-division /* Markings */ {
          border-color: var(--ddocs-outline);
        }
      }
      & .docs-ruler-face-inner .docs-ruler-division-active /* Within margins */ {
        &.docs-ruler-face-first-division>.docs-ruler-face-number /* Numbers */ {
          color: var(--ddocs-on-surface-variant);
          &+.docs-ruler-face-minor-division {
            border-color: var(--ddocs-outline);
          }
        }
        &.docs-ruler-face-minor-division, 
        &.docs-ruler-face-major-division /* Markings */ {
          border-color: var(--ddocs-outline);
        }
      }
      & .docs-material .docs-icon-img /* Tab stop icons */ {
        filter: brightness(150%) saturate(50%) hue-rotate(10deg);
      }
      & .docs-ruler-guide-tooltip /* Tab stop position tooltip is not a .jfk-tooltip */ {
        background-color: var(--ddocs-surface-container-highest);
        color: var(--ddocs-on-surface-container);
      }
      & .docs-ruler-contributed-dragger-container /* Table border handles (in the ruler) */ {
        background-color: var(--ddocs-surface-container);
        border-color: $background-color;
        & .docs-icon-img {
          filter: invert(100%) brightness(150%);
        }
      }
    }
    
    & #kix-vertical-ruler::before /* The vertical ruler has this thing to hide the horizontal ruler’s too-long bottom border. */ {
      background: none;
    }
  }
  
  body.docs-gm.docs-grille-gm3 #docs-editor .left-sidebar-container {
    &.pageless-format {
      background: var(--ddocs-background);
      box-shadow: none; // Google used a 1px-wide box-shadow as a line between the TOC and pageless document. It didn’t appear in the right colour because it got @document-filtered.
      border-right: 1px solid var(--ddocs-outline-variant); // This new actual outline won’t get filtered. 
    }
    
    & .navigation-widget-hat>.navigation-widget-hat-close /* ← button */ {
      & .navigation-widget-hat-close-button-outer-box {
        transition: var(--off);
      }
      &:is(.goog-flat-button-hover, .goog-flat-button-focused) .navigation-widget-hat-close-button-outer-box {
        background-color: var(--ddocs-on-surface-variant-hover);
        transition: var(--on);
      }
      &.goog-flat-button-active .navigation-widget-hat-close-button-outer-box {
        background-color: var(--ddocs-on-surface-variant-pressed);
        transition: var(--on);
      }
      
      & .docs-icon-img {
        filter: var(--whiter-icons);
      }
    }
    & #navigation-widget-top-shadow /* Shadow between fixed ← button and summary/TOC */ {
      &::before {
        background-image: linear-gradient(to bottom, var(--ddocs-background),transparent);
      }
      &::after {
        display: none;
      }
    }
    & .navigation-widget-content /* Summary and TOC */ {
      scrollbar-color: var(--ddocs-outline) transparent;
      
      & .navigation-widget-smart-summary-container /* Summary */ {
        & #kix-smart-summary-view-header {
          color: var(--ddocs-on-surface);
        }
        & .kix-smart-summary-edit-button, 
        & .kix-smart-summary-add-button-default {
          .standard-icon-button();
          transition: opacity 0.1s ease;
        }
        & .kix-smart-summary-display-summary-text {
          color: var(--ddocs-on-surface);
        }
        & .kix-smart-summary-edit-summary-container textarea {
          border: 2px solid var(--ddocs-primary);
          color: var(--ddocs-on-surface);
          margin: 0 0 0 -10px;
          padding: 8px;
        }
        & .kix-smart-summary-view-separator {
          background-color: var(--ddocs-outline-variant);
        }
      }
      & .navigation-widget-outline-header {
        color: var(--ddocs-on-surface);
      }
      & .navigation-widget-outline-header+.updating-navigation-item-list {
        & .navigation-widget-row-controls .goog-flat-button {
          .standard-icon-button();
          border-radius: 50%;
        }
        & .navigation-widget-empty-content {
          color: var(--ddocs-on-surface-variant);
        }
        & .navigation-item /* TOC items */ {
          &>.navigation-item-level-0 {
            color: var(--ddocs-on-background);
          }
          &>.navigation-item-content:not(.navigation-item-level-0) {
            color: var(--ddocs-on-surface);
          }
          &.location-indicator-highlight div.navigation-item-content {
            color: var(--ddocs-primary);
          }
        }
      }
    }
    & .navigation-widget+.docs-navigation-tab-button {
      & .docs-navigation-tab-button-outer-box {
        transition: var(--off);
      }
      &:is(.docs-navigation-tab-button-hover, .docs-navigation-tab-button-focused) .docs-navigation-tab-button-outer-box {
        background-color: var(--ddocs-on-surface-variant-hover);
        transition: var(--on);
      }
      &.docs-navigation-tab-button-active .docs-navigation-tab-button-outer-box {
        background-color: var(--ddocs-on-surface-variant-pressed);
        transition: var(--on);
      }
      
      & .docs-icon-img {
        filter: var(--white-icons);
      }
    }
    
    &~.kix-documentmetrics-widget /* Word count in the corner */ {
      background-color: var(--ddocs-surface-container);
      border-color: var(--ddocs-background);
      box-shadow: none;
      color: var(--ddocs-on-surface-container);
      &>.docs-material-gm-select-outer-box {
        transition: var(--off);
      }
      &:is(.docs-material-gm-select-hover, .docs-material-gm-select-open)>.docs-material-gm-select-outer-box {
        background-color: var(--ddocs-on-surface-hover);
        transition: var(--on);
      }
      & #kix-documentmetrics-widget-content {
        color: inherit;
      }
      & .docs-material-gm-select-dropdown {
        transform: rotate(-180deg);
        transition: transform 0.2s;
        & .docs-icon-arrow-dropdown {
          filter: var(--whiter-icons);
        }
      }
      &.docs-menu-button-open-above .docs-material-gm-select-dropdown {
        transform: rotate(0deg);
      }
    }
    
    & .docs-revisions-authorwidget /* “Changes by” in version history view */ {
      & .docs-revisions-authorwidget-hat {
        border-bottom-color: var(--ddocs-outline-variant);
      }
    }
  }
  @media (prefers-reduced-motion) {
    .kix-documentmetrics-widget .docs-material-gm-select-dropdown {
      transform: rotate(-180deg) !important;
    }
  }
  .left-sidebar-resizer-ghost-line {
    background-color: var(--ddocs-outline);
    width: 1px;
  }
  
  body.docs-grille-gm3 #kix-appview /* These styles are for things that appear over the document */ {
    & .kix-header-footer-bubble {
      background-color: var(--ddocs-surface-container);
      border-color: $background-color;
      
      &>.kix-header-footer-bubble-description, .kix-header-footer-bubble-checkbox-label {
        color: var(--ddocs-on-surface);
      }
      & .kix-header-footer-bubble-menu-button {
        color: var(--ddocs-primary);
        transition: var(--off);
        &.goog-flat-menu-button-hover {
          background-color: var(--ddocs-primary-hover);
          transition: var(--on);
        }
        &.goog-flat-menu-button-focused {
          background-color: var(--ddocs-primary-focus);
        }
        &.goog-flat-menu-button-open {
          background-color: var(--ddocs-primary-pressed);
        }
        
        & .docs-icon-arrow-dropdown {
          filter: sepia() saturate(127%) hue-rotate(178deg) brightness(229%);
        }
      }
    }
    & .docs-border-selection-button /* The button in the top right corner of selected table cells */ {
      &-normal, 
      &-pressed {
        filter: brightness(70%) contrast(200%) var(--darkfilter);
      }
    }
    
    & .docs-toc-menu-bubble /* Table of contents menu (a TOC in your document) */ {
      background-color: var(--ddocs-surface-container-high);
      border: $background-color;
      
      & .jfk-button {
        .standard-icon-button();
      }
    }
    
    & #docs-link-bubble /* Link previews! Also used for chips */ {
      background-color: var(--ddocs-surface-container-high);
      box-shadow: none;
      color: var(--ddocs-on-surface);
      
      & .docs-icon-calendar, .docs-icon-email, .docs-icon-heading, .docs-icon-web {
        filter: var(--white-icons);
      }
      
      & #docs-linkbubble-link-text /* Blue text, the link */ {
        color: var(--ddocs-primary) !important;
      }
      & #docs-linkbubble-link-text~span>.docs-bubble-button {
        .standard-icon-button();
      }
      & .docs-link-bubble-card-component.single-line-text-card-component span /* Link domain */ {
        color: var(--ddocs-on-surface-variant) !important;
      }
      & .docs-link-bubble-card-component.docs-link-bubble-thumbnail-card-component /* Preview image */ {
        //filter: contrast(80%) brightness(90%);
        & .docs-link-bubble-thumbnail-container {
          background-color: var(--ddocs-surface-container-highest);
          border-color: var(--ddocs-outline-variant);
        }
      }
      & .docs-link-bubble-third-party-privacy-promo-card-component /* Third party chip promo (if you click on a link from a service like Figma and you have the Figma add-on installed */ {
        & img {
          filter: var(--darkfilter);
        }
        & p {
          color: var(--ddocs-on-surface-variant);
          & a {
            color: var(--ddocs-primary) !important;
          }
        }
        & #docs-link-bubble-third-party-privacy-promo-card-component-preview-button {
          .outlined-button();
        }
      }
      & .docs-link-bubble-card-component /* Description and other metadata */ {
        & .docs-icon-img:not(.docs-icon-directions-24) {
          filter: var(--white-icons);
          &.docs-icon-smart-summary {
            filter: var(--whiter-icons);
          }
        }
        & span.docs-link-bubble-text-with-icon, 
        & span.text-card-component-text {
          color: var(--ddocs-on-surface-variant) !important;
        }
        & span.docs-link-bubble-maps-place-card-category, .docs-link-bubble-maps-place-card-address {
          color: var(--ddocs-on-surface-variant);
        }
      }
      
      & .docs-link-bubble-calendar-event-action-card-component, 
      & .docs-link-bubble-maps-place-action-card-component {
        border-top-color: var(--ddocs-outline-variant);
        & .docs-link-bubble-calendar-attach-document, 
        & .docs-link-bubble-maps-directions-button {
          transition: var(--off);
          &:hover {
            background-color: color-mix(in srgb, var(--ddocs-primary), transparent calc(100% - var(--ddocs-hover-state-layer-opacity)));
            transition: var(--on);
          }
          & .docs-icon-img {
            filter: var(--paleblue-icons);
          }
          &:active {
            filter: none;
            filter: var(--whiter-icons);
          }
        }
      }
      
      & .docs-link-bubble-card-component.docs-link-bubble-action-card-component /* “Some collaborators need access to the file”, &c. (File chips that link to files that other collaborators of the document can’t access) */ {
        background-color: var(--ddocs-secondary-container);
        
        &::before /* Just to fill out the rest of the card with blue */ {
          background-color: inherit;
        }
        
        & span.docs-link-bubble-text-with-icon {
          color: var(--ddocs-on-secondary-container) !important;
        }
        
        & div.link-bubble-text-button span.link-bubble-text-button-text /* STOP USING DIVS AND SPANS FOR BUTTONS */ {
          border-radius: 4px;
          transition: var(--off);
          &:hover {
            background-color: var(--ddocs-on-secondary-container-hover) !important;
            transition: var(--on);
          }
          &:focus {
            background-color: var(--ddocs-on-secondary-container-focus) !important;
          }
        }
      }
    }
    
    & .smart-canvas-date-details-bubble /* When you hover on a date chip */ {
      background-color: var(--ddocs-surface-container);
      color: var(--ddocs-on-surface);
      
      &>.smart-canvas-date-details-bubble-body /* Date and time entry */ {
        & .smart-canvas-date-details-bubble-icon {
          filter: var(--white-icons);
        }
        & .smart-canvas-date-details-bubble-edit-field-gm3, 
        & .smart-canvas-time-selection-combo-box-container .goog-combo-button-input {
          .filled-text-field();
        }
      }
      
      & .smart-canvas-date-details-bubble-action-bar {
        border-top-color: var(--ddocs-outline-variant);
        
        &>.smart-canvas-date-details-bubble-book-meeting-button {
          .text-button();
        }
        &>.smart-canvas-date-details-bubble-pattern-picker-button {
          .standard-icon-button();
          & .docs-icon-img {
            filter: none !important;
            filter: var(--paleblue-icons) !important;
          }
          &+.goog-menu {
            background-color: var(--ddocs-surface-container-high);
            & .goog-option-selected {
              .checkmark-fix();
              & .goog-menuitem-checkbox {
                left: 12px;
              }
            }
          }
        }
      }
      
      & .smart-canvas-date-details-bubble-hint-bar {
        background-color: var(--ddocs-primary-container);
        border-radius: 0 0 var(--ddocs-corner-m) var(--ddocs-corner-m);
        color: var(--ddocs-on-primary-container);
        
        &>.smart-canvas-date-details-bubble-hint-button {
          border-radius: 4px;
          transition: var(--off);
          &:hover {
            background-color: var(--ddocs-on-primary-container-hover);
            transition: var(--on);
          }
          &:focus {
            background-color: var(--ddocs-on-primary-container-focus);
          }
        }
      }
    }
    
    & .docs-linkbubble-bubble /* You use this to insert links */ {
      background-color: var(--ddocs-surface-container);
      border: none;
      
      & .docs-link-smartinsertlinkbubble-text-wrapper {
        &>label {
          background-color: var(--ddocs-surface-container);
          box-shadow: none;
          color: var(--ddocs-on-surface-variant);
          padding: 0 4px;
        }
        & .docs-link-smartinsertlinkbubble-text.jfk-textinput {
          .outlined-text-field();
        }
      }
      & .docs-link-smartinsertlinkbubble-toppane {
        height: unset;
        & .docs-smart-link-searchinput-search-container {
          .outlined-text-field();
          align-items: center;
          gap: 16px;
          padding: 0 16px 0 12px;
          &.docs-link-searchinput-search-container-focus {
            border: 1px solid var(--ddocs-primary) !important;
            box-shadow: inset 0 0 0 1px var(--ddocs-primary);
          }

          & .docs-link-smartinsertlinkbubble-search-icon {
            flex: none;
            flex-basis: 24px;
            padding: 0;
            text-align: center;
            &>.goog-inline-block {
              margin: 0;
              & .docs-icon-img {
                filter: var(--whiter-icons);
              }
            }
          }
          & input.docs-link-searchinput-search {
            color: var(--ddocs-on-surface);
            font-size: 1rem;
            padding: 0;
            &::placeholder {
              color: var(--ddocs-on-surface-variant);
              opacity: 100%;
            }
            &::selection {
              background-color: var(--ddocs-primary);
              color: var(--ddocs-on-primary);
            }
          }
        }
        & .docs-link-smartinsertlinkbubble-apply-button {
          .text-button();
          margin: 0;
        } 
        
        & .docs-link-smartinsertlinkbubble-internal-links-heading /* ← Search */ {
          &>.docs-link-back-to-search-icon-button {
            .standard-icon-button();
          }
          &>.docs-insert-link-bubble-back-search-text {
            color: var(--ddocs-on-surface);
          }
        }
      }
      
      & .docs-link-smartinsertlinkbubble-bottompane {
        max-height: 204px;
      }
      
      & #smartinsertlink-suggestions-holder>#searchlinks-suggestionholder>.docs-link-smartlinksuggestioncontentbox-suggestion-holder /* Holder, holder, holder?? */, 
      & .docs-link-smartinternallinksuggestiongroup-container {
        color: var(--ddocs-on-surface);
        
        &>.docs-link-smartinternallinksuggestiongroup-title {
          color: var(--ddocs-on-surface-variant);
        }
        &>.docs-link-smartlinksuggestion {
          transition: var(--off);
          user-select: none;
          &.docs-link-smartlinksuggestion-paste-match {
            background-color: unset;
          }
          &:hover {
            background-color: var(--ddocs-on-surface-hover);
            transition: var(--on);
          }
          &:focus {
            background-color: var(--ddocs-on-surface-focus);
            transition: var(--on);
          }
          
          &>.docs-link-smartlinksuggestion-icon :is(.docs-icon-heading, .docs-icon-bookmark, .docs-icon-link, .docs-icon-html-preview, .docs-icon-drive-folder) {
            filter: var(--whiter-icons);
          }
          &>.docs-link-docs-link-smartlinksuggestion-text {
            &>.docs-link-smartlinksuggestion-title {
              color: var(--ddocs-on-surface);
              font-size: 0.75rem;
            }
          }
          
          & .docs-link-smartlinksuggestion-search {
            color: var(--ddocs-on-surface-variant);
          }
        }
      }
      
      & .docs-insert-link-bubble-internal-links-button /* Headings and bookmarks */ {
        border-top-color: var(--ddocs-outline-variant);
        transition: var(--off);
        &.goog-flat-button-hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
        &.goog-flat-button-focused {
          background-color: var(--ddocs-on-surface-focus);
          transition: var(--on);
        }
        &.goog-flat-button-active {
          background-color: var(--ddocs-on-surface-pressed);
        }
        
        & .docs-insert-link-bubble-internal-links-text {
          color: var(--ddocs-on-surface);
        }
        & .docs-link-internal-links-icon .docs-icon-img {
          filter: var(--whiter-icons);
        }
      }
      
      &>.jfk-bubble-arrow.jfk-bubble-arrowup>div {
        border-color: var(--ddocs-surface-container) transparent;
      }
    }
    
    & .docs-embedded-content-button {
      background-color: var(--ddocs-surface-container-high);
      border: none;
      border-radius: 0.5rem;
      padding: 8px;
      transition: var(--off);
      &:is(.jfk-button-hover, .jfk-freestanding-menu-button-hover) {
        background-color: #3f4144;
        transition: var(--on);
      }
      &:is(.jfk-button-focused, .jfk-freestanding-menu-button-focused) {
        background-color: #47494b;
      }
      
      &>.docs-embedded-content-controls-dropdown-icon, .docs-embedded-content-controls-linking-icon, .docs-embedded-content-button-icon {
        opacity: 100%;
      }
      & .docs-icon-img {
        filter: invert();
      }
      & .docs-embedded-content-button-text {
        color: var(--ddocs-on-surface);
        text-transform: none;
      }
    }
    
    & .docs-bubble.kix-embedded-entity-bubble /* Image positioning, &c. Mini toolbars */ {
      background-color: var(--ddocs-surface-container-high);

      & .jfk-button {
        .standard-icon-button();
        &.kix-embedded-entity-overflow-menu-button.docs-material-menu-button-flat-primary-open /* Exists in the mini toolbar for image positioning */ {
          background-color: var(--ddocs-on-surface-variant-pressed);
        }
      }
      & .kix-drawing-bubble-edit-button:not(.docs-material-button-disabled) /* Edit button for drawings */ {
        color: var(--ddocs-on-surface) !important;
        transition: var(--off);
        &.docs-material-button-hover {
          background-color: var(--ddocs-on-surface-hover) !important;
          transition: var(--on);
        }
        &.docs-material-button-focused {
          background-color: var(--ddocs-on-surface-focus) !important;
          border-color: transparent;
        }
        
        & .docs-material-button-ripple-element {
          background-color: var(--ddocs-on-surface-pressed);
        }
        
        & .kix-drawing-bubble-edit-button-icon>.docs-icon-img {
          filter: var(--white-icons);
        }
      }

      & .goog-toolbar-separator {
        border-left-color: var(--ddocs-outline-variant);
      }
      
      & .docs-material-gm-select {
        border-radius: 0.25rem;
        transition: var(--off);
        &.docs-material-gm-select-hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
        &.docs-material-gm-select-active,
        &.docs-material-gm-select-open {
          background-color: var(--ddocs-on-surface-pressed);
          transition: var(--on);
        }
        
        &>.docs-material-gm-select-outer-box {
          background: none;
        }
        
        & .docs-material-gm-select-caption {
          color: var(--ddocs-on-surface);
        }
        & .docs-icon-arrow-dropdown {
          filter: var(--whiter-icons);
        }
      }
    }
    
    & .kix-spell-bubble /* Spelling suggestions */ {
      background-color: var(--ddocs-surface-container-high);
      border-color: $background-color;
      
      &>.kix-spell-bubble-suggestion-text {
        border-radius: 4px;
        color: var(--ddocs-on-surface);
        transition: var(--off);
        user-select: none;
        &:hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
        &:focus {
          background-color: var(--ddocs-on-surface-focus);
        }
      }
      &>.kix-spell-bubble-option {
        .standard-icon-button();
      }
    }
    
    & .docs-autocorrect-bubble /* Autocorrect */ {
      background-color: var(--ddocs-surface-container-high);
      border-color: $background-color;
      
      &>.docs-autocorrect-bubble-undo {
        border-radius: 4px;
        color: var(--ddocs-on-surface);
        transition: var(--off);
        user-select: none;
        &:hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
        &:focus {
          background-color: var(--ddocs-on-surface-focus);
        }
        
        & .docs-icon-undo-autocorrect {
          filter: var(--whiter-icons);
        }
      }
      
      &>.docs-autocorrect-bubble-more-options {
        .standard-icon-button();
      }
    }
    
    & .kix-bookmark-bubble /* Bookmark */ {
      background-color: var(--ddocs-surface-container-high);
      color: var(--ddocs-on-surface);
      
      & .kix-bookmark-bubble-button {
        .standard-icon-button();
      }
    }
    
    & .kix-tab-to-convert-bubble /* [tab] to… suggestion after you insert an Event chip */ {
      background-color: var(--ddocs-surface-container-high);
      
      & .kix-tab-to-convert-bubble-tab-icon {
        & rect {
          fill: none;
          stroke: var(--ddocs-outline);
        }
        & text {
          fill: var(--ddocs-on-surface);
        }
      }
      &>.kix-tab-to-convert-bubble-message-prefix {
        color: var(--ddocs-on-surface);
      }
    }
    
    & .apps-search-popup-menu /* @Insert menu */ {
      background-color: var(--ddocs-surface-container);
      
      &>.docs-smart-canvas-scrollable-inputless-insert-menu {
        & .docs-modality-header-message-component {
          &>.docs-modality-header-message-component-title {
            color: var(--ddocs-on-surface-variant);
          }
          &>.docs-modality-header-message-component-icon-button {
            .standard-icon-button();
            padding: 6px;
            &.goog-flat-button-active {
              background-color: var(--ddocs-on-surface-variant-pressed);
            }
          }
        }
        & .goog-menuitem {
          transition: var(--off);
          &.goog-menuitem-highlight {
            background-color: var(--ddocs-on-surface-hover);
            transition: var(--on);
          }
          &.goog-menuitem-active {
            background-color: var(--ddocs-on-surface-pressed);
          }
          
          & .docs-icon-img:not(.docs-icon-document, .docs-icon-spreadsheet, .docs-icon-presentation, .docs-icon-drawing, .docs-icon-logo-maps, .docs-icon-pdf, .docs-icon-word, .docs-icon-powerpoint, .docs-icon-excel) {
            filter: var(--whiter-icons);
          }
          & .docs-inline-insert-menu-item-title {
            color: var(--ddocs-on-surface);
          }
          & .docs-inline-insert-menu-item-subtext {
            color: var(--ddocs-on-surface-variant);
          }
          
          & .docs-inline-insert-menu-item-button>.docs-material-button-flat-default {
            transition: var(--off);
            &.docs-material-button-hover {
              background-color: var(--ddocs-on-surface-variant-hover);
              transition: var(--on);
            }
            &.docs-material-button-focused {
              background-color: var(--ddocs-on-surface-variant-focus);
            }
            &>.docs-material-button-ripple-element {
              background-color: var(--ddocs-on-surface-variant-pressed);
            }
          }
        }
        
        & .docs-smart-canvas-insert-menu-message {
          color: var(--ddocs-on-surface-variant);
        }
      }
    }
    
    .smart-canvas-date-picker-bubble /* Date picker from the @Insert menu */ {
      .date-picker();
    }
    
    .docs-emoji-picker-bubble /* Full emoji picker */ {
      .emoji-picker();
    }
    
    .kix-dropdown-item-selection-bubble /* Dropdown popup (in-document custom dropdowns) */ {
      background-color: var(--ddocs-surface-container);
      border: none;
      color: var(--ddocs-on-surface);
      
      & .kix-dropdown-item-selection-button /* Each option */,
      & .kix-configure-dropdown-button {
        transition: var(--off);
        &.goog-flat-button-hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
        &.goog-flat-button-active {
          background-color: var(--ddocs-on-surface-pressed);
          transition: var(--on);
        }
        
        & svg.kix-dropdown-item-selection-button-icon /* Checkmark */ {
          fill: var(--ddocs-primary);
        }
        & svg.kix-configure-dropdown-button-add-icon /* + icon beside “Add / Edit Options” */ {
          fill: var(--ddocs-on-surface);
        }
        
        & .kix-dropdown-item-selection-button-display-value-container /* Option */ {
          filter: var(--darkfilter);
        }
      }
      
      & .goog-menuseparator {
        border-color: var(--ddocs-outline-variant);
      }
    }
    
    & .kix-superfab-plugin #docs-instant-bubble /* Pill with add comment, emoji reaction, and suggestion. Seems to be struggling to appear these days. */ {
      background-color: var(--ddocs-surface-container-high);
      
      & .instant-button {
        transition: var(--off);
        &.goog-control-hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
        &.goog-control-active {
          background-color: var(--ddocs-on-surface-pressed);
        }
        
        & .docs-icon-img-container {
          filter: var(--ddocs-on-primary-container-icon) brightness(200%) saturate(0%);
        }
      }
    }
    
    .kix-watermark-edit-bubble {
      background-color: var(--ddocs-surface-container-high);
      padding: 0;
      &>.kix-watermark-edit-bubble-button {
        color: var(--ddocs-on-surface);
        &:hover {
          background-color: var(--ddocs-on-surface-hover);
        }
        &:focus {
          background-color: var(--ddocs-on-surface-focus);
        }
      }
    }
  }
  
  #docs-findbar-id .docs-slidingdialog {
    background-color: var(--ddocs-surface-container-high);
    border: none;
    border-radius: 1rem;
    display: flex;
    margin-top: 0.5rem !important;
    padding: 1rem;
    place-items: center;
    
    & #docs-slidingdialog-content {
      height: 3rem;
    }
    
    & .docs-findbar-content {
      display: inline-flex;
      height: auto;
      align-items: center;
      
      & .jfk-button-standard {
        .standard-icon-button();
        display: grid;
        height: 2rem;
        place-items: center;
        width: $height;
        &>.docs-icon {
          margin: 0;
          transform: scale(133%);
        }
      }
      
      & .goog-toolbar-separator {
        border-color: var(--ddocs-outline-variant);
        margin-right: 8px;
      }
    }
    
    & #docs-findbar-input {
      height: auto;
      &>.docs-findinput-container {
        background: none;
        border-color: var(--ddocs-outline);
        font-size: 1rem;
        height: 3rem;
        padding: 0 1rem;
        &.docs-findinput-container-focus {
          border: 1px solid var(--ddocs-primary);
          box-shadow: inset 0 0 0 1px var(--ddocs-primary);
        }
        
        & input.docs-findinput-input {
          caret-color: var(--ddocs-primary);
          color: var(--ddocs-on-surface);
          font-size: 1rem;
          &::placeholder {
            color: var(--ddocs-on-surface-variant);
            opacity: 100%;
          }
          &::selection {
            background-color: var(--ddocs-primary);
            color: var(--ddocs-on-primary);
          }
        }
        
        & .docs-findinput-count-container {
          padding-right: 0;
          
          & .docs-findinput-count {
            color: var(--ddocs-on-surface-variant);
          }
        }
      }
    }
    
    & .docs-slidingdialog-close-container {
      padding: 0;
      position: static;
      
      & .docs-slidingdialog-button-close {
        .standard-icon-button();
        display: inline-grid;
        height: 2rem;
        place-items: center;
        width: $height;
        &.goog-flat-button-focused {
          outline: none;
        }
        & .docs-icon {
          margin: 0;
          transform: scale(133%);
        }
      }
    }
  }
  
  #docs-checkupdialog-id {
    & .docs-checkupdialog-content-container /* Spelling and grammar */ {
      background-color: var(--ddocs-surface-container-high);
      border-radius: 1rem;
      color: var(--ddocs-on-surface);

      & .docs-checkupdialog-header {
        border-bottom-color: var(--ddocs-outline-variant);
      }
      
      & .docs-checkupdialog-suggestion-button {
        .suggestion-chip();
        &.docs-checkupdialog-suggestion-button-focused.jfk-button-hover {
          background-color: var(--ddocs-on-surface-variant-focus) !important;
        }
      }
      
      & .docs-checkupdialog-button-ignore {
        .outlined-button();
      }
      
      & .docs-checkupdialog-button-overflow {
        .standard-icon-button();
        border: none;
        display: grid;
        height: 2.5rem;
        margin-left: 4px;
        place-items: center;
        width: $height;
        & .docs-material-button-content {
          line-height: 20px;
          height: 22px;
        }
        & .docs-icon {
          margin: 0;
        }
      }
    }
    & .docs-checkupdialog-previous-misspelling, .docs-checkupdialog-next-misspelling {
      border-radius: 50%;
      transition: var(--off);
      &.docs-material-button-hover {
        background-color: var(--ddocs-on-surface-variant-hover);
        transition: var(--on);
      }
      &.docs-material-button-focused {
        border-color: transparent;
        background-color: var(--ddocs-on-surface-variant-focus);
        line-height: 32px;
      }
      &>.docs-material-button-ripple-element {
        background-color: var(--ddocs-on-surface-variant-pressed);
      }
      & .docs-icon-img {
        filter: var(--whiter-icons);
      }
    }
    & .docs-checkupdialog-button-close {
      .standard-icon-button();
      opacity: 100%;
    }
  }
  .goog-menu.docs-checkupdialog-overflow-menu {
    background-color: var(--ddocs-surface-container-high) !important;
    .goog-menuitem {
      color: var(--ddocs-on-surface);
      padding: 0 0.75rem;
    }
  }
  
  .right-gutter-resizer-drag-handle /* Divider between pageless document and comments section */ {
    &>.right-gutter-resizer-ghost-line {
      background-color: var(--ddocs-outline);
      &>.right-gutter-resizer-handle-grabber {
        background-color: var(--ddocs-surface-container-highest);
        border: none;
        box-shadow: none;
      }
    }
    &>.right-gutter-resizer-expansion-ghost-line {
      border-color: var(--ddocs-outline);
    }
    &>.right-gutter-resizer-expansion-button /* When the comment section is collapsed */ {
      background-color: var(--ddocs-surface-container-highest);
      border: none;
      & .docs-icon-img {
        filter: var(--whiter-icons);
      }
    }
  }
  
  .docs-grille-gm3.docs-body-pageless .docos-anchoreddocoview:hover {background: var(--ddocs-surface-container);}
  body.docs-grille-gm3 .kix-discussion-plugin-vertical /* Comments section */ {
    & .docos-anchoreddocoview {
      background: var(--ddocs-surface-container);
      &>.docos-anchoreddocoview-internal {
        background: none;
        transition: var(--off);
      }
      &:hover:not(.docos-docoview-active)>.docos-anchoreddocoview-internal {
        //background-color: var(--ddocs-on-surface-hover);
        //transition: var(--on);
      }
      &.docos-docoview-active {
        background-color: var(--ddocs-surface-container-high);
        transition: var(--on);
        &:hover {
          background-color: var(--ddocs-surface-container-high);
        }
      }
      
      & .docos-anchoredreplyview {
        background: none !important;
        border-color: var(--ddocs-outline-variant);
        
        &>.docos-anchoredreplyview-header {
          & .docos-anchoredreplyview-author {
            color: var(--ddocs-on-surface);
          }
          & .docos-anchoredreplyview-timestamp {
            color: var(--ddocs-on-surface-variant);
          }
          & .docos-replyview-resolve-button, 
          & .jfk-button-flat.docs-suggestion-button {
            .standard-icon-button();
            
            & .docs-icon-img {
              filter: unset !important;
              filter: var(--ddocs-on-primary-container-icon) !important;
            }
          }
          & .goog-menu-button {
            .standard-icon-button();
            
            & .docos-icon-img::before {
              filter: invert(100%);
            }
          }
        }
        &>.docos-collapsible-replyview {
          &>.docos-replyview-emoji-controls .docs-material-button-raised-default /* Button to add emoji reaction */ {
            background-color: var(--ddocs-surface-container-highest);
            &.docs-material-button-hover .docs-material-button-content {
              background-color: var(--ddocs-on-surface-variant-hover);
            }
            &.docs-material-button-focused {
              border: none;
              &>.docs-material-button-content {
                background-color: var(--ddocs-on-surface-variant-focus);
              }
            }
            
            & .docs-material-button-ripple-element {
              background-color: var(--ddocs-on-surface-variant-pressed);
            }
            
            & .docs-icon-insert-emoticon {
              filter: var(--white-icons);
            }
          }
          
          & .docos-anchoredreplyview-body /* Comment text */{
            color: var(--ddocs-on-surface);
            &.docos-replyview-body-emoji-reactable-background /* Hovering over a reactable comment */ {
              background-color: var(--ddocs-on-surface-hover);
            }
          }
          & .docos-action-text /* “Marked as resolved” / “Re-opened” */ {
            color: var(--ddocs-on-surface-variant);
          }
          & .docos-anchoredreplyview-body span /* Suggestions */ {
            color: var(--ddocs-on-surface) !important;
          }
        }
        & .docos-anchoredreplyview-origin /* “From comparison” */ {
          border-color: var(--ddocs-outline-variant);
          color: var(--ddocs-on-surface-variant);
        }
        
        &>.docos-replyview-emojis-wrapper .docs-material-button-flat-primary /* Emoji reactions */ {
          border-color: var(--ddocs-outline);
          color: var(--ddocs-on-surface-variant);
          transition: var(--off);
          &.docs-material-button-disabled {
            background: none;
          }
          &.docs-material-button-hover {
            background-color: var(--ddocs-on-surface-hover);
            box-shadow: none;
            transition: var(--on);
          }
          &.docs-material-button-focused {
            background-color: var(--ddocs-on-surface-focus);
            border: 1px solid var(--ddocs-outline);
            box-shadow: none;
            padding: 0 5px;
          }
          &>.docs-material-button-ripple-element {
            background-color: var(--ddocs-on-surface-pressed);
          }
          &.docos-emoji-counter-button-user-involved {
            color: var(--ddocs-on-secondary-container);
            &.docs-material-button-hover {
              background-color: var(--ddocs-primary-hover);
            }
            &.docs-material-button-focused {
              background-color: var(--ddocs-primary-focus);
            }
            &>.docs-material-button-ripple-element {
              background-color: var(--ddocs-primary-pressed);
            }
          }
          
          & .docos-emoji-counter-button-container, .docos-emoji-counter-button-count {
            color: currentColor;
          }
        }
      }
      
      & :is(.docos-anchoreddocoview-input-pane, .docos-anchoredreplyview-edit-pane) {
        background: none !important;
        
        &>.docos-input-textarea {
          background-color: var(--ddocs-surface-container-highest);
          border-color: $background-color;
          color: var(--ddocs-on-surface);
          transition: var(--off);
          &:hover {
            border-color: var(--ddocs-outline);
            transition: var(--on);
          }
          &:focus {
            border-color: var(--ddocs-primary);
            box-shadow: inset 0 0 0 1px var(--ddocs-primary);
          }
          &:focus-visible {
            outline: none;
          }
          
          &::before {
            color: var(--ddocs-on-surface-variant);
          }
        }
        
        &>.docos-smart-reply {
          gap: 0.5rem;
          justify-content: flex-start;
          
          & .jfk-button.docos-smart-reply-button /* These act like sugggestion chips */ {
            background: transparent;
            border-color: var(--ddocs-outline) !important;
            border-radius: 8px;
            color: var(--ddocs-on-surface-variant);
            height: 2rem;
            margin: 0;
            min-height: unset;
            padding: 3px 1rem;
            width: unset;
            .states();
          }
        }
        
        & .docos-input-buttons-post {
          .filled-button();
          display: inline-grid;
        }
        & .docos-input-cancel {
          .outlined-button();
          &.jfk-button-focused, 
          &.jfk-button-focused.jfk-button-hover {
            border-color: var(--ddocs-primary) !important;
          }
        }
      }
      
      & #docos-shadow {
        border-radius: 12px;
        
        & .jfk-button.jfk-button-standard {
          .outlined-button();
          backdrop-filter: blur(10px);
        }
      }
      & .docos-showrepliesbutton /* “Show # more replies */ {
        & .docos-showrepliesbutton-line {
          border-top-color: var(--ddocs-outline-variant);
        }
        & .docos-showrepliesbutton-collapsed-internal-container {
          background-color: var(--ddocs-surface-container);
          &>.docos-showrepliesbutton-collapsed-internal {
            color: var(--ddocs-primary);
            transition: var(--off);
            user-select: none;
            &:hover {
              background-color: var(--ddocs-primary-hover);
              transition: var(--on);
            }
            &:focus {
              background-color: var(--ddocs-primary-focus);
            }
            &:active {
              background-color: var(--ddocs-primary-pressed);
            }
          }
        }
      }
    }
    & .docos-calltoactionview /* Pageless mode ad */ {
      background-color: var(--ddocs-surface-container);
      border-color: $background-color;
      transition: var(--off);
      &.visual-treatment-pageless-promo .docos-calltoactionview-header-image {
        filter: var(--darkfilter);
      }
      &>.docos-calltoactionview-container {
        background: none;
        & .docos-calltoactionview-header {
          color: var(--ddocs-on-surface);
        }
        & :is(.docos-calltoactionview-body, .docos-calltoactionview-dont-show-again-label) {
          color: var(--ddocs-on-surface);
          & a {
            color: var(--ddocs-primary);
          }
        }
        & .docos-calltoactionview-text-default-buttons-container div.docs-material-button {
          .text-button();
        }
        & .docos-calltoactionview-checkbox-container {
          border-bottom-color: var(--ddocs-outline-variant);
          &>.docos-calltoactionview-dont-show-again-checkbox {
            .checkbox();
          }
        }
        
        & .docos-calltoactionview-accept {
          .filled-button();
        }
        & .docos-calltoactionview-reject {
          .outlined-button();
          &:is(.jfk-button-hover.jfk-button-focused, .jfk-button-focused) {
            border-color: var(--ddocs-primary) !important;
          }
        }
      }
    }
    & .docos-docoview-active .docos-calltoactionview {
      background-color: var(--ddocs-surface-container-high);
      transition: var(--on);
    }
  }
  
  body.docs-grille-gm3 .docos-minimized-view /* Comment buttons in the collapsed comments section alongside pageless documents */ {
    & .docs-icon-img {
      filter: var(--white-icons);
    }
    &:not(.docos-docoview-active):hover .docs-icon-img {
      filter: invert();
    }
    &.docos-docoview-active .docs-icon-img {
      filter: var(--paleblue-icons);
    }
  }
}

@-moz-document url-prefix("https://docs.google.com/document/d/") {
// Right sidebars
  
  .filled-button() {
    background-color: var(--ddocs-primary);
    border: none !important;
    border-radius: 20px !important;
    box-sizing: border-box;
    color: var(--ddocs-on-primary);
    display: grid;
    &:is(.goog-inline-block, .docs-material-button) {
      display: inline-grid;
    }
    font-size: 0.875rem;
    height: 40px !important;
    padding: 0 24px !important;
    place-items: center;
    transition: var(--off);
    &:is(.docs-material-button-disabled, [disabled]) {
      background-color: rgba(227, 227, 227, 12%);
      color: rgba(227, 227, 227, 38%);
      transition: var(--off);
    }
    &:is(.docs-material-button-hover, .jfk-button-hover, :hover) {
      background-color: var(--ddocs-on-primary-hover);
      border: none !important; // The OK button in Word Count is particularly fussy
      transition: var(--on);
    }
    &:is(.docs-material-button-focused, .jfk-button-focused, :focus) {
      background-color: var(--ddocs-on-primary-focus);
      border: none !important;
      color: var(--ddocs-on-primary);
      transition: var(--on);
    }
    &:is(.docs-material-button-active, :active) {
      background-color: var(--ddocs-on-primary-pressed);
      transition: var(--on);
    }
  }
  
  .outlined-button() {
    background-color: transparent;
    border: 1px solid var(--ddocs-outline) !important;
    border-radius: 20px !important;
    color: var(--ddocs-primary);
    height: 40px !important;
    padding: 0 24px !important;
    transition: var(--off);
    &:is([disabled]) {
      background: none !important;
      border-color: rgba(227, 227, 227, 12%) !important; // var(--ddocs-on-surface) at 12% opacity
      color: rgba(227, 227, 227, 38%);
      opacity: 100%;
    }
    &:is(.docs-material-button-hover, .jfk-button-hover, :hover) {
      background-color: var(--ddocs-primary-hover);
      border: 1px solid var(--ddocs-outline) !important;
      color: var(--ddocs-primary);
      transition: var(--on);
    }
    &:is(.docs-material-button-focused, .jfk-button-focused, :focus), 
    &:is(.jfk-button-hover):is(.jfk-button-focused) {
      background-color: var(--ddocs-primary-focus);
      border: 1px solid var(--ddocs-outline) !important;
      color: var(--ddocs-primary);
    }
    &:is(.docs-material-button-active, :active) {
      background-color: var(--ddocs-primary-pressed);
      border: 1px solid var(--ddocs-outline) !important;
      transition: none;
    }
    &.docs-material-button-collapse-left {
      border-top-left-radius: 0 !important;
      border-bottom-left-radius: 0 !important;
    }
    &.docs-material-button-collapse-right {
      border-top-right-radius: 0 !important;
      border-bottom-right-radius: 0 !important
    }
    &.jfk-button-standard {
      line-height: 38px !important;
    }
    
    &>span.docs-material-button-content {
      line-height: 38px;
    }
  }
  
  .standard-icon-button() {
    transition: var(--off);
    &:not(.goog-toolbar-button-checked) /* Also works for buttons that can’t be selected */ {
      background-color: transparent;
      &:is(.goog-flat-button-hover, .jfk-button-hover, :hover) {
        background-color: var(--ddocs-on-surface-variant-hover);
        transition: var(--on);
      }
      &:is(.goog-flat-button-focused, .jfk-button-focused, :focus) {
        background-color: var(--ddocs-on-surface-variant-focus);
      }
      &:is(.goog-flat-button-active, .jfk-button-active, :active) {
        background-color: var(--ddocs-on-surface-variant-pressed);
      }
      &:is(.jfk-button-disabled) {
        background: none;
      }
      
      & .docs-icon-img {
        filter: var(--whiter-icons);
      }
    }
  }
  
  .text-button() {
    border-radius: 20px;
    color: var(--ddocs-primary);
    font-size: 0.875rem;
    height: 40px;
    padding: 0 12px;
    transition: var(--off);
    &:is(.goog-flat-button-hover) {
      background-color: var(--ddocs-primary-hover);
      transition: var(--on);
    }
    &:is(.goog-flat-button-focused) {
      background-color: var(--ddocs-primary-focus);
      transition: var(--on);
    }
    &:is(.goog-flat-button-active) {
      background-color: var(--ddocs-primary-pressed);
    }
    
    &:has(.kix-citations-flat-button-icon) /* Button with icon */ {
      padding: 0 16px 0 12px;
    }
  }
  
  .outlined-text-field(@height: 48px) { // Material defaults to 56px, but that’s huuuge especially if there’s a lot of them
    background: none;
    border: 1px solid var(--ddocs-outline);
    border-radius: 4px;
    caret-color: var(--ddocs-primary);
    color: var(--ddocs-on-surface);
    font-size: 1rem;
    height: @height;
    padding: 0 16px;
    transition: var(--off);
    &:hover {
      border-color: var(--ddocs-on-surface);
      transition: var(--on);
    }
    &:focus {
      border-color: var(--ddocs-primary);
      border-width: 1px;
      box-shadow: inset 0 0 0 1px var(--ddocs-primary); // This way there is no shifting of input text. 
      transition: var(--on);
    }
    
    &::placeholder {
      color: var(--ddocs-on-surface-variant);
      opacity: 100%;
    }
  }
  
  .outlined-dropdown-text-field(@height: 48px) {
    background-color: transparent;
    border: 1px solid var(--ddocs-outline);
    border-radius: 4px;
    box-sizing: border-box;
    height: @height;
    transition: var(--off);

    &>.docs-material-gm-select-outer-box {
      border: none;
      height: 100%;
      padding: 0 12px 0 16px;
      width: 100%;
      &>.docs-material-gm-select-inner-box {
        height: 100%;
        width: 100%;
      }
    }
    &.docs-material-gm-select-hover {
      border-color: var(--ddocs-on-surface);
      transition: var(--on);
    }
    &.docs-material-gm-select-focused {
      border-color: var(--ddocs-primary);
      box-shadow: inset 0 0 0 1px var(--ddocs-primary);
    }
    
    & .docs-material-gm-select-caption {
      color: var(--ddocs-on-surface);
      font-size: 1rem;
    }
    & .docs-icon-arrow-dropdown {
      filter: var(--whiter-icons);
    }
  }
  
  .slider() {
    & .docs-material-slider-track {
      border-radius: 0.125rem;
      height: 0.25rem;
      &.docs-material-slider-track-on {
        background-color: var(--ddocs-primary);
      }
      &.docs-material-slider-track-off {
        background-color: var(--ddocs-surface-container-highest);
      }
    }
    & .docs-material-slider-thumb {
      top: 2px;
      & .docs-material-slider-thumb-grabber {
        background-color: var(--ddocs-primary);
        border: none;
      }
    }
    
    &.goog-slider-disabled {
      & .docs-material-slider-track {
        &.docs-material-slider-track-on {
          background-color: var(--ddocs-on-surface);
          opacity: 38%;
        }
        &.docs-material-slider-track-off {
          background-color: var(--ddocs-on-surface-disabled);
        }
      }
      & .docs-material-slider-thumb-grabber {
        background-color: #6f6f70;
      }
    }
  }
  
  body.docs-grille-gm3.docs-body-pageless :is(.collaborator-activity-sidebar, .docs-tiled-sidebar, .docs-chat-pane-container, .docs-dictionary-sidebar, .emoji-detail-sidebar) {
    border-color: transparent;
  }
  
  body.docs-grille-gm3 .docs-sidebar-tile /* Expandable sections */ {
    color: var(--ddocs-on-surface);
    
    & .docs-sidebar-tile-header {
      color: var(--ddocs-on-surface);
      transition: var(--off);
      &.docs-sidebar-tile-header-disabled {
        color: var(--ddocs-on-surface-disabled);
      }
      &.goog-zippy-expanded {
        background-color: transparent;
        & .docs-sidebar-tile-arrow-collapsed {
          transform: unset;
        }
      }
      &:hover:not(.docs-sidebar-tile-header-disabled) {
        background-color: var(--ddocs-on-surface-hover);
        transition: var(--on);
      }
      &:focus:not(.docs-sidebar-tile-header-disabled) {
        background-color: var(--ddocs-on-surface-focus);
        border: none;
        padding: 1rem;
      }
      
      & .docs-sidebar-tile-arrow-collapsed {
        display: inline-block;
        filter: var(--whiter-icons);
        transform: rotate(-90deg);
        transition: transform 0.5s ease-out;
      }
      & .docs-sidebar-tile-arrow-expanded {
        display: none;
      }
    }
    
    &.docs-sidebar-tile-expanded /* Replaces the elevated look of opened sections with simple outlines */ {
      border-radius: 0;
      box-shadow: none;
      &.docs-sidebar-tile-border-radius-top {
        border-top: 1px solid var(--ddocs-outline-variant);
        
        &>.docs-sidebar-tile-header {
          padding-top: calc(1rem - 1px);
        }
      }
      &.docs-sidebar-tile-border-radius-bottom {
        border-bottom: 1px solid var(--ddocs-outline-variant);
      }
      &+.docs-sidebar-tile-expanded {
        border-top: 1px solid var(--ddocs-outline-variant);
      }
    }
  }
  
  @media (prefers-reduced-motion) {
    body.docs-grille-gm3 .docs-sidebar-tile .docs-sidebar-tile-arrow-collapsed {
      transition: none !important;
    }
  }
  
  body.docs-grille-gm3 #docs-chrome .docs-companion-app-switcher-container /* Calendar, Keep, &c. */ {
    background-color: var(--ddocs-background);
    & .app-switcher-button-hover>.app-switcher-button-icon-background {
      background-color: var(--ddocs-on-surface-hover);
    }
    & .app-switcher-button-active>.app-switcher-button-icon-background {
      background-color: var(--ddocs-on-surface-pressed);
    }
    & .app-switcher-button-selected .app-switcher-button-icon-background-inner {
      background-color: var(--ddocs-surface-container-highest);
    }
    & .companion-app-switcher-separator {
      border-top-color: var(--ddocs-outline-variant);
    }
    & .app-switcher-button-icon-container[style="background-image: url(//www.gstatic.com/images/icons/material/system/2x/more_horiz_grey600_24dp.png)"] /* More apps */ {
      background-image: url(https://www.gstatic.com/images/icons/material/system/2x/more_horiz_white_24dp.png) !important;
    }
    & .app-switcher-button-icon-container[style="background-image: url(https://fonts.gstatic.com/s/i/googlematerialicons/add/v21/black-24dp/1x/gm_add_black_24dp.png)"] /* Button to add a sidebar app. */ {
      background-image: url(https://fonts.gstatic.com/s/i/googlematerialicons/add/v21/white-24dp/1x/gm_add_white_24dp.png) !important;
    }
    & .app-switcher-button.companion-collapser-button {
      // This is a weird button, so again, custom implementations -_-
      &:is(.app-switcher-button-hover, .app-switcher-button-focused)>.app-switcher-button-icon-background {
        background-color: var(--ddocs-on-surface-hover);
      }
      &.app-switcher-button-active>.app-switcher-button-icon-background {
        background-color: var(--ddocs-on-surface-pressed);
      }
      &.companion-collapser-button.app-switcher-button-checked>.app-switcher-button-icon-background {
        background-color: var(--ddocs-surface-container-high);
      }
      & .app-switcher-button-icon-container svg.app-switcher-button-icon {
        fill: var(--ddocs-on-surface);
      }
    }
  }
  
  body.docs-grille-gm3 .docs-chat-pane-container {
    background-color: var(--ddocs-surface-container-low);
    margin-top: 6px; // to match the toolbar
    
    &>.docs-chat-pane, .docs-chat-messages, .docs-chat-edit-container {
      background: none;
    }
    
    & .docs-chat-title-bar {
      background-color: var(--ddocs-surface-container-low);
      border-bottom-color: transparent;
      color: var(--ddocs-on-surface);
      transition: background-color 0.2s;
      &.docs-chat-shadow {
        background-color: var(--ddocs-surface-container-high);
        box-shadow: none;
        transition: background-color 0.1s;
      }
      
      & .docs-chat-title-message {
        opacity: 100%;
        
        &>.docs-icon {
          filter: var(--whiter-icons) opacity(90%);
        }
        &>h2 {
          color: var(--ddocs-on-surface-variant);
        }
      }
      
      & .docs-chat-close-button {
        .standard-icon-button();
      }
    }
    
    & .docs-chat-messages {
      scrollbar-color: var(--ddocs-outline) transparent;
      
      & .docs-presence-plus-collab-widget-color-block {
        border-color: transparent;
        &>.docs-presence-plus-collab-widget-image-container {
          box-shadow: none;
        }
      }
      & .docs-chat-nametag {
        color: var(--ddocs-on-surface);
      }
      & .docs-chat-message-bubble {
        filter: invert(100%) hue-rotate(180deg) contrast(80%) brightness(170%) saturate(150%);
        &>.docs-chat-message-body::selection {
          background-color: var(--ddocs-primary);
        }
      }
      & .docs-chat-status {
        color: var(--ddocs-on-surface-variant);
      }
    }
    
    & .docs-chat-edit-container.docs-chat-shadow {
      box-shadow: none;
    }
    
    & .docs-chat-edit-box {
      background-color: var(--ddocs-surface-container-highest);
      border-color: $background-color;
      border-radius: 1rem;
      color: var(--ddocs-on-surface);
      padding: 0.75rem;
      transition: var(--off);
      &:hover {
        border-color: var(--ddocs-outline);
        transition: var(--on);
      }
      &:focus {
        border: 1px solid var(--ddocs-primary);
        box-shadow: inset 0 0 0 1px var(--ddocs-primary);
        outline: none;
      }
      &::placeholder {
        color: var(--ddocs-on-surface-variant);
        opacity: 100%;
      }
    }
  }

  body.docs-grille-gm3 .kix-citations-sidebar {
    background-color: var(--ddocs-surface-container-low);
    margin-top: 6px; // to match the toolbar
    & .kix-citations-sidebar-header>.kix-citations-sidebar-titlebar {
      background: none;
      border: none;
      & .kix-citations-sidebar-titlebar-start svg .docs-gm-sidebar-icon-path {
        fill: var(--ddocs-primary);
      }
      & .kix-citations-sidebar-back.docs-sidebar-gm-titlebar-icon-button {
        .standard-icon-button();
      }
      & .kix-citations-sidebar-title {
        color: var(--ddocs-on-surface);
      }
      & .kix-citations-sidebar-close.docs-sidebar-gm-close-button {
        .standard-icon-button();
      }
    }
    
    & .kix-citations-list-view-top /* You add new sources here */, 
    & .kix-citations-create-view-top /* You specify source type here */ {
      background-color: var(--ddocs-surface-container);
      border: none;
      border-radius: 12px;
      margin: 0 16px;
      
      & :is(.kix-citations-accessed-by-select-label, .kix-citations-label, .kix-citations-source-type-select-label) {
        color: var(--ddocs-on-surface);
      }
      & :is(.kix-citations-format-select, .kix-citations-source-type-select, .kix-citations-accessed-by-select) {
        .outlined-dropdown-text-field();
      }
      
      & .kix-citations-add-source-button {
        border-radius: 20px;
        color: var(--ddocs-primary);
        height: 40px;
        padding: 0 16px 0 12px;
        transition: var(--off);
        &:is(.goog-flat-button-hover, .goog-flat-button-focused) {
          background-color: var(--ddocs-primary-hover);
          transition: var(--on);
        }
        &.goog-flat-button-active {
          background-color: var(--ddocs-primary-pressed);
        }
        
        & .kix-citations-add-source-button-icon-path {
          fill: currentColor;
        }
        
        & .kix-citations-add-source-button-label {
          margin-left: 8px;
        }
      }
    }
    
    & .kix-citations-create-view-search-container>.kix-citations-create-view-search /* Enter an ISBN or URL */ {
      background: none;
      border: none;
      
      & .kix-citations-search-input {
        .outlined-text-field();
      }
      & .kix-citations-search-input-error {
        color: var(--ddocs-error);
      }
      
      & .kix-citations-search-manual-button {
        .text-button();
      }
      
      & .kix-citations-search-button {
        .filled-button();
      }
    }
    
    & .kix-citations-search-result-view-attributes-list /* Cite automatically, but it shows you a list of found properties first */ {
      font-size: 0.875rem;
      scrollbar-color: var(--ddocs-outline) transparent;
      
      & .kix-citations-search-result-attribute-label {
        color: var(--ddocs-on-surface-variant);
      }
      & .kix-citations-search-result-attribute-value, 
      & .kix-citations-search-result-attribute-value a:visited {
        color: var(--ddocs-on-surface);
      }
      & .kix-citations-search-result-attribute-missing {
        color: var(--ddocs-error);
      }
      & .docs-icon-info-outline-grey {
        filter: var(--white-icons);
      }
    }
    
    & .kix-citations-create-view-attributes-container {
      scrollbar-color: var(--ddocs-outline) transparent;
      
      & .kix-citations-create-view-attributes-subtitle, 
      & .kix-citations-create-view-recommended-mark {
        color: var(--ddocs-primary);
      }
      & .kix-citations-create-view-attribute-label, 
      & .kix-citations-label {
        color: var(--ddocs-on-surface);
      }
      & .kix-citations-select {
        .outlined-dropdown-text-field();
      }
      & .kix-citations-create-view-input {
        .outlined-text-field();
      }
      & .kix-citations-add-contributor-button {
        .text-button();
        
        & :is(.kix-citations-add-source-button-icon-path, .kix-citations-flat-button-icon-path) {
          fill: currentColor;
        }

        & .kix-citations-add-contributor-button-label {
          margin-left: 8px;
          margin-top: 0;
        }
      }
    }
    
    & .kix-citations-source-list-wrapper /* List of sources */ {
      scrollbar-color: var(--ddocs-outline) transparent;
      & .kix-citations-source-list>.kix-citations-source-list-item /* Each source */ {
        background-color: transparent;
        border-color: var(--ddocs-outline-variant);
        &:last-of-type {
          border-bottom: none;
        }
        
        &>.kix-citations-source-list-item-content>span {
          color: var(--ddocs-on-surface) !important;
          font-family: "Times New Roman", "FreeSerif", serif !important;
          font-size: 12pt !important;
        }
        
        & .kix-citations-source-list-item-toolbar /* Cite and ⋮ button bar */ {
          background: none;
          
          &>.goog-toolbar-button /* “Cite” button */ {
            background-color: var(--ddocs-tertiary);
            border-radius: 15px;
            margin-right: 8px;
            transition: var(--off);
            &.goog-toolbar-button-hover {
              background-color: var(--ddocs-on-tertiary-hover);
              transition: var(--on);
            }
            &.goog-toolbar-button-active {
              background-color: var(--ddocs-on-tertiary-pressed);
            }
            
            & .kix-citations-source-list-item-insert-button /* The text in the button */ {
              color: var(--ddocs-on-tertiary);
            }
          }
          
          &>.goog-toolbar-separator {
            display: none;
          }
          
          &>.goog-toolbar-menu-button /* ⋮ menu button */ {
            background-color: var(--ddocs-surface-container-highest);
            border-radius: 15px;
            
            & .docs-icon-overflow-three-dots {
              filter: var(--whiter-icons);
            }
          }
        }
      }
      & .docs-promo-bubble /* “Insert in-text citation” onboarding */ {
        background-color: var(--ddocs-surface-container-highest);
        
        & .docs-promo-action-container {
          color: var(--ddocs-primary);
        }
        
        & .jfk-bubble-arrowdown .jfk-bubble-arrowimplafter {
          border-color: var(--ddocs-surface-container-highest) transparent;
        }
      }
    }
    
    & .kix-citations-source-list-zero-state {
      &>.kix-citations-source-list-zero-state-heading {
        color: var(--ddocs-on-surface);
      }
      &>.kix-citations-source-list-zero-state-content {
        color: var(--ddocs-on-surface-variant);
      }
    }
    & .kix-citations-create-view-zero-state-content {
      color: var(--ddocs-on-surface-variant);
    }
    
    & .kix-citations-insert-bibliography-container /* “Insert Works Cited / References” bar */, 
    & .kix-citations-sidebar-bottom-button-wrap, 
    & .kix-citations-create-view-bottom-container>.kix-citations-create-view-bottom /* “Add citation source” bar */ {
      background-color: var(--ddocs-surface-container-highest);
      
      &>.kix-citations-primary-fill-button.docs-material-button-fill-primary.docs-material-button {
        .filled-button();
      }
      &>.kix-citations-flat-button {
        .text-button();
      }
    }
  }
  
  body.docs-grille-gm3 .docs-dictionary-sidebar {
    background-color: var(--ddocs-surface-container);
    margin-top: 6px; // to match the toolbar
    & .docs-dictionary-titlebar {
      background: none;
      border: none;
      & .docs-gm-sidebar-icon svg .docs-gm-sidebar-icon-path {
        fill: var(--ddocs-primary);
      }
      & .docs-dictionary-titlebar-heading {
        color: var(--ddocs-on-surface);
      }
      & .docs-dictionary-titlebar-close-icon.docs-sidebar-gm-close-button, 
      & .docs-dictionary-titlebar-back-icon.jfk-button {
        .standard-icon-button();
      }
    }
    & .docs-dictionary-sidebar-searchbar {
      border-radius: 24px;
      height: 56px;
      margin: 0 16px;
      & .docs-explore-searchbar-searchicon {
        filter: var(--whiter-icons);
        height: 24px;
        left: 16px;
        opacity: 100%;
        padding: 16px;
        top: 56px;
        width: 24px;
      }
      & .jfk-textinput {
        background-color: var(--ddocs-surface-container-highest);
        border: none;
        border-radius: 28px;
        box-shadow: none;
        box-sizing: border-box;
        color: var(--ddocs-on-surface);
        padding-left: 56px;
        width: 100%;
      }
    }
    & .docs-explore-dictionaryview {
      height: calc(100% - 112px);
    }
    & .docs-explore-dictionaryentries {
      color: var(--ddocs-on-surface);
      scrollbar-color: var(--ddocs-outline) transparent;
      & .docs-explore-dictionaryentry-title {
        color: currentColor;
      }
      & .docs-explore-dictionaryentry-sensefamily-morphunits, 
      & .docs-explore-dictionaryentry-sense-synonym-prefix, 
      & .docs-explore-dictionaryentry-sense-antonym-prefix {
        color: var(--ddocs-on-surface-variant);
      }
      & .docs-explore-dictionaryentry-sense-synonym-clickable, 
      & .docs-explore-dictionaryentry-sense-antonym-clickable {
        color: var(--ddocs-primary);
      }
    }
    & .docs-explore-emptylist-body {
      color: var(--ddocs-on-surface-variant);
    }
  }
  
  body.docs-grille-gm3 .docs-explore-sidebar {
    background-color: var(--ddocs-surface-container-low);
    margin-top: 6px;
    
    &>.docs-explore-sidebar-title {
      background: none;
      border-bottom: none;
      color: var(--ddocs-on-surface);
      transition: background-color 0.2s;
      
      &>.docs-explore-sidebar-title-explore-icon path {
        fill: var(--ddocs-primary);
      }
      
      & .docs-explore-sidebar-title-back-icon, 
      &>.docs-explore-sidebar-title-close-icon {
        .standard-icon-button();
      }
    }
    &>.docs-explore-searchbar /* and search results */ {
      height: 3.5rem;
      padding: 0 1rem;
      transition: background-color 0.2s;
      
      &>.docs-explore-searchbar-searchicon {
        left: 2rem;
        opacity: 100%;
        top: 73px;
        
        &>.docs-icon {
          margin: 0;
        }
        
        & .docs-icon-img {
          filter: var(--whiter-icons);
        }
      }
      &>.docs-explore-searchbar-labelinput {
        background-color: var(--ddocs-surface-container-highest);
        border: none;
        border-radius: calc(1.75rem - 2px);
        box-shadow: none;
        color: var(--ddocs-on-surface);
        &[aria-haspopup="true"] /* Search suggestions shown */ {
          border-bottom-left-radius: 0;
          border-bottom-right-radius: 0;
        }
        
        &::placeholder {
          color: var(--ddocs-on-surface-variant);
        }
      }
      
      &>.docs-explore-searchbar-ac-overlay /* Scrim */ {
        visibility: hidden;
      }
      
      &>.docs-explore-searchbar-ac-renderer /* Search suggestions */ {
        background-color: var(--ddocs-surface-container-highest);
        border-bottom-left-radius: calc(1.75rem - 2px);
        border-bottom-right-radius: calc(1.75rem - 2px);
        border-top: 1px solid var(--ddocs-outline);
        overflow: hidden;
        width: calc(100% - 2rem - 2px);
        
        &>.docs-explore-searchbar-ac-row {
          transition: var(--off);
          &.docs-explore-searchbar-ac-active {
            background-color: var(--ddocs-on-surface-focus);
            transition: var(--on);
          }
          
          & .docs-explore-searchbar-suggestion-itemview-icon {
            margin-left: 1rem;
            opacity: 100%;
            & .docs-icon-img {
              filter: var(--whiter-icons);
            }
          }
        }
      }
    }
    &>.docs-explore-tabbar {
      border-bottom-color: var(--ddocs-outline-variant);
      transition: background-color 0.2s;
      
      &>.docs-explore-tabbar-tab {
        border-bottom: 2px solid transparent;
        color: var(--ddocs-on-surface-variant);
        transition: var(--off);
        &.docs-explore-tabbar-tab-hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
        &.docs-explore-tabbar-tab-active {
          background-color: var(--ddocs-on-surface-pressed);
        }
        &.docs-explore-tabbar-tab-selected {
          border-bottom-color: currentColor;
          color: var(--ddocs-primary);
          &.docs-explore-tabbar-tab-hover {
            background-color: var(--ddocs-primary-hover);
          }
          &.docs-explore-tabbar-tab-active {
            background-color: var(--ddocs-primary-pressed);
          }
        }
        
        &>.docs-explore-tabbar-tab-label {
          color: inherit;
          font-family: Google Sans, Roboto,RobotoDraft,Helvetica,Arial,sans-serif;
          text-transform: none;
        }
      }
    }
    
    &>.docs-explore-datapage.docs-explore-sidebar-zerostate .docs-explore-card /* Topics card */ {
      background-color: var(--ddocs-surface-container-high);
      border-radius: 12px;
      box-shadow: none;
      color: var(--ddocs-on-surface);
      margin: 0.5rem 1rem;

      & .docs-explore-card-title-heading {
        color: inherit;
      }
      & .docs-explore-card-more-button {
        color: var(--ddocs-primary);
      }

      & .docs-explore-topicitem {
        transition: var(--off);
        &.goog-control-hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
        &.goog-control-active {
          background-color: var(--ddocs-on-surface-pressed);
        }
        & .docs-explore-topicitem-title {
          color: inherit;
        }
        & .docs-explore-topicitem-generator-text {
          color: var(--ddocs-on-surface-variant);
        }
      }
    }
    & .docs-explore-nuggetsview {
      background-color: transparent;
      
      & .docs-explore-topiclist {
        scrollbar-color: var(--ddocs-outline) transparent;
        
        &>.docs-explore-topicitem {
          border-bottom-color: var(--ddocs-outline-variant);
          transition: var(--off);
          &.goog-control-hover {
            background-color: var(--ddocs-on-surface-hover);
            transition: var(--on);
          }
          &.goog-control-active {
            background-color: var(--ddocs-on-surface-pressed);
          }
          
          &>.docs-explore-topicitem-title {
            color: var(--ddocs-on-surface);
          }
          &>.docs-explore-topicitem-generator-text {
            color: var(--ddocs-on-surface-variant);
          }
        }
      }
    }
    &>.docs-explore-datapage.docs-explore-web-serp .docs-explore-serp-webresultsview {
      background: none;
      
      &>.docs-explore-serp-webresultsview-card-container {
        background: none;
        scrollbar-color: var(--ddocs-outline) transparent;
        
        &>.docs-explore-kacard /* Info card */{
          background-color: var(--ddocs-surface-container);
          border-radius: 12px;
          box-shadow: none;
          color: var(--ddocs-on-surface);
          
          & .docs-explore-kacard-title-container, 
          & .docs-explore-kacard-knowledgepanel-facts-list {
            border-bottom-color: var(--ddocs-outline-variant);
          }
          & .docs-explore-kacard-name, 
          & .docs-explore-kacard-knowledgepanel-description, 
          & .docs-explore-kacard-knowledgepanel-facts-list {
            color: inherit;
          }
          & .docs-explore-kacard-disambiguationterm {
            color: var(--ddocs-on-surface-variant);
          }
          & a:link {
            color: var(--ddocs-secondary);
          }
          & a:visited {
            color: violet;
          }
          & .docs-explore-kacard-knowledgepanel-learnmore {
            transition: var(--off);
            
            & .docs-explore-kacard-knowledgepanel-learnmore-arrow {
              filter: invert();
              opacity: 80%;
            }
            
            &>.docs-explore-kacard-knowledgepanel-learnmore-text {
              color: var(--ddocs-on-surface);
            }
          }
        }
        &>.docs-explore-serp-webresultscard /* Search results */ {
          background: none;
          border: none;
          box-shadow: none;
          
          &>.docs-explore-serp-webresultscard-header {
            border: none;
            color: var(--ddocs-on-surface);
            
            &>a.docs-explore-serp-webresultscard-header-text:link {
              color: inherit;
            }
            
            &>.docs-explore-serp-webresultscard-citation-format-menu-button {
              .standard-icon-button();
              
              & .docs-explore-serp-webresultscard-citation-format-menu-button-icon {
                opacity: 80%;
              }
              & .docs-explore-img::before {
                filter: invert();
              }
            }
            & .docs-explore-citation-format-picker-menu {
              background-color: var(--ddocs-surface-container-high);
              &>.goog-menuheader {
                color: var(--ddocs-on-surface-variant);
              }
            }
          }
          
          &>.docs-explore-serp-webresultscard-content .docs-explore-serp-webresult {
            background-color: var(--ddocs-surface-container);
            border: none;
            border-radius: 12px;
            margin: 0.5rem 0;
            
            & a.docs-explore-serp-webresult-title-link:link {
              color: var(--ddocs-secondary);
            }
            & a:visited {
              color: violet;
            }
            & .docs-explore-serp-webresult-url {
              color: var(--ddocs-tertiary);
            }
            & .docs-explore-serp-webresult-snippet {
              color: var(--ddocs-on-surface);
            }
            
            & .docs-explore-serp-webresult-cite-button {
              background-color: var(--ddocs-tertiary);
              border-radius: 50%;
              box-shadow: none;
              margin: 8px;
              transition: opacity 0.1s;
            }
          }
          & .docs-explore-serp-webresultscard-allresults {
            &>.docs-explore-serp-webresultscard-allresults-arrow {
              filter: invert();
              opacity: 80%;
            }
            &>.docs-explore-serp-webresultscard-allresults-text {
              color: var(--ddocs-on-surface);
            }
          }
        }
      }
    }
  }
  @supports selector(::-webkit-scrollbar-track) { // Brighten the top bars of the explore sidebar. Since it relies on the :has() selector responding instantly to changes, Firefox is excluded for now. 
    .docs-grille-gm3 .docs-explore-sidebar .docs-explore-sidebar-title:has(>.docs-explore-sidebar-title-icon[style*="display: none;"]), .docs-explore-sidebar-title:has(>.docs-explore-sidebar-title-icon[style*="display: none;"])~:is(.docs-explore-searchbar, .docs-explore-tabbar) {
      background-color: var(--ddocs-surface-container-high);
    }
  }
  
  .docs-grille-gm3 .docs-onepick-integrated-sidebar /* Google Images picker */ {
    background-color: var(--ddocs-surface-container-low);
    margin-top: 6px;
  }
  .docs-grille-gm3.docs-body-pageless :is(.docs-onepick-integrated-sidebar, .docs-explore-sidebar, .docs-contentembedding-sidebar, .kix-citations-sidebar, .kix-watermark-sidebar /* Jokes on you, yes Google has CSS to add a border around the watermark sidebar in pageless mode, but no you cannot access the watermark sidebar in pageless mode so this is completely useless */) {
    border: none;
  }
  
  .docs-grille-gm3 .docs-contentembedding-sidebar /* Linked objects panel */ {
    background-color: var(--ddocs-surface-container-low);
    margin-top: 6px;
    
    &>.docs-contentembedding-titlebar {
      background-color: var(--ddocs-surface-container-high);
      border-bottom: none;
      
      & .docs-gm-sidebar-icon-path {
        fill: var(--ddocs-primary);
      }
      & .docs-sidebar-header-text {
        color: var(--ddocs-on-surface);
      }
      & .docs-sidebar-gm-titlebar-icon-button {
        transition: var(--off);
        &.jfk-button-hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
        &.jfk-button-focused {
          background-color: var(--ddocs-on-surface-focus);
        }
        
        & .docs-icon-img {
          filter: var(--whiter-icons);
        }
      }
    }
    &>.docs-contentembedding-sidebar-loading-indicator-container .docs-indeterminate-loading-bar {
      background-color: var(--ddocs-surface-container-highest);
      &>div {
        background-color: var(--ddocs-primary);
      }
    }
    
    &>.docs-contentembedding-sidebar-contentlist .docs-contentembedding-sidebar-tile {
      border-bottom-color: var(--ddocs-outline-variant);
      transition: var(--off);
      &:hover {
        background-color: var(--ddocs-on-surface-hover);
        transition: var(--on);
      }
      &:focus {
        background-color: var(--ddocs-on-surface-focus);
      }
      
      &>.docs-contentembedding-sidebar-tile-icon .docs-icon-img {
        filter: var(--whiter-icons);
      }
      & .docs-contentembedding-sidebar-tile-title {
        color: var(--ddocs-on-surface);
      }
      & .docs-contentembedding-sidebar-tile-subtitle {
        color: var(--ddocs-on-surface-variant);
      }
    }
    &>.docs-contentembedding-sidebar-disabledstate .docs-contentembedding-sidebar-disabledstate-message {
      color: var(--ddocs-on-surface-variant);
    }
  }
  
  .docs-grille-gm3 .collaborator-activity-sidebar /* Live edits sidebar */ {
    background-color: var(--ddocs-surface-container);
    
    &>.collaborator-activity-titlebar-container {
      background-color: var(--ddocs-surface-container);
      border-bottom: none;
      color: var(--ddocs-on-surface);
      
      &>.jfk-button {
        .standard-icon-button();
      }
    }
    
    & .collaborator-activity-status-container {
      background: none;
      
      &>.collaborator-activity-status-message {
        color: var(--ddocs-on-surface);
      }
    }
    
    &>.collaborator-activity-tilelist {
      scrollbar-color: var(--ddocs-outline) transparent;
    }
    
    & .collaborator-activity-tile {
      border-color: var(--ddocs-outline-variant);
      color: var(--ddocs-on-surface);
      transition: var(--off);
      &.goog-control-hover {
        background-color: var(--ddocs-on-surface-hover);
        border-color: transparent;
        transition: var(--on);
      }
      &.goog-control-active {
        background-color: var(--ddocs-on-surface-pressed);
      }
      
      & .collaborator-activity-collaborator-name,
      &>.collaborator-activity-diffsummary div /* What someone did */, 
      &>.collaborator-activity-context /* Where they did it */ {
        color: var(--ddocs-on-surface) !important;
      }
      
      & :is(.collaborator-activity-context-after, .collaborator-activity-context-before, .collaborator-activity-context-content) {
        color: var(--ddocs-on-surface-variant);
      }
    }
    
    &>.collaborator-activity-zero-state.collaborator-activity-zero-state-collaborator-seen {
      border-top-color: var(--ddocs-outline-variant);
      
      & svg {
        & use[fill="#E8F0FE"] /* Circle */ {
          fill: var(--ddocs-surface-container-low);
        }
        & :is(g, rect)[fill="#D2E3FC"] /* Rectangles */ {
          fill: color-mix(in srgb, var(--ddocs-on-surface), transparent 92%);
        }
        & g[transform="translate(96 86)"] /* Sign */ {
          &>[fill="#1967D2"] {
            fill: var(--ddocs-primary);
          }
          & [fill="#FFF"] {
            fill: var(--ddocs-on-primary);
          }
        }
      }
      
      & .collaborator-activity-zero-state-text {
        color: var(--ddocs-on-surface);
      }
      
      & .collaborator-activity-zero-state-earlier-edits {
        .outlined-button();
        line-height: 40px;
      }
    }
  }
  
  body.docs-grille-gm3 :is(.docs-format-options-sidebar, .kix-toc-sidebar) /* Image options, TOC */, 
  body.docs-grille-gm3 :has(.kix-tablesidebar-table-tile) /* Table properties */ {
    background-color: var(--ddocs-surface-container-low);
    margin-top: 6px; // to match the toolbar
    
    &>.docs-tiled-sidebar-header {
      background: var(--ddocs-surface-container-low);
      border-bottom: none;
      color: var(--ddocs-on-surface);
      transition: background-color 0.2s;
      &.docs-tiled-sidebar-header-shadow {
        background-color: var(--ddocs-surface-container-high);
        box-shadow: none;
      }
      
      & .docs-gm-sidebar-icon path {
        fill: var(--ddocs-primary);
      }
      & .kix-toc-header-icon.docs-icon-table-of-contents-24 {
        filter: var(--paleblue-icons);
      }
      & .docs-sidebar-gm-close-button {
        .standard-icon-button();
      }
    }
    
    & .docs-tiled-sidebar-scroll {
      margin-top: -2px;
      scrollbar-color: var(--ddocs-outline) transparent;
    }
    & .docs-sidebar-tile-controls {
      background-color: transparent;
    }
    
    & :is(.docs-number-input-label, .docs-number-input-unit, .docs-labeled-button-label, .docs-sidebar-tile-input-label, .docs-sidebar-tile-label) {
      color: var(--ddocs-on-surface);
    }
    & .docs-number-input {
      background: none;
      border-bottom-color: var(--ddocs-outline);
      color: var(--ddocs-on-surface);
      &:focus {
        border-bottom-color: var(--ddocs-primary);
      }
      
      &~.docs-number-input-buttons {
        &>.goog-flat-button {
          filter: invert(100%);
          opacity: 80%;
          &.goog-flat-button-hover {
            background-color: var(--ddocs-on-surface-hover);
            cursor: pointer;
          }
        }
      }
    }
    & .docs-number-input-disabled .docs-number-input {
      border-color: var(--ddocs-on-surface-disabled);
    }
    & .docs-number-input-error-label {
      color: var(--ddocs-error);
    }
    
    & .docs-rotation-rotate-button {
      & .docs-labeled-button-label {
        padding: 1px 0 5px;
      }
      & .docs-material-button {
        border-radius: 50%;
        height: 2.5rem;
        padding: 4px 8px;
        transition: var(--off);
        width: 2.5rem;
        &.docs-material-button-hover {
          background-color: var(--ddocs-on-surface-variant-hover);
          transition: var(--on);
        }
        &.docs-material-button-focused {
          background-color: var(--ddocs-on-surface-variant-focus);
          border: none;
        }
        
        & .docs-material-button-ripple-element {
          background-color: var(--ddocs-on-surface-variant-pressed);
        }
        & .docs-icon {
          opacity: 100%;
          &>.docs-icon-rotate-cw {
            filter: var(--whiter-icons);
          }
        }
      }
    }
    & .docs-sidebar-palette .docs-sidebar-palette-button-container {
      & .docs-sidebar-palette-button {
        background-color: transparent;
        border-color: var(--ddocs-outline) !important;
        transition: var(--off);
        &.docs-material-button-hover {
          background-color: var(--ddocs-on-surface-variant-hover);
          transition: var(--on);
        }
        &.docs-material-button-focused {
          background-color: var(--ddocs-on-surface-variant-focus);
        }
        
        & .docs-icon-img {
          filter: invert() hue-rotate(200deg) brightness(180%) contrast(60%) saturate(2.5);
        }
      }
      &.goog-control-selected .docs-sidebar-palette-button {
        border-color: var(--ddocs-primary) !important;
      }
    }
    & .kix-text-wrapping-direction-dropdown, #kix-tablesidebar-table-tile-ltr, #kix-tablesidebar-cell-vertical-alignment {
      .outlined-dropdown-text-field();
    }
    & .docs-sidebar-tile .jfk-radiobutton .jfk-radiobutton-radio::before {
      z-index: unset;
    }
    & .kix-toc-sidebar-tab-leaders-select /* Choose a line between heading and page number */ {
      & .docs-material-gm-select-outer-box {
        border-color: var(--ddocs-outline);
        transition: var(--off);
      }
      & .docs-material-gm-select-hover .docs-material-gm-select-outer-box {
        border-color: var(--ddocs-on-surface-variant);
        transition: var(--on);
      }
      & .docs-material-gm-select-caption div {
        border-color: var(--ddocs-on-surface) !important;
      }
      & .docs-icon-arrow-dropdown {
        filter: var(--whiter-icons);
      }
    }
    & .docs-sidebar-palette-scroll-button {
      transition: var(--off);
      & .docs-icon-img {
        filter: var(--whiter-icons);
      }
      
      &.docs-material-button-disabled {
        background: none;
      }
      &.docs-material-button-hover {
        background-color: var(--ddocs-on-surface-hover);
        transition: var(--on);
      }
      &.docs-material-button-focused {
        background-color: var(--ddocs-on-surface-focus);
        border: none !important;
      }
      
      &>.docs-material-button-ripple-element {
        background-color: var(--ddocs-on-surface-pressed);
      }
    }
    & .docs-image-effect-recolor-button {
      .outlined-dropdown-text-field();
    }
    & .docs-material-slider-horizontal {
      .slider();
    }
    & .docs-image-effect-adjustment-reset-button {
      .outlined-button();
    }
    & :is(#kix-tablesidebar-cell-background-color-button, #kix-tablesidebar-table-border-color-button) .goog-flat-menu-button {
      border-color: var(--ddocs-outline);
      gap: 1rem;
      height: 3rem;
      padding: 1rem 0.75rem 1rem 1rem;
      transition: var(--off);
      &.goog-flat-menu-button-hover {
        border-color: var(--ddocs-on-surface);
        transition: var(--on);
      }
      &.goog-flat-menu-button-focused {
        border-color: var(--ddocs-primary);
        box-shadow: inset 0 0 0 1px var(--ddocs-primary);
      }
      
      & .goog-flat-menu-button-dropdown {
        filter: var(--whiter-icons);
        transition: transform 0.2s;
      }
    }
    & .kix-tablesidebar-table-border-width {
      .outlined-dropdown-text-field();
      &>.docs-material-gm-select-outer-box:has(.docs-material-gm-select-caption:empty) {
        padding-left: 0.75rem;
      }
      & .docs-material-gm-select-caption:not(:empty)+.docs-gm-arrow {
        margin-left: 1rem;
      }
    }
    & .kix-toc-sidebar-indent {
      &>.docs-material-gm-select-outer-box {
        .outlined-dropdown-text-field();
        padding-left: 1rem;
        transition: var(--off);
        & .docs-material-gm-select-inner-box {
          height: 100%;
        }
      }
      &.docs-material-gm-select-hover>.docs-material-gm-select-outer-box {
        border-color: var(--ddocs-on-surface-variant);
        transition: var(--on);
      }
      &.docs-material-gm-select-open>.docs-material-gm-select-outer-box {
        border-color: var(--ddocs-primary);
        box-shadow: inset 0 0 0 1px var(--ddocs-primary);
      }
    }
  }
  
  #docs-revisions-sidebar /* Version history sidebar; I’m going to style this like a M3 standard side sheet. */ {
    background-color: var(--ddocs-background);
    border-left: 1px solid var(--ddocs-outline-variant);
    box-shadow: none;
    
    &>.docs-revisions-sidebar-header {
      background-color: var(--ddocs-surface-container-high);
      border: none;
      color: var(--ddocs-on-surface);
      transition: background-color 0.2s;
      &:has(~.docs-revisions-sidebar-revisions-empty-container>.docs-revisions-sidebar-revisions-empty-named:not([style*="display: none;"])) {
        background: none;
      }
      
      & .docs-revisions-filter-selector>.docs-material-gm-select-outer-box {
        .outlined-text-field(@height: 2.25rem);
        
        & .docs-material-gm-select-caption {
          color: var(--ddocs-on-surface);
        }
        & .docs-icon-arrow-dropdown {
          filter: var(--whiter-icons);
        }
      }
    }
    
    & .docs-revisions-sidebar-revisions-empty-named /* No named versions */ {
      &>.docs-revisions-sidebar-revisions-empty-title {
        color: var(--ddocs-on-surface);
      }
      &>.docs-revisions-sidebar-revisions-empty-details {
        color: var(--ddocs-on-surface-variant);
      }
      &>.docs-revisions-sidebar-revisions-empty-learn-more {
        color: var(--ddocs-primary);
      }
    }
    
    & .docs-revisions-sidebar-date-group {
      background-color: var(--ddocs-surface-container);
      border: none;
      color: var(--ddocs-on-surface-variant);
      text-transform: unset;
    }
    & .docs-revisions-collapsible-pane {
      & .docs-revisions-tile {
        color: var(--ddocs-on-surface);
        transition: var(--off);
        &.docs-revisions-tile-hover {
          background-color: var(--ddocs-on-surface-hover);
          transition: var(--on);
        }
        
        & .docs-revisions-icon-img::before /* Expandable sections triangle */ {
        filter: invert();
        }
        & .docs-revisions-tile-text-box /* Version name */ {
          color: currentColor;
          &:hover {
            border-color: var(--ddocs-outline);
            transition: var(--on);
          }
          &:focus {
            border-color: var(--ddocs-primary);
            box-shadow: inset 0 0 0 1px var(--ddocs-primary);
          }
        }
        & .docs-revisions-tile-descriptor /* Current version */ {
          color: currentColor;
        }
        & .docs-revisions-tile-collaborator-name {
          color: var(--ddocs-on-surface-variant);
        }
        
        &.docs-revisions-tile-selected {
          background-color: var(--ddocs-primary-container);
          color: var(--ddocs-on-primary-container);
        }
      }
      
      &:not(:last-of-type) .docs-revisions-tile-content-wrapper {
        border-bottom-color: var(--ddocs-outline-variant);
      }
      &:last-of-type .docs-revisions-tile-content-wrapper {
        border: none;
      }
    }
    
    & .docs-revisions-sidebar-actions {
      border-top-color: var(--ddocs-outline-variant);
    }
  }
  
  .docs-gm.docs-grille-gm3 .emoji-detail-sidebar /* Appears when you click “See emoji reaction details” from the overflow menu of a comment */ {
    background-color: var(--ddocs-surface-container);
    
    &>.emoji-detail-sidebar-header {
      background: transparent;
      border-bottom: none;
      color: var(--ddocs-on-surface);
      
      &>.emoji-detail-sidebar-close-button-container {
        right: -8px;
        position: relative;
        
        &>.docs-material-button {
          .standard-icon-button();
          border-radius: 50%;
          height: 2.5rem;
          margin-right: 0;
          width: $height;
          &.docs-material-button-focused {
            border: none;
          }
          
          & .docs-material-button-content {
            line-height: 2.5rem;
          }
          & .docs-icon {
            margin-left: 2px;
            transform: scale(133%);
          }
        }
      }
    }
    
    & .emoji-detail-sidebar-user-timestamp {
      color: var(--ddocs-on-surface-variant);
    }
  }
  
  .docs-grille-gm3 #docs-chrome:has(.docs-companion-app-switcher-container:not(.docs-companion-app-switcher-container-collapsed))~.kix-watermark-sidebar /* Detects if the companion app sidebar is open */ {
    // margin-right: 0;
  }
  .docs-grille-gm3 .kix-watermark-sidebar {
    background-color: var(--ddocs-surface-container-low);
    margin-top: 6px;
    
    &>.kix-watermark-sidebar-header {
      background-color: var(--ddocs-surface-container);
      border: none;
      color: var(--ddocs-on-surface);
      
      & .kix-watermark-icon-container .docs-icon-img {
        filter: var(--paleblue-icons);
      }
      
      & .kix-watermark-sidebar-close {
        .standard-icon-button();
      }
    }
    
    &>.kix-watermark-tab-menu {
      border-bottom: 1px solid var(--ddocs-outline-variant);
      margin-top: 0;
      
      &>.docs-sidebar-toggle-tabs {
        background-color: var(--ddocs-surface-container);
        
        &>.docs-sidebar-toggle-tab {
          border-radius: 0;
          color: var(--ddocs-on-surface-variant);
          flex-grow: 1;
          margin-top: 0;
          transition: var(--off);
          &.jfk-button-hover {
            background-color: var(--ddocs-on-surface-hover);
            transition: var(--on);
          }
          &.jfk-button-focused {
            background-color: var(--ddocs-on-surface-focus);
          }
          &.docs-sidebar-toggle-tab-active {
            color: var(--ddocs-primary);
            &.jfk-button-hover {
              background-color: var(--ddocs-primary-hover);
            }
            &.jfk-button-focused {
              background-color: var(--ddocs-primary-focus);
            }
            
            & div::after {
              border-color: currentColor;
            }
          }
        }
      }
    }
    
    &>.kix-watermark-sidebar-body {
      scrollbar-color: var(--ddocs-outline) transparent;
      
      & .kix-watermark-section-header, .kix-watermark-format-label {
        color: var(--ddocs-on-surface);
      }
      & .kix-watermark-scale-combobox-container .goog-toolbar-combo-button /* Required a custom implementation */ {
        background: none !important;
        border-color: var(--ddocs-outline) !important;
        transition: var(--off);
        &.goog-toolbar-combo-button-hover {
          border-color: var(--ddocs-on-surface-variant) !important;
          transition: var(--on);
        }
        &:is(.goog-toolbar-combo-button-focused, .goog-toolbar-combo-button-open) {
          border-color: var(--ddocs-primary) !important;
          box-shadow: inset 0 0 0 1px var(--ddocs-primary);
        }
        
        & .goog-toolbar-combo-button-input {
          background: none !important;
          border: none !important;
          box-shadow: none !important;
          caret-color: var(--ddocs-primary);
          color: var(--ddocs-on-surface);
          &::selection {
            background-color: var(--ddocs-primary);
            color: var(--ddocs-on-primary);
          }
        }
        & .goog-toolbar-combo-button-dropdown {
          filter: var(--whiter-icons);
        }
      }
      
      &>.kix-watermark-image-tab {
        & .kix-watermark-select-image-button {
          color: var(--ddocs-on-surface-variant);
          height: auto !important;
          padding: 0 !important;
          &.docs-material-button-focused {
            border-color: var(--ddocs-primary) !important;
          }
          
          & .kix-watermark-image-select-view svg {
            fill: currentColor !important;
          }
          & .kix-watermark-image-select-box-label {
            color: currentColor;
          }
          
          & .kix-watermark-image-edit-view /* Once you’ve selected a watermark image */ {
            background: var(--ddocs-surface-container-highest);
            transition: var(--off);
            
            &>.kix-watermark-image-edit-icon {
              fill: currentColor !important;
            }
          }
        }
        
        & .kix-watermark-more-image-options-button {
          .text-button();
          display: inline-grid;
          place-items: center;
          &.docs-material-button-hover {
            background-color: var(--ddocs-primary-hover);
          }
          &.docs-material-button-focused {
            background-color: var(--ddocs-primary-focus);
          }
        }
      }
      
      &>.kix-watermark-text-tab {
        & .kix-watermark-text-input-container input /* Watermark text */ {
          .outlined-text-field();
          &:focus-visible {
            outline: none;
          }
        }
        & .kix-watermark-font-select-container {
          & .docs-material-gm-select-outer-box {
            border-color: var(--ddocs-outline);
            height: 3rem;
            padding: 0 0.75rem 0 1rem;
            transition: var(--off);
            &>.docs-material-gm-select-inner-box {
              height: 100%;
              & .docs-material-gm-select-caption {
                color: var(--ddocs-on-surface);
                font-size: 1rem;
              }
              & .docs-icon-arrow-dropdown {
                filter: var(--whiter-icons);
              }
            }
          }
          & .docs-material-gm-select-hover>.docs-material-gm-select-outer-box {
            border-color: var(--ddocs-on-surface-variant);
            transition: var(--on);
          }
          & .docs-material-gm-select-focused>.docs-material-gm-select-outer-box {
            border-color: var(--ddocs-primary);
            box-shadow: inset 0 0 0 1px var(--ddocs-primary);
          }
        }
        
        & .kix-watermark-font-size-control-container {
          & .goog-toolbar-button {
            background-color: transparent;
            transition: var(--off);
            &.goog-toolbar-button-hover {
              background-color: var(--ddocs-on-surface-variant-hover);
              transition: var(--on);
            }
            &.goog-toolbar-button-focused {
              background-color: var(--ddocs-on-surface-variant-focus);
            }
            &.goog-toolbar-button-active {
              background-color: var(--ddocs-on-surface-variant-pressed);
            }
            
            & .docs-icon-img {
              filter: var(--whiter-icons);
            }
          }
          & .kix-watermark-font-size-dec-button-container {
            border-color: var(--ddocs-outline);
            &:has(.goog-toolbar-button-disabled) {
              border-color: var(--ddocs-on-surface-disabled);
            }
            &>.goog-toolbar-button {
              border-radius: 2px 0 0 2px;
            }
          }
          & .kix-watermark-font-size-combo-box-container {
            & .jfk-textinput {
              background: none;
              border-color: var(--ddocs-outline);
              color: var(--ddocs-on-surface);
              transition: var(--off);
              &:hover {
                border-color: var(--ddocs-on-surface-variant);
                transition: var(--on);
              }
              &:focus {
                border-color: var(--ddocs-primary);
                box-shadow: inset 0 0 0 1px var(--ddocs-primary);
                transition: var(--on);
              }
            }
            & .goog-combo-button-disabled .jfk-textinput {
              border-color: var(--ddocs-on-surface-disabled);
              color: rgba(227, 227, 227, 38%);
            }
          }
          & .kix-watermark-font-size-inc-button-container {
            border-color: var(--ddocs-outline);
            &:has(.goog-toolbar-button-disabled) {
              border-color: var(--ddocs-on-surface-disabled);
            }
            &>.goog-toolbar-button {
              border-radius: 0 2px 2px 0;
            }
          }
        }
        & .kix-watermark-format-toolbar.goog-toolbar {
          background: none;
          border-color: var(--ddocs-outline);
          &:has(.goog-toolbar-button-disabled) {
            border-color: var(--ddocs-on-surface-disabled);
          }
          
          &>:is(.goog-toolbar-button, .goog-toolbar-menu-button) {
            background-color: transparent;
            transition: var(--off);
            &:is(.goog-toolbar-button-hover, .goog-toolbar-menu-button-hover) {
              background-color: var(--ddocs-on-surface-variant-hover);
              transition: var(--on);
            }
            &:is(.goog-toolbar-button-active, .goog-toolbar-menu-button-open) {
              background-color: var(--ddocs-on-surface-variant-pressed);
            }
            &.goog-toolbar-button-checked {
              background-color: var(--ddocs-primary-container);
              &.goog-toolbar-button-hover {
                background-color: var(--ddocs-on-primary-container-hover);
              }
              &.goog-toolbar-button-active {
                background-color: var(--ddocs-on-primary-container-pressed);
              }
            }
          }
          
          & .docs-icon-img {
            filter: var(--whiter-icons);
          }
        }
        
        & .kix-watermark-text-transparency-slider-container .docs-material-slider-horizontal {
          .slider();
        }
        
        & .kix-watermark-text-orientation-radio-button-group .jfk-radiobutton-radio::before {
          z-index: 0;
        }
        
        & .kix-watermark-text-placement-section .docs-sidebar-palette .docs-sidebar-palette-button-container {
          & .docs-sidebar-palette-button {
            background-color: transparent;
            border-color: var(--ddocs-outline) !important;
            transition: var(--off);
            &.docs-material-button-hover {
              background-color: var(--ddocs-on-surface-variant-hover);
              transition: var(--on);
            }
            &.docs-material-button-focused {
              background-color: var(--ddocs-on-surface-variant-focus);
            }

            & .docs-icon-img {
              filter: invert() hue-rotate(200deg) brightness(180%) contrast(60%) saturate(2.5);
            }
          }
          & .docs-sidebar-tile-input-label {
            color: var(--ddocs-on-surface);
          }
          &.goog-control-selected .docs-sidebar-palette-button {
            border-color: var(--ddocs-primary) !important;
          }
          &.goog-control-disabled .docs-sidebar-tile-input-label {
            opacity: 38%;
          }
        }
      }
    }
    
    &>.kix-watermark-remove-button-container {
      border-top-color: var(--ddocs-outline-variant);
      
      &>.kix-watermark-remove-button {
        background: none;
        border-radius: 0;
        color: var(--ddocs-primary);
        transition: var(--off);
        &.docs-material-button-hover {
          background-color: var(--ddocs-primary-hover);
          transition: var(--on);
        }
        &.docs-material-button-focused {
          background-color: var(--ddocs-primary-focus);
        }
        &.docs-material-button-active {
          background-color: var(--ddocs-primary-pressed);
        }
        
        & svg {
          fill: currentColor !important;
        }
      }
    }
  }
}

@-moz-document url-prefix("https://docs.google.com/picker/v2/home?req=%5B%22ireq%22%2C%5Bnull%2C%5B%5B1%2C6%5D%2C%5B%5D%2C%5B%5D%2C%5B%5D%2C%5B2048%2C2048%5D%5D%2C%5B1%5D%2Cnull%2Cnull%2C%5B"), regexp("https:\\/\\/docs\\.google\\.com\\/picker\\/v2\\/home\\?req=.*%22Google%20Drive%22.*%22Replace%22.*%22replace-image%22.*&parent=https%3A%2F%2Fdocs\\.google\\.com&pfname=&rpctoken=[0-9]+"), regexp("https:\\/\\/docs\\.google\\.com\\/picker\\/v2\\/home\\?req=.*%22explore-drive.*&parent=https%3A%2F%2Fdocs\\.google\\.com&pfname=&rpctoken=[0-9]+") { 
  // Google Drive file picker
  // Insert, replace, explore
  :root, .XV0XSd.KkxPLb {
    --dt-on-background: var(--ddocs-on-background);
    --dt-on-surface: var(--ddocs-on-surface);
    --dt-on-surface-variant: var(--ddocs-on-surface-variant);
    --dt-primary: var(--ddocs-primary);
    --dt-on-primary: var(--ddocs-on-primary);
    --dt-primary-container: var(--ddocs-primary-container);
    --mdc-ripple-hover-opacity: var(--ddocs-hover-state-layer-opacity);
  }

  body.yYWAMb {
    background-color: var(--ddocs-surface-container-low);
  }
  
  .Q6HCU.kRP9Nb.DgpDtf.uGAPab /* Container of everything */ {
    &.Cj5uFb /* When scrolled */ {
      & .gyDYrb>.yawtRb.wSZLdc /* Titlebar */, 
      & .yvPjCb /* Tab bar */, 
      & .iZJb2e /* Breadcrumb bar */, 
      & .ndfHFb-jyrRxf-tJHJj /* Bar with sort order (list view) */ {
        background-color: var(--ddocs-surface-container-high); // To show elevation 
        transition: background 0.1s;
      }
    }
  }
  
  .gyDYrb>.yawtRb.wSZLdc /* Titlebar */ {
    background: none;
    transition: background 0.2s;

    & button {
      --dt-neutral-action-stateful: var(--ddocs-on-surface-variant);
      --dt-neutral-action-state-layer: var(--ddocs-on-surface-variant);

      & svg {
        fill: var(--ddocs-on-surface-variant);
      }
    }
  }
  
  .gyDYrb>.yawtRb.RBphC /* Search bar */ {
    background-color: var(--ddocs-surface-container-high);
    
    & .fjSJOb {
      background: none;
      
      & button {
        --dt-neutral-action-stateful: var(--ddocs-on-surface-variant);
        --dt-neutral-action-state-layer: var(--ddocs-on-surface-variant);

        & svg {
          fill: var(--ddocs-on-surface-variant);
        }
      }
      
      & input.yNVtPc /* Placeholder */ {
        color: var(--ddocs-on-surface-variant);
        opacity: 1;
        -webkit-text-fill-color: currentColor;
      }
      & input.Ax4B8 /* Search terms is in a separate input element for some reason */ {
        color: var(--ddocs-on-surface);
      }
      
      & .tWfTvb>.jBmls /* Filters */ {
        background-color: var(--ddocs-surface-container-high);
        border-top: 1px solid var(--ddocs-outline);
        box-shadow: none;
        margin-top: 0;
        
        & .gtjro /* Filter results by */ {
          color: var(--ddocs-on-surface-variant);
        }
        & .oKubKe[aria-selected="true"] /* Filter */ {
          background-color: var(--ddocs-on-surface-focus);
        }
        & .OH19Oe, .C2fNU /* Filter text and icon */ {
          color: var(--ddocs-on-surface);
          
          & [fill="#757575"] {
            fill: var(--ddocs-on-surface-variant);
          }
        }
      }
    }
  }

  .yvPjCb /* Tab bar */ {
    background: none;
    border-bottom-color: var(--ddocs-outline-variant);
    transition: background 0.2s;

    &>.VfPpkd-AznF2e-ZMv3u /* Tabs */ button.WbUJNb /* Tab */ {
      color: var(--ddocs-on-surface-variant);
      &.VfPpkd-AznF2e-OWXEXe-auswjd /* Selected tab */ {
        color: var(--ddocs-primary);

        & .rvBHac>.VfPpkd-AznF2e-wEcVzc-OWXEXe-NowJzb /* Tab underline */ {
          border-color: currentColor;
        }
      }

      & span.VfPpkd-jY41G-V67aGc /* Tab text */ {
        color: currentColor;
      }

      & .VfPpkd-YVzG2b /* Ripple */ {
        --mdc-ripple-color: currentColor;
      }
    }

    & button.avhARe /* Tab scroll button */ {
      &>svg.N5Br5 {
        background-color: var(--ddocs-surface-container-highest);
        fill: var(--ddocs-on-surface);
      }
    }
  }
  
  .ye3Lg /* Breadcrumb and files area */ {
    background: none;
  }

  .iZJb2e /* Breadcrumb bar */ {
    transition: background 0.2s;
    
    & .fuIls /* Caret */ {
      opacity: 1;
    }

    & .kZyufc /* Grid/list view switch */ {
      & .VTBa7b /* Ripple */ {
        background-image: radial-gradient(circle farthest-side, var(--ddocs-on-surface-variant-focus), var(--ddocs-on-surface-variant-focus) 80%, var(--ddocs-on-surface-variant-focus) 100%);
      }
    }

    &+.GtrNOb /* Line below breadcrumb bar */ {
      display: none;
    }
  }
  
  .Cj5uFb .GtrNOb /* Line below breadcrumb bar */ {
    display: none;
  }
  
  .SI7vke .ndfHFb-XuHpsb-haAclf /* Files area */ {
    background: transparent;
    border: none;
    scrollbar-color: var(--ddocs-outline) transparent;
    
    & .ndfHFb-ObfsIf-Bpn8Yb-uDEFge-sM5MNb-Mk9A4c /* Bar with sort order (grid view) */ {
      & .ndfHFb-Bz112c-LgbsSe.ndfHFb-fmcmS-LgbsSe:not(.VIpgJd-Kb3HCc-LgbsSe-OWB6Me):not(.tk3N6e-LgbsSe-OWB6Me) /* Sorting attribute */ {
        &:focus {
          background-color: var(--ddocs-on-surface-focus);
        }
      }
      & .ndfHFb-Bz112c-LgbsSe /* Sorting direction */ {
        &:focus {
          background-color: var(--ddocs-on-surface-focus);
        }
      }
    }
    & .ndfHFb-jyrRxf-tJHJj /* Bar with attributes and sorting controls (list view) */ {
      border-bottom: none;
      transition: background 0.2s;
      
      & .ndfHFb-jyrRxf-Bpn8Yb-mhHukc-hFsbo svg {
        fill: var(--ddocs-on-surface-variant);
      }
    }
    
    & .ndfHFb-ObfsIf-jXK9ad-haAclf /* Each file (grid view) */ {
      background-color: var(--ddocs-surface-container-highest);
      border-radius: 12px;
      
      &>.eizQhe-ObfsIf-jXK9ad /* Kinda using this as a state layer */ {
        background: none;
        border-color: transparent;
        border-radius: 12px;
        color: var(--ddocs-on-surface);
        transition: var(--off);
        width: calc(100% - 2px);
      }
      &:hover>.eizQhe-ObfsIf-jXK9ad {
        background-color: var(--ddocs-on-surface-hover);
        transition: var(--on);
      }
      &:focus>.eizQhe-ObfsIf-jXK9ad {
        background-color: var(--ddocs-on-surface-focus);
      }
      &[aria-selected="true"]>.eizQhe-ObfsIf-jXK9ad {
        background-color: var(--ddocs-primary-container);
        border-color: var(--ddocs-primary);
        color: var(--ddocs-on-primary-container);
      }
      
      & .eizQhe-ObfsIf-mJRMzd-PFprWc:not(.HiaYvf-SfQLQb-jAb3A-AHe6Kc) /* Background around folder icons (when sorted not by name) */ {
        background: none;
      }
      .HiaYvf-SfQLQb-jAb3A-AHe6Kc /* File thumbnail transparent areas */ {
        background-color: var(--darkestgray);
        background-image:
          linear-gradient(45deg, var(--ddocs-surface-container-highest) 25%,transparent 25%,transparent 75%, var(--ddocs-surface-container-highest) 75%, var(--ddocs-surface-container-highest)),
          linear-gradient(45deg, var(--ddocs-surface-container-highest) 25%,transparent 25%,transparent 75%, var(--ddocs-surface-container-highest) 75%, var(--ddocs-surface-container-highest));
      }
      
      & .eizQhe-ObfsIf-r4nke, span.eizQhe-mJRMzd-V1ur5d-fmcmS /* File name */ {
        color: currentColor;
      }
    }
    
    & .ndfHFb-jyrRxf-oKdM2c /* Each file (list view) */ {
      
      &>.ndfHFb-jyrRxf-eEDwDf {
        border-bottom-color: var(--ddocs-outline-variant);
        
        & .ndfHFb-vWsuo-s4QLm-ibnC6b /* Share date */ {
          color: var(--ddocs-on-surface-variant);
        }
        
        & .eizQhe-jyrRxf-TzA9Ye-Bz112c-uqeOfd {
          opacity: 1;
          
          &>svg.ndfHFb-vWsuo-haDnnc-At1hV-edvN0e {
            fill: var(--ddocs-on-surface-variant);
          }
        }
      }
      
      &:focus {
        outline: none;
        &::after {
          opacity: var(--ddocs-focus-state-layer-opacity);
        }
        &>.ndfHFb-jyrRxf-eEDwDf {
          border-bottom-color: var(--ddocs-outline-variant);
          &>.ndfHFb-jyrRxf-eEDwDf-hpYHOb-Q4BLdf {
            border: none !important;
            padding: 1px 0 0 1px !important;
          }
        }
      }
      &.ndfHFb-jyrRxf-oKdM2c-gk6SMd /* Selected */ {
        color: var(--ddocs-on-primary-container);
        
        & .ndfHFb-jyrRxf-eEDwDf-BPrWId {
          border: none !important;
          padding-left: 1px !important;
        }
        & .eizQhe-jyrRxf-V1ur5d-r4nke>span.eizQhe-mJRMzd-V1ur5d-fmcmS {
          color: var(--ddocs-on-primary-container);
        }
      }
    }
  }
  
  .ndfHFb-xl07Ob /* Menus */ {
    background-color: var(--ddocs-surface-container-high);
    
    &.ndfHFb-xl07Ob-ZiwkRe::after /* Used for opening animation */ {
      background-image: linear-gradient(to bottom, transparent 0%, var(--ddocs-surface-container-high) 50%);
    }
    
    & .VIpgJd-j7LFlb-sn54Q /* Highlighted menu item */ {
      background-color: transparent;
    }
  }
  
  table td.gssb_e /* Search suggestions */ {
    background-color: var(--ddocs-surface-container-high);
    border-bottom: none;
    border-top: 1px solid var(--ddocs-outline);
    
    & table.gssb_m {
      background: none;
      color: var(--ddocs-on-surface);
      
      & .gssb_i /* Hovered suggestions */ {
        background-color: var(--ddocs-on-surface-hover);
      }
      
      & svg[fill="#808080"] /* Magnifying glass icon */ {
        fill: var(--ddocs-on-surface-variant);
      }
      & .gstq_c /* Email addresses */ {
        color: var(--ddocs-on-surface-variant);
      }
    }
  }

  .ndfHFb-jyrRxf-haAclf .ndfHFb-rBfmuc-E2o6qc-tJHJj /* Time range separators (in "Recent" view) */ {
    border-bottom-color: var(--darkgray);
    padding-left: 20px;
  }
  .pGOlGd .ndfHFb-jyrRxf-haAclf .ndfHFb-rBfmuc-E2o6qc-V67aGc /* Time range text */ {
    color: var(--lightgray);
  }
  img.eizQhe-ObfsIf-mJRMzd-PFprWc-RJLb9c /* File thumbnails */ {
    filter: brightness(80%);
  }
  
  .eizQhe-jyrRxf-V1ur5d-r4nke > .eizQhe-mJRMzd-V1ur5d-fmcmS, .eizQhe-jyrRxf-V1ur5d-r4nke /* List view file names */,
  .eizQhe-ObfsIf-J2xVie-ndfHFb-haAclf .eizQhe-ObfsIf-r4nke /* Shared drives */ {
    color: var(--ddocs-on-surface);
  }
  .eizQhe-ObfsIf-J2xVie-ndfHFb-MZArnb-UjZuef /* Shared drive properties */ {
    color: var(--ddocs-on-surface-variant);
  }

  .ndfHFb-vWsuo-haDnnc-At1hV-edvN0e /* Shared file icon */ {
    fill: var(--ddocs-on-surface-variant);
  }

  .BxNLed /* Bottom bar with Insert button */ {
    background-color: var(--ddocs-surface-container-highest);
    
    &>.jg93qc button /* X button */ {
      color: var(--ddocs-on-surface-variant) !important;
      
      & .VfPpkd-Bz112c-Jh9lGc /* Ripple */ {
        --mdc-ripple-color: currentColor;
      }
      & svg {
        fill: currentColor;
      }
    }
    
    &>.e0eYxe /* # selected */ {
      color: var(--ddocs-on-surface);
    }
    
    &>.HUStxf>button /* Insert button */ {
      border-radius: 1.25rem;
      height: 2.5rem;
    }
  }
}

@-moz-document url-prefix("https://docs.google.com/picker/v2/home?req=%5B%22ireq%22%2C%5Bnull%2C%5B%5B1%5D%2C%5B%5D%2C%5B%5D%2C%5B%5D%2C%") {
  // Google Images picker; also used in the Explore panel 

  .DgpDtf .yawtRb, .fjSJOb /* Search bar background */ {
    background-color: var(--ddocs-surface-container-high);
  }
  .CjshKe /* Landing page background */ {
    background-color: var(--ddocs-surface-container-low);
    scrollbar-color: var(--ddocs-outline) transparent;
  }

  .bL32m /* Panel close button */ {
    & .VfPpkd-Bz112c-Jh9lGc /* Ripple */ {
      --mdc-ripple-color: var(--ddocs-on-surface-variant);
      --mdc-ripple-hover-opacity: var(--ddocs-hover-state-layer-opacity);
    }
    & svg path:not([fill="none"]) {
      fill: var(--ddocs-on-surface-variant);
    }
  }

  .fjSJOb input.yNVtPc /* Search bar placeholder */ {
    color: var(--ddocs-on-surface-variant);
    opacity: 100%;
    -webkit-text-fill-color: currentColor; // Somehow Firefox understands this.
  }
  .fjSJOb input.Ax4B8 /* Search terms */ {
    color: var(--ddocs-on-surface);
  }
  
  .Cj5uFb .GtrNOb /* White line below search bar? */ {
    display: none;
  }

  .GtrNOb /* Search bar bottom border */ {
    display: none;
  }

  img.hTbDCf /* Google logo */ {
    filter: saturate(0) brightness(400%) opacity(90%);
  }
  .UCvCZb /* "images" */ {
    color: var(--ddocs-primary);
  }

  .kkN4Se /* Copyright warning */ {
    color: var(--ddocs-on-surface-variant);
  }
  .kkN4Se a /* "Learn more" */ {
    color: var(--ddocs-primary);
  }

  .VOEIyf .jBmls /* Search suggestions box */ {
    background-color: var(--ddocs-surface-container-high);
    border-top: 1px solid var(--ddocs-outline-variant) !important;
    box-shadow: none !important;
    margin-top: 0 !important;
  }
  .VOEIyf, .VOEIyf .jBmls, .oKubKe /* Search suggestion text */ {
    color: var(--ddocs-on-surface);
    transition: var(--off);
  }
  .oKubKe[aria-selected="true"] /* Highlighted search suggestion */ {
    background-color: var(--ddocs-on-surface-focus);
    transition: var(--on);
  }
  
  .ZNI2yf /* Image grid */ {
    padding: 1rem 0 0 !important;
    scrollbar-gutter: stable both-edges;
    text-align: center;
  }
  
  .KXOEcf /* Image frames (I’m copying the image selection appearance from Google Photos) */ {
    background-color: transparent;
    box-sizing: border-box;
    margin: 2px;
    padding: 0 !important;
    &:focus {
      --dt-primary: var(--ddocs-primary);
    }
    &.qRC4xd.LLcSke /* Selected images when inserting images */ .gdd2W {
      transform: none;
      
      &>.YaUWZc /* Checkmark */ {
        left: 1px;
        top: 1px;
        transform: none;
        
        & svg {
          & ellipse /* Changes the colour of the checkmark icon, not the circle. idk. */ {
            fill: var(--ddocs-on-primary);
          }
          & path[fill="#4285F4"] {
            fill: var(--ddocs-primary);
          }
        }
      }
      
      &>.S2D11c>img.HVqWzd /* Shrink the image */ {
        border-radius: 0.5rem;
        height: calc(100% - 1.5rem) !important;
        margin: 0.75rem;
        width: $height;
      }
    }
    &.qRC4xd.hRhgjf /* Selected images when replacing images */ {
      box-shadow: none;
      padding: 0 !important;
      
      &>.S2D11c>img.HVqWzd /* Shrink the image */ {
        border-radius: 0.5rem;
        height: calc(100% - 1.5rem) !important;
        margin: 0.75rem;
        width: $height;
      }
    }
    &.qRC4xd /* Selected images */ {
      & .bpjvz /* Magnifying glass shadow */ {
        height: calc(100% - 1.5rem);
        margin: 0.75rem;
        transform: none;
        width: $height;
        &>.eppE7e {
          border-radius: 0.5rem;
        }
      }
    }
    &>.S2D11c /* Div behind image */ {
      background-color: var(--ddocs-primary); // Google Photos would use #384355 but I don’t have a checkmark icon to more clearly indicate selection when replacing images. 
    }
    & .YaUWZc+.S2D11c /* Div behind image, but when there is a checkmark to indicate selection */ {
      background-color: #384355;
    }
    & img.HVqWzd /* Image */,
    & .bpjvz /* Container with magnifying glass and its shadow */ {
      transition: all 0.2s;
    }
    & .eppE7e /* Shadow to make magnifying glass more visible*/ {
      background-clip: unset;
      transition: all 0.2s;
    }
  }
  
  @media (prefers-reduced-motion) {
    .KXOEcf :is(img.HVqWzd, .bpjvz, .eppE7e) {
      transition: none !important;
    }
  }
  
  .KXOEcf.r9htBf.v4FXkf /* + button to add image into document (when using image picker in the Explore panel) */ {
    & .MokjHc /* Background */ {
      background-color: var(--ddocs-tertiary);
      border-radius: 50%;
      margin: 0.5rem;
      opacity: 1;
      transition: var(--off);
    }
    & .df7kUc /* Icon */ {
      margin: 0.5rem;
      &:hover~.MokjHc {
        background-color: var(--ddocs-on-tertiary-hover);
        transition: var(--on);
      }
      &:focus~.MokjHc {
        background-color: var(--ddocs-on-tertiary-focus);
      }
      & path#Combined-Shape {
        fill: var(--ddocs-on-tertiary) !important;
      }
    }
    &:is(:hover, :focus) .df7kUc {
      opacity: 1;
    }
  }

  .BxNLed /* Bottom bar with item count and Insert button */ {
    background-color: var(--ddocs-surface-container-highest);
    &>div.jg93qc /* X button */ {
      & button>.VfPpkd-Bz112c-Jh9lGc /* Ripple */ {
        --mdc-ripple-color: var(--ddocs-on-surface-variant);
        --mdc-ripple-hover-opacity: var(--ddocs-hover-state-layer-opacity);
      }
      & svg {
        fill: var(--ddocs-on-surface);
      }
    }
    &>.e0eYxe /* Item count */{
      color: var(--ddocs-on-surface);
    }
    &>div.HUStxf>button /* Replace button */ {
      background-color: var(--ddocs-primary);
      border-radius: 1.25rem;
      color: var(--ddocs-on-primary);
      height: 2.5rem;
      --gm-fillbutton-state-color: currentColor;
      --mdc-ripple-hover-opacity: var(--ddocs-hover-state-layer-opacity);
      --mdc-ripple-focus-opacity: var(--ddocs-focus-state-layer-opacity);
      --mdc-ripple-press-opacity: var(--ddocs-pressed-state-layer-opacity);
    }
  }
}

@-moz-document regexp("https:\\/\\/docs\\.google\\.com\\/picker\\/v2\\/home\\?req=.*%22Google%20Photos%22.*&parent=https%3A%2F%2Fdocs\\.google\\.com&pfname=&rpctoken=[0-9]+") {
  // Google Photos picker
  :root, .XV0XSd.KkxPLb {
    --dt-primary: var(--ddocs-primary);
    --dt-on-primary: var(--ddocs-on-primary);
    --dt-primary-container: var(--ddocs-primary-container);
    --dt-on-background: var(--ddocs-on-background);
    --dt-surface-variant: var(--ddocs-surface-container-highest);
    --dt-on-surface-variant: var(--ddocs-on-surface-variant);
    --dt-neutral-action-state-layer: var(--ddocs-on-surface-variant);
    
    --mdc-ripple-hover-opacity: var(--ddocs-hover-state-layer-opacity);
    --mdc-ripple-focus-opacity: var(--ddocs-focus-state-layer-opacity);
  }
  
  .yawtRb .Icoilb svg /* Close icon */, 
  .yawtRb .lVYtmc svg /* Back icon */, 
  .yawtRb .vaAiZ svg /* Search icon */ {
    fill: var(--ddocs-on-surface-variant);
  }
  
  body.yYWAMb {
    background-color: var(--ddocs-surface-container-low);
  }
  
  .Q6HCU.kRP9Nb.DgpDtf.uGAPab.yxmr8b /* Container of everything */ {
    &.Cj5uFb /* When scrolled */ {
      &>.pw1uU+div /* Top */ {
        background-color: var(--ddocs-surface-container-high);
        transition: background-color 0.1s;
      }
    }
  }
  
  .DgpDtf>.pw1uU+div /* Top */ {
    transition: background-color 0.2s;
    
    &>.gyDYrb /* Title bar */ >.yawtRb {
      background: none;
    }
    
    &>.gyDYrb .fjSJOb /* Search bar */ {
      background: none;
      &:focus-within {
        background-color: var(--ddocs-surface-container-high);
      }
      
      & .VOEIyf /* Search field */ {
        & input.yNVtPc /* Placeholder */ {
          color: var(--ddocs-on-surface-variant);
          opacity: 1;
          -webkit-text-fill-color: currentColor;
        }
        & input.Ax4B8 /* Search terms */ {
          color: var(--ddocs-on-surface);
        }
      }
    }
    
    &>.yvPjCb /* Tab bar */ {
      background: none;
      border-bottom-color: var(--ddocs-outline-variant);
      
      & button.VfPpkd-AznF2e /* Tab */ {
        color: var(--ddocs-on-surface-variant);
        &.VfPpkd-AznF2e-OWXEXe-auswjd /* Selected tab */ {
          color: var(--ddocs-primary);
        }
        
        & .VfPpkd-YVzG2b /* Ripple */ {
          --mdc-ripple-color: currentColor;
        }
        
        & .VfPpkd-jY41G-V67aGc /* Tab text */ {
          color: inherit;
        }
        & .rvBHac .VfPpkd-AznF2e-wEcVzc-OWXEXe-NowJzb /* Selected tab underline */ {
          border-color: currentColor;
        }
      }
    }
  }
  
  .H0U9m /* Main area */ .sz33sf {
    background: none;
    
    & .GtrNOb /* Border and shadow below tab bar */ {
      display: none; // Material 3 uses colour tones, not shadows, to depict elevation.
    }
    
    & .uxFseb /* Breadcrumbs area */ .fuIls {
      opacity: 1;
      
      &>svg[fill="#000000"] {
        fill: var(--ddocs-on-surface-variant);
      }
    } 
    
    & .rbd1le, .ZNI2yf /* Actual main area */ {
      scrollbar-color: var(--ddocs-outline) transparent;
      
      & .KXOEcf /* Image frames */ {
        background-color: var(--ddocs-primary-container);
        
        & .YaUWZc /* Checkmark */ {
          background-color: #384355;
          border-radius: 50%;
          height: min-content; // To add a gap between checkmark and photo
          left: 6px;
          top: $left;
          transform: none;
          width: $height;
          
          & svg {
            & [fill="#ffffff"] {
              fill: var(--ddocs-on-primary);
            }
            & [fill="#4285F4"] {
              fill: var(--ddocs-primary);
            }
          }
        }
        & .YaUWZc+.S2D11c /* Inner image frame when checkmark is available */ {
          background-color: #384355;
        }
        
        & .S2D11c /* Inner image frame when checkmark is not available */ {
          background-color: var(--ddocs-primary);
        }
        
        & img {
          transition: all 0.2s;
        }
        
        &>.bpjvz /* Magnifying glass area */ {
          transition: all 0.2s;
        }
        
        &[aria-selected="true"] /* Selected images */ {
          box-shadow: unset;
          &>.gdd2W {
            transform: unset;
          }
          & img {
            border-radius: 0.5rem;
            height: calc(100% - 1.5rem) !important;
            margin: 0.75rem;
            width: $height;
          }
          &>.bpjvz /* Magnifying glass shadow */ {
            height: calc(100% - 1.5rem);
            margin: 0.75rem;
            transform: unset;
            width: $height;
            
            &>.eppE7e {
              border-radius: 0.75rem;
            }
          }
        }
      }
    }
    & .ZNI2yf /* Actual main area for Albums tab */ {
      
      &>.KXOEcf, .iGHc9 {
        background: none;
      }
      & img.TVbZhd /* Album covers */ {
        border-radius: 0.75rem;
      }
    }
  }
  
  @media (prefers-reduced-motion) {
    .KXOEcf :is(img, .bpjvz, .eppE7e) {
      transition: none !important;
    }
  }
  
  .R9Lal, .saXBZ /* No search results */ {
    color: var(--ddocs-on-surface);
  }
  
  .aw9Lfe>.BxNLed /* Insert button bar */ {
    
    &>.jg93qc button /* X button */ {
      color: var(--ddocs-on-primary-container);
      
      & .VfPpkd-Bz112c-Jh9lGc {
        --mdc-ripple-color: currentColor;
      }
      & svg[fill="#3367d6"] {
        fill: currentColor;
      }
    }
    
    &>.e0eYxe /* Number of selected items */ {
      color: var(--ddocs-on-primary-container);
    }
    
    &>.HUStxf button /* Insert button */ {
      border-radius: calc($height / 2);
      height: 2.5rem;
      
      & .VfPpkd-Jh9lGc /* Ripple */ {
        --gm-fillbutton-state-color: var(--ddocs-on-primary);
      }
    }
  }
}

@-moz-document regexp("https:\\/\\/docs\\.google\\.com\\/sharing\\/boq\\/driveshare\\?[\\s\\S]+origin=https%3A%2F%2Fdocs\\.google\\.com") {
  // Share dialog
  
  body.vhoiae.KkxPLb {
    scrollbar-color: var(--ddocs-outline) transparent;
    
    // Hijack the original variables
    // The share dialog already M3 so I don’t need to do much more changes than recolouring. 
    --dt-primary: var(--ddocs-primary);
    --dt-primary-action: var(--ddocs-primary);
    --dt-on-primary: var(--ddocs-on-primary);
    --dt-primary-action-stateful: var(--ddocs-on-primary-hover);
    --dt-primary-action-state-layer: var(--ddocs-primary);
    --gm3-sys-color-primary: var(--ddocs-primary);
    
    --dt-tertiary-container: var(--ddocs-tertiary-container);
    --dt-tertiary-container-icon: var(--ddocs-on-tertiary-container);
    
    --dt-background: var(--ddocs-background);
    --dt-on-background: var(--ddocs-on-background);
    
    --dt-surface1: var(--ddocs-surface-container-low);
    --mdc-theme-surface: var(--ddocs-surface);
    --dt-surface3: var(--ddocs-surface-container-high);
    --dt-neutral-container: var(--ddocs-surface-container-highest);
    --dt-on-surface: var(--ddocs-on-surface);
    --gm3-sys-color-on-surface: var(--ddocs-on-surface);
    --dt-neutral-container-icon: var(--ddocs-on-surface);
    --mdc-theme-on-surface: var(--ddocs-on-surface);
    --dt-on-surface-variant: var(--ddocs-on-surface-variant);
    --gm3-sys-color-on-surface-variant: var(--ddocs-on-surface-variant);
    --gm-outlinedtextfield-placeholder-color: var(--ddocs-on-surface-variant);
    
    --dt-outline: var(--ddocs-outline);
    
  }

  .KC1dQ /* Background */ {
    background-color: var(--ddocs-background);
    border-radius: 28px;
  }
  
  body.vhoiae div.mNL6p /* Titlebar */ {
    margin-right: 12px;
    
    & .d3Kuye h2.zv7tnb /* Headline */ {
      color: var(--ddocs-on-surface);
    }
    
    & button.VfPpkd-Bz112c-LgbsSe /* Support and Settings buttons */ {
      & i.google-material-icons /* The help and settings button use an icon font */, 
      & svg /* The back button uses an SVG */ {
        color: var(--ddocs-on-surface);
      }
      & div.VfPpkd-Bz112c-Jh9lGc::before, 
      & div.VfPpkd-Bz112c-Jh9lGc::after /* Ripple effects */ {
        background-color: white;
      }
    }
  }
  
  .vhoiae .ZelW3e:hover .FYhd9e, .vhoiae .ZelW3e:focus-within .FYhd9e, .X9XeLb .ZelW3e:hover .FYhd9e, .X9XeLb .ZelW3e:focus-within .FYhd9e, .cWKK1c .ZelW3e:hover .FYhd9e, .cWKK1c .ZelW3e:focus-within .FYhd9e, .aJfoSc .ZelW3e:hover .FYhd9e, .aJfoSc .ZelW3e:focus-within .FYhd9e, .TOb6Ze .ZelW3e:hover .FYhd9e, .TOb6Ze .ZelW3e:focus-within .FYhd9e /* Hovering over people with access */, 
  .vhoiae .lfDNBb:hover, .vhoiae .lfDNBb:focus-within, .X9XeLb .lfDNBb:hover, .X9XeLb .lfDNBb:focus-within, .cWKK1c .lfDNBb:hover, .cWKK1c .lfDNBb:focus-within, .aJfoSc .lfDNBb:hover, .aJfoSc .lfDNBb:focus-within, .TOb6Ze .lfDNBb:hover, .TOb6Ze .lfDNBb:focus-within /* Hovering over general access */ {
    background-color: var(--ddocs-on-surface-hover);
  }
  .fOEalf .Jw4Ike /* Name of person with access */ {
    color: var(--ddocs-on-surface);
  }
  .SbpzSe .VfPpkd-StrnGf-rymPhb-f7MjDc /* Checkmark in general access menu */ {
    color: var(--ddocs-primary);
  }
  
  .iH5TDd /* Tooltips */ {
    background-color: var(--ddocs-inverse-surface);
  }
}
