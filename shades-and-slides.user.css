/* ==UserStyle==
@name           Shades and Slides
@namespace      userstyles.world/user/winghongchan
@version        2023.07.12
@description    A Material 3 themed dark mode for Google Slides
@author         Walter winghongchan
@homepageURL    https://github.com/winghongchan/dark-docs
@supportURL     https://github.com/winghongchan/dark-docs/issues
@license        GPL-3.0-or-later
@preprocessor   less
@var            checkbox ripples "Ripple animations" 1
==/UserStyle== */

@-moz-document url-prefix("https://docs.google.com/presentation/d/") {
  // Variables
  
  :root {
    
    // Colour
    --ddocs-primary: #a8c7fa;
    --ddocs-primary-icon: invert(100%) hue-rotate(190deg) brightness(125%) saturate(95%);
    --ddocs-primary-hover: rgba(168, 199, 250, var(--ddocs-hover-state-layer-opacity)); // Not “on-” state layers are the role colour at a reduced opacity. 
    --ddocs-primary-focus: rgba(168, 199, 250, var(--ddocs-focus-state-layer-opacity));
    --ddocs-primary-pressed: rgba(168, 199, 250, var(--ddocs-pressed-state-layer-opacity));
    --ddocs-on-primary: #062e6f;
    --ddocs-on-primary-checkmark: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxIDEiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaW5ZTWluIG1lZXQiPjxwYXRoIGQ9Ik0uMDQuNjI3LjE0Ni41Mi40My44MDQuMzIzLjkxem0uMTc3LjE3N0wuODU0LjE2Ny45Ni4yNzMuMzIzLjkxeiIgZmlsbD0iIzA2MmU2ZiIvPjwvc3ZnPgo=");
    --ddocs-on-primary-hover: #9bbaef; // “on-” state layers are the “on-” colour at a reduced opacity overlaid on the corresponding not “on-” colour.
    --ddocs-on-primary-focus: #94b4e9;
    --ddocs-on-primary-pressed: #94b4e9;
    --ddocs-primary-container: #004a77;
    --ddocs-on-primary-container: #c2e7ff;
    --ddocs-on-primary-container-icon: invert(100%) hue-rotate(180deg) saturate(150%);
    --ddocs-on-primary-container-hover: #0f5682;
    --ddocs-on-primary-container-focus: #185d88;
    --ddocs-on-primary-container-pressed: #185d88;
    --ddocs-secondary: #7fcfff;
    --ddocs-on-secondary: #003355;
    --ddocs-secondary-container: #0842a0;
    --ddocs-secondary-container-hover: #184fa8; // Determined the colour by overlapping the -on colour at 8% opacity on top of the container. Not a problem until Dark Docs begins support for custom colours. 
    --ddocs-secondary-container-focus: #2156ac;
    --ddocs-on-secondary-container: #d3e3fd;
    --ddocs-on-secondary-container-hover: rgba(211, 227, 253, var(--ddocs-hover-state-layer-opacity));
    --ddocs-on-secondary-container-focus: rgba(211, 227, 253, var(--ddocs-focus-state-layer-opacity));
    --ddocs-on-secondary-container-pressed: rgba(211, 227, 253, var(--ddocs-pressed-state-layer-opacity));
    --ddocs-tertiary: #6dd58c;
    --ddocs-on-tertiary: #0a3818;
    --ddocs-on-tertiary-hover: #64c882;
    --ddocs-on-tertiary-focus: #61c27e;
    --ddocs-on-tertiary-pressed: #61c27e;
    --ddocs-tertiary-container: #0f5223;
    --ddocs-on-tertiary-container: #c4eed0;
    --ddocs-warning: #E1C380;
    --ddocs-on-warning: #3F2E00;
    --ddocs-warning-container: #58440C;
    --ddocs-on-warning-container: #FFDF99;
    --ddocs-error: #f2b8b5;
    --ddocs-on-error: #601410;
    --ddocs-error-container: #8C1D18;
    --ddocs-on-error-container: #F9DEDC;
    --ddocs-background: #101417;
    --ddocs-on-background: #e3e3e3;
    --ddocs-on-background-hover: rgba(227, 227, 227, var(--ddocs-hover-state-layer-opacity)); // Just the state layer.
    --ddocs-on-background-focus: rgba(227, 227, 227, var(--ddocs-focus-state-layer-opacity));
    --ddocs-on-background-pressed: rgba(227, 227, 227, var(--ddocs-pressed-state-layer-opacity));
    --ddocs-surface-dim: #101417;
    --ddocs-surface: #1f1f1f;
    --ddocs-surface-bright: #353A3D;
    --ddocs-surface-container-lowest: #0A0F12;
    --ddocs-surface-container-low: #28282a; // or #181C20 with tone-based surfaces https://material.io/blog/tone-based-surface-color-m3
    --ddocs-surface-container: #2d2e31; // or #1C2024
    --ddocs-surface-container-high: #313336; // or #262A2E
    --ddocs-surface-container-highest: #444746; // or #313539
    --ddocs-on-surface: #e3e3e3;
    --ddocs-on-surface-disabled: color-mix(in srgb, var(--ddocs-on-surface), transparent 88%);
    --ddocs-on-surface-hover: rgba(227, 227, 227, var(--ddocs-hover-state-layer-opacity)); 
    --ddocs-on-surface-focus: rgba(227, 227, 227, var(--ddocs-focus-state-layer-opacity)); 
    --ddocs-on-surface-pressed: rgba(227, 227, 227, var(--ddocs-pressed-state-layer-opacity)); 
    --ddocs-on-surface-variant: #c4c7c5; 
    --ddocs-on-surface-variant-hover: rgba(196, 199, 197, var(--ddocs-hover-state-layer-opacity));
    --ddocs-on-surface-variant-focus: rgba(196, 199, 197, var(--ddocs-focus-state-layer-opacity));
    --ddocs-on-surface-variant-pressed: rgba(196, 199, 197, var(--ddocs-pressed-state-layer-opacity));
    --ddocs-outline: #8e918f;
    --ddocs-outline-variant: #444746;
    --ddocs-inverse-surface: #e3e3e3; // inverse colours taken from the “Signed in as” bar. Might be a relic of m2
    --ddocs-inverse-on-surface: #3c4043;
    --ddocs-inverse-on-surface-hover: #d5d6d6;
    --ddocs-inverse-on-surface-focus: #cfcfd0;
    --ddocs-inverse-on-surface-pressed: #cfcfd0;
    
    // State layers (a translucent overlay is placed over things that are hovered, focused, &c.)
    --ddocs-hover-state-layer-opacity: 8%;
    --ddocs-focus-state-layer-opacity: 12%;
    --ddocs-pressed-state-layer-opacity: 12%;
    --ddocs-dragged-state-layer-opacity: 16%;
    
    // Shape
    --ddocs-corner-none: 0rem;
    --ddocs-corner-xs: 0.25rem;
    --ddocs-corner-s: 0.5rem;
    --ddocs-corner-m: 0.75rem;
    --ddocs-corner-l: 1rem;
    --ddocs-corner-xl: 1.75rem;
    
    // Shadow
    --ddocs-level1: 0px 3px 1px -2px rgb(0 0 0 / .2), 0px 2px 2px 0px rgb(0 0 0 / .14), 0px 1px 5px 0px rgb(0 0 0 / .12);
    --ddocs-level2: 0px 2px 4px -1px rgb(0 0 0 / .2), 0px 4px 5px 0px rgb(0 0 0 / .14), 0px 1px 10px 0px rgb(0 0 0 / .12);
    --ddocs-level3: 0px 5px 5px -3px rgb(0 0 0 / .2), 0px 8px 10px 1px rgb(0 0 0 / .14), 0px 3px 14px 2px rgb(0 0 0 / .12);
    --ddocs-level4: 0px 5px 5px -3px rgb(0 0 0 / .2), 0px 8px 10px 1px rgb(0 0 0 / .14), 0px 3px 14px 2px rgb(0 0 0 / .12);
    --ddocs-level5: 0px 8px 10px -6px rgb(0 0 0 / .2), 0px 16px 24px 2px rgb(0 0 0 / .14), 0px 6px 30px 5px rgb(0 0 0 / .12);
    
    --paleblue-icons: hue-rotate(3.6deg) saturate(32.2%) brightness(170%); /* To desaturate blue icons to make them more legible against a dark background. If it is an inline SVG, changing its fill color to palerblue is preferable. */
    --palegreen-icons: hue-rotate(-2deg) saturate(38%) brightness(182%);
    --white-icons: brightness(290%) saturate(10%);
    --whiter-icons: brightness(325%);
    --darkfilter: invert(100%) hue-rotate(180deg) contrast(76%);
    --on: background-color 0.02s ease-in, border-color 0.06s ease, color 0.05s ease, filter 0.01s ease;
    --off: background-color 0.25s ease, border-color 0.15s ease, color 0.25s ease, filter 0.25s ease;
    
    // Dark Docs m2 variables (will be removed once side panels and the homepage get Material U’d)
    --palerblue: #8AB4F8; /* For blue text, icons, nearby items that need to be paleblue, and paleblue buttons on hover. */
    --paleblue: #669DF7; /* For blue buttons and other wider areas of paleblue. */
    --blue-ripple: #394457; /* Background color to indicate that something is active (toggled on or being clicked, for example). */
    --palergreen: #81C995; /* Mostly for suggesting mode. */
    --green-ripple: #37493F;
    --paleyellow: #FDD663; /* Mostly for comments. */
    --yellow-ripple: #454134;
    --lightestgray: #F8F9FA; /* For most text. */
    --lightergray: #DADCE0; 
    --lightgray: #BDC1C6; /* For subtext that gives more info, like a placeholder, an email below a name, or a description under an option. */
    --gray: #5F6368;
    --mediumdarkgray: #4A4E51; /* Hover state on menus. */
    --darkgray: #3C4043; /* Multiple purposes, like outlining dialog boxes to make them separate from what's behind them, or menus. */
    --darkergray: #303235; /* A hover state. */
    --darkestgray: #202124; /* For backgrounds. */
    
    /* Note to self: https://m3.material.io/foundations/interaction-states The state layer is an overlay with a fixed opacity for each state and uses the same color as the content. … components using the activated or selected states change the container and content color directly. 
    “The default for modern web browsers is 16px, so the conversion is SP_SIZE/16 = rem.” https://m3.material.io/styles/typography/type-scale-tokens So, 1rem = 16px font size. */
  }
  
  @keyframes ripple {
    0% {
      background-size: 0%;
    }
    100% {
      background-size: 480%;
    }
  }
}

.on-surface-icon() {
  &:not(.docs-icon-editors-ia-apps-script, .docs-icon-editors-ia-presentation-yellow, .docs-icon-editors-ia-spreadsheet-green, .docs-icon-star-filled-20-blue600) {
    filter: var(--whiter-icons);
  }
}

.on-surface-variant-icon() {
  &:not(.docs-icon-editors-ia-apps-script, .docs-icon-editors-ia-presentation-yellow, .docs-icon-editors-ia-spreadsheet-green, .docs-icon-star-filled-20-blue600) {
    filter: var(--white-icons);
  }
}

.animate-ripple() when (@ripples = 1) {
  animation: ripple 0.12s ease-in forwards;
  background-image: radial-gradient(circle, color-mix(in srgb, currentColor, transparent calc(100% + 7% - var(--ddocs-pressed-state-layer-opacity))) 50%, transparent 60%);
  background-origin: border-box;
  background-position: center;
  background-repeat: no-repeat;
}

.states(@role: "surface") {
  transition: var(--off);
  &:hover {
    transition: var(--on);
  }  
  
  & when (@role = "primary") or (@role = "primary-container") or (@role = "secondary") or (@role = "secondary-container") or (@role = "tertiary") or (@role = "tertiary-container") {
    background: var(e(%("--ddocs-%s", @role)));
    color: var(e(%("--ddocs-on-%s", @role)));
    &:is(:disabled, .jfk-button-disabled) {
      background-color: color-mix(in srgb, var(--ddocs-on-surface), transparent 88%) !important;
      color: color-mix(in srgb, var(--ddocs-on-surface), transparent 62%) !important;
    }
    &:hover {
      background-color: color-mix(in srgb, $background, $color var(--ddocs-hover-state-layer-opacity));
      color: var(e(%("--ddocs-on-%s", @role)));
    }
    &:is(:focus, .jfk-button-focused, .jfk-button-hover.jfk-button-focused) {
      background-color: color-mix(in srgb, $background, $color var(--ddocs-focus-state-layer-opacity));
      color: var(e(%("--ddocs-on-%s", @role)));
    }
    &:is(:active, .goog-toolbar-button-active, .goog-toolbar-menu-button-open, .jfk-button-active, .jfk-button-focused.jfk-button-active) {
      .animate-ripple();
      background-color: color-mix(in srgb, $background, $color var(--ddocs-pressed-state-layer-opacity));
      color: var(e(%("--ddocs-on-%s", @role)));
    }
  }
  
  & when (@role = "surface") or (@role = "surface-variant") {
    background-color: transparent;
    color: var(e(%("--ddocs-on-%s", @role)));
    &:is(.goog-flat-button-disabled, .goog-menuitem-disabled, .goog-toolbar-button-disabled) {
      background: none !important;
    }
    &:hover, 
    &.goog-menuitem-highlight{
      background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-hover-state-layer-opacity)));
      color: var(e(%("--ddocs-on-%s", @role)));
    }
    &:focus {
      background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-focus-state-layer-opacity)));
    }
    &:is(:active, .docs-titlebar-badge-selected, .goog-control-active, .goog-control-open, .goog-custom-button-active, .goog-flat-button-active, .goog-menuitem-active, .goog-toolbar-button-active, .goog-toolbar-menu-button-open, .jfk-button-active):not(.goog-submenu:not(:has(span[style*="font-family"]))):not(.goog-toolbar-button-checked) {
      .animate-ripple();
      background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-pressed-state-layer-opacity)));
      color: var(e(%("--ddocs-on-%s", @role)));
    }
  }
  
  & when (@role = "surface-container") {
    background: var(e(%("--ddocs-%s", @role)));
    color: var(--ddocs-on-surface);
    &:hover {
      background-color: color-mix(in srgb, $background, $color var(--ddocs-hover-state-layer-opacity));
    }
  }
}

@-moz-document url-prefix("https://docs.google.com/presentation/d/") {
  // Basic components
  
  // Buttons, toolbar
  body.docs-gm.docs-grille-gm3 .docs-main-toolbars :is(.goog-toolbar-button, .goog-toolbar-menu-button) {
    background: none;
    transition: var(--off);
    .states(@role: "surface-variant");
    
    &:not(.goog-toolbar-button-checked) .docs-icon {
      filter: var(--white-icons);
    }
    &.goog-toolbar-button-checked {
      .states(@role: "primary-container");
      
      & .docs-icon {
        filter: var(--ddocs-on-primary-container-icon);
      }
    }
  }
  
  // Buttons, common, filled
  .docs-grille-gm3 .docos.docs-gm .jfk-button.jfk-button-action, 
  .docs-gm .modal-dialog .goog-buttonset-action, 
  .docs-gm .modal-dialog .jfk-button-action, 
  .docs-material-button-fill-primary.docs-material-button {
    .states(@role: "primary");
    border: 1px solid transparent !important;
    border-radius: 50cqmin;
    &.jfk-button-disabled {
      background-color: var(--ddocs-on-surface-disabled);
      color: color-mix(in srgb, var(--ddocs-on-surface), transparent 62%);
    }
    &:hover {
      border: 1px solid transparent !important;
      box-shadow: none;
    }
    &:is(:focus, :hover:focus, .jfk-button-focused) { 
      border: 1px solid transparent !important;
      border-radius: 50cqmin;
      box-shadow: none;
    }
    &:active {
      box-shadow: none;
    }
  }
  .docs-material-button-fill-primary.docs-material-button /* Fancy */ .docs-material-button-ripple-element {
    background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-pressed-state-layer-opacity)));
  }
  
  // Buttons, common, outlined
  .docs-material-button-hairline-default.docs-material-button, 
  .docs-material-button-hairline-primary.docs-material-button, 
  .docs-grille-gm3 .docos.docs-gm .jfk-button.jfk-button-standard, 
  .docs-gm .modal-dialog button:not(.goog-buttonset-action), 
  .docs-gm .modal-dialog .jfk-button-standard {
    background: transparent;
    border-color: var(--ddocs-outline) !important;
    border-radius: 50cqh;
    color: var(--ddocs-primary);
    transition: var(--off);
    &:is(:hover, .jfk-button-hover) {
      background-color: var(--ddocs-primary-hover);
      border-color: var(--ddocs-outline) !important;
      color: var(--ddocs-primary);
      transition: var(--on);
    }
    &:is(:focus, .jfk-button-focused, .jfk-button-hover.jfk-button-focused) {
      background-color: var(--ddocs-primary-focus);
      border-color: var(--ddocs-primary) !important;
      border-radius: 50cqh;
      color: var(--ddocs-primary);
    }
    &.jfk-button-disabled {
      background: transparent;
      border-color: color-mix(in srgb, var(--ddocs-on-surface), transparent 88%) !important;
      color: color-mix(in srgb, var(--ddocs-on-surface), transparent 62%);
      opacity: 1;
    }
    &:not(:has(.docs-material-button-ripple-element)):is(:active, .jfk-button-active) {
      .animate-ripple();
    }
    & .docs-material-button-ripple-element {
      background-color: var(--ddocs-primary-pressed);
    }
  }
  
  // Buttons, common, text
  .docs-material-button-flat-primary {
    color: var(--ddocs-primary);
    &>.docs-material-button-ripple-element {
      background-color: var(--ddocs-primary-pressed);
    }
  }
  .docs-material-menu-button-flat-primary {
    border-radius: 50cqh;
    color: var(--ddocs-primary);
    font: 500 0.875rem Google Sans,Roboto,sans-serif;
    text-transform: capitalize;
    transition: var(--off);
    &.docs-material-menu-button-flat-primary-hover {
      background-color: var(--ddocs-primary-hover);
      transition: var(--on);
    }
    &.docs-material-menu-button-flat-primary-focused {
      background-color: var(--ddocs-primary-focus);
      border-color: transparent;
    }
    &.docs-material-menu-button-flat-primary-open {
      .animate-ripple();
      
      .docs-material-menu-button-flat-primary-dropdown {
        transform: rotate(-180deg) translateY(-2px);
      }
    }
    
    .docs-material-menu-button-flat-primary-dropdown {
      transition: transform 0.2s;
    }
    .docs-material-menu-button-flat-primary-dropdown-icon {
      opacity: 1;
      position: relative;
      top: 2px;
      
      path {
        fill: currentColor;
      }
    }
  }
  .docs-material-button /* Fancy */ {
    border-radius: 50cqh;
    font: 500 0.875rem Google Sans,Roboto,sans-serif;
    text-transform: capitalize;
    transition: var(--off);
    &.docs-material-button-hover {
      background-color: var(--ddocs-primary-hover);
    }
    &.docs-material-button-focused {
      background-color: var(--ddocs-primary-focus);
      border-color: transparent;
    }
    &.docs-material-button-active {
      color: var(--ddocs-primary);
    }
  }
  
  // Checkboxes
  .checkbox-state-layer() {
    &::after /* I’m adding a state layer */ {
      background-color: currentColor;
      border-radius: 50%;
      content: "";
      display: block;
      height: 40px;
      left: -13px;
      opacity: 0;
      position: absolute;
      top: -13px;
      transition: opacity 0.25s ease;
      width: $height;
    }
    &-hover::after {
      opacity: var(--ddocs-hover-state-layer-opacity);
      transition: opacity 0.02s ease-in;
    }
    &-focused::after {
      opacity: var(--ddocs-focus-state-layer-opacity);
    }
    &-active::after {
      opacity: var(--ddocs-pressed-state-layer-opacity);
    }
  }
  div.docs-material-gm-checkbox, 
  span.docs-material-gm-checkbox {
    border-color: currentColor !important;
    color: var(--ddocs-on-surface);
    &:not(.goog-inline-block) {
      position: relative;
      top: unset;
    }
    &.docs-material-gm-checkbox-checked, 
    &.docs-material-gm-checkbox-undetermined {
      background-color: currentColor;
      color: var(--ddocs-primary);
      
      &::before /* Checkmark */ {
        content: var(--ddocs-on-primary-checkmark);
      }
    }
    
    .checkbox-state-layer();
  }
  .jfk-checkbox {
    background: transparent;
    border: 2px solid currentColor;
    border-radius: 2px;
    box-sizing: border-box;
    color: var(--ddocs-on-surface);
    height: 1.125rem;
    width: $height;
    &-clearOutline&-focused {
      border: 2px solid currentColor;
    }
    &.jfk-checkbox-checked {
      background-color: currentColor;
      color: var(--ddocs-primary);
      
      .jfk-checkbox-checkmark {
        background-image: var(--ddocs-on-primary-checkmark);
        background-position: center;
        background-size: 15px;
        height: inherit;
        left: -2px;
        top: -2px;
        width: inherit;
      }
    }
    
    .checkbox-state-layer();
  }
  .docs-material-gm-labeled-checkbox /* Fancy */ {
    position: relative; 
    
    .docs-material-gm-labeled-checkbox-checkbox {
      border-color: var(--ddocs-on-surface);
      color: var(--ddocs-on-surface);
      &.docs-material-gm-labeled-checkbox-checked {
        background-color: var(--ddocs-primary);
        border-color: $background-color;
        color: var(--ddocs-primary);
        &::before {
          filter: invert();
        }
      }
    }
    .docs-material-gm-labeled-checkbox-circle {
      left: -10px;
      margin: unset;
      transition: var(--off);
      top: -2px;
    }
    &.docs-material-gm-labeled-checkbox-hover .docs-material-gm-labeled-checkbox-circle {
      background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-hover-state-layer-opacity)));
      opacity: 1;
      transition: var(--on);
    }
    &.docs-material-gm-labeled-checkbox-focused .docs-material-gm-labeled-checkbox-circle {
      background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-focus-state-layer-opacity)));
      opacity: 1;
    }
    .docs-material-gm-labeled-checkbox-label {
      color: var(--ddocs-on-surface);
    }
  }
  
  // Dividers
  .docs-gm .goog-menuseparator, 
  body.docs-gm.docs-grille-gm3 .docs-main-toolbars .goog-toolbar-separator {
    border-color: var(--ddocs-outline-variant);
  }
  
  // Menus
  .docs-grille-gm3 .goog-menu {
    background-color: var(--ddocs-surface-container-high);
    border: none;
    box-shadow: var(--ddocs-level2);
    color: var(--ddocs-on-surface);
    
    .goog-menuitem {
      color: currentColor;
      .states();
      
      & .goog-menuitem-content {
        color: currentColor;
      }
      &.goog-menuitem-disabled .goog-menuitem-content {
        opacity: 38%;
      }
      
      & .docs-icon-img /* Icon */ {
        .on-surface-variant-icon();
      }
      &.goog-menuitem-disabled .goog-menuitem-icon {
        filter: unset;
        .on-surface-icon();
        opacity: 38%;
      }
      
      &.apps-menuitem.goog-option-selected:not(:has(span[style*="font-weight"])) .goog-menuitem-checkbox /* Modern checkmark */ {
        filter: invert() brightness(152%);
      }
      
      & .goog-menuitem-accel /* Keyboard shortcut */, 
      & .punch-qanda-presenter-view-menu-item-description {
        color: var(--ddocs-on-surface-variant);
      }
      &.goog-menuitem-disabled .goog-menuitem-accel {
        color: var(--ddocs-on-surface-variant) !important;
        opacity: 38%;
      }

      & .goog-submenu-arrow /* Nested menu arrow */ {
        color: var(--ddocs-on-surface-variant);
        opacity: 1;
      }
      &.goog-submenu-open.goog-submenu:not(.goog-menuitem-disabled) .goog-submenu-arrow {
        color: var(--ddocs-on-surface);
        transform: translateX(5px);
        transition: color 0.3s, transform 0.3s;
      }
      &.goog-menuitem-disabled .goog-submenu-arrow {
        color: var(--ddocs-on-surface);
        opacity: 38%;
      }
    }
  }
  
  // Scrollbars
  :root {
    scrollbar-color: var(--ddocs-outline) transparent;
  }
  
  // Sliders
  // Buttons beneath slider
  .punch-toggle-slider-button-container {
    .punch-toggle-slider-button {
      color: var(--ddocs-on-surface-variant);
    }
    .punch-toggle-slider-button-selected {
      color: var(--ddocs-on-surface);
    }
  }
  
  // Text fields, message
  .docs-grille-gm3 .docos-input .docos-input-textarea {
    background-color: var(--ddocs-surface-container-highest);
    border-color: $background-color;
    caret-color: var(--ddocs-primary);
    color: var(--ddocs-on-surface);
    transition: var(--off);
    &:hover {
      border-color: var(--ddocs-on-surface-variant);
      transition: var(--on);
    }
    &:focus {
      background-color: var(--ddocs-surface-container-highest);
      color: var(--ddocs-on-surface);
    }
    &:focus-visible {
      border-color: var(--ddocs-primary);
      box-shadow: inset 0 0 0 1px $border-color;
      outline: none;
    }
    
    &.docos-input-contenteditable:empty::before /* Placeholder */ {
      color: var(--ddocs-on-surface-variant);
    }
  }
  
  // Text fields, outlined
  .docs-gm :is(.docs-material-bubble, .docs-material-gm-dialog, .modal-dialog) .jfk-textinput {
    background: transparent;
    border-color: var(--ddocs-outline);
    caret-color: var(--ddocs-primary);
    color: var(--ddocs-on-surface);
    transition: var(--off);
    &:hover {
      border-color: var(--ddocs-on-surface);
      transition: var(--on);
    }
    &:focus {
      border-color: var(--ddocs-primary);
    }
  }
  
  // Text fields, outlined, menu
  .docs-gm .modal-dialog .goog-flat-menu-button, 
  .docs-gm .docs-material-gm-dialog .goog-flat-menu-button {
    border-color: var(--ddocs-outline);
    border-radius: var(--ddocs-corner-xs);
    transition: var(--off);
    &.goog-flat-menu-button-hover {
      border: 1px solid var(--ddocs-on-surface);
      transition: var(--on);
    }
    &.goog-flat-menu-button-focused {
      border: 1px solid var(--ddocs-primary);
      box-shadow: inset 0 0 0 1px var(--ddocs-primary);
    }
    
    .goog-flat-menu-button-caption {
      color: var(--ddocs-on-surface);
    }
    .goog-flat-menu-button-dropdown {
      .on-surface-variant-icon();
      flex-shrink: 0;
      transition: 0.2s transform;
    }
    &.goog-flat-menu-button-open .goog-flat-menu-button-dropdown {
      transform: rotate(180deg);
    }
    &.docs-flatcolormenubutton .goog-flat-menu-button-caption {
      border-color: var(--ddocs-outline);
    }
  }
  .docs-material-gm-select, .docs-material-gm-labeled-select, .docs-gm-labeled-color-picker {
    color: var(--ddocs-on-surface);
    
    .docs-material-gm-select-outer-box, .docs-material-gm-labeled-select-outer-box, .docs-gm-labeled-color-picker-outer-box {
      border-color: var(--ddocs-outline);
      transition: var(--off);
      
      .docs-material-gm-select-caption, .docs-material-gm-labeled-select-caption {
        color: inherit;
      }
      .docs-color-picker-caption {
        border-color: var(--ddocs-outline);
      }
    }
    &.docs-material-gm-select-hover>.docs-material-gm-select-outer-box, 
    &.docs-material-gm-labeled-select-hover>.docs-material-gm-labeled-select-outer-box, 
    &.docs-gm-labeled-color-picker-hover .docs-gm-labeled-color-picker-outer-box {
      border-color: var(--ddocs-on-surface);
      transition: var(--on);
    }
    &.docs-material-gm-select-focused>.docs-material-gm-select-outer-box,
    &.docs-material-gm-labeled-select-focused>.docs-material-gm-labeled-select-outer-box, 
    &.docs-gm-labeled-color-picker-focused .docs-gm-labeled-color-picker-outer-box {
      border-color: var(--ddocs-primary);
      box-shadow: inset 0 0 0 1px var(--ddocs-primary);
    }
    
    .docs-material-gm-select-dropdown, .docs-color-picker-dropdown {
      transition: 0.2s transform;
      
      .docs-icon-arrow-dropdown, .docs-color-picker-dropdown-icon {
        .on-surface-variant-icon();
      }
    }
    &.docs-material-gm-select-open .docs-material-gm-select-dropdown, 
    &.docs-gm-labeled-color-picker-open .docs-color-picker-dropdown {
      transform: rotate(180deg);
    }
    .docs-material-gm-labeled-select-dropdown-icon {
      .on-surface-variant-icon();
      opacity: 80%;
      transition: 0.2s transform;
    }
  }
  .docs-material-gm-labeled-select-label, .docs-gm-labeled-color-picker-label {
    color: var(--ddocs-on-surface-variant);
  }
  
  // Tooltips, basic
  .docs-grille-gm3 .jfk-tooltip {
    background-color: var(--ddocs-inverse-surface);
    color: var(--ddocs-inverse-on-surface);
    
    & .scb-tooltip-contents, .scb-tooltip-title /* Share button tooltip */ {
      color: currentColor;
    }
  }
}

// Mixins

// Buttons, common
.common-button(@type: "filled", @role: "primary") {
  border-radius: 50cqh;
  box-shadow: none;
  &:focus {
    border-radius: 50cqh;
  }
  &.goog-inline-block:has(.jfk-button-label) {
    display: inline-grid;
    padding: 0 24px;
    place-items: center;
    &>.jfk-button-label {
      margin: 0;
    }
  }
  & when (@type = "filled") {
    box-shadow: none !important;
  }
  & when (@type = "filled") and (@role = "primary") {
    .states(@role);
  }
  & when (@type = "filled tonal") and (@role = "primary") or (@role = "secondary") {
    .states(%("%s-container", @role));
  }
  & when (@type = "outlined") {
    background: transparent;
    border-color: var(--ddocs-outline) !important;
    color: var(e(%("--ddocs-%s", @role)));
    transition: var(--off);
    &.goog-flat-button-disabled {
      background: transparent !important;
      border-color: color-mix(in srgb, var(--ddocs-on-surface), transparent 88%) !important;
      color: color-mix(in srgb, var(--ddocs-on-surface), transparent 62%);
      opacity: 1;
    }
    &:hover {
      background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-hover-state-layer-opacity)));
      transition: var(--on);
    }
    &:is(:focus, .goog-flat-menu-button-open) {
      background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-focus-state-layer-opacity)));
      border-color: currentColor !important;
    }
    &.goog-flat-button-active {
      .animate-ripple();
    }
  }
  & when (@type = "text") {
    color: var(e(%("--ddocs-%s", @role)));
    transition: var(--off);
    &:hover {
      background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-hover-state-layer-opacity)));
      transition: var(--on);
    }
    &:focus {
      background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-focus-state-layer-opacity)));
    }
    &:active {
      background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-pressed-state-layer-opacity)));
      .animate-ripple();
    }
  }
}

// Buttons, icon
.icon-button(@type: "standard"; @role: "surface-variant") {
  & when (@type = "standard") {
    & when (@role = "surface-variant") {
      color: var(--ddocs-on-surface-variant);
      .states(@role: @role);
      
      .docs-icon-img when (@role = "surface-variant") {
        .on-surface-variant-icon();
      }
    }
    
    & when (@role = "primary") {
      color: var(--ddocs-primary);
      transition: var(--off);
      &:hover {
        background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-hover-state-layer-opacity)));
        transition: var(--on);
      }
      &:focus {
        background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-focus-state-layer-opacity)));
        transition: var(--on);
      }
      &.jfk-button-active {
        .animate-ripple();
      }
      
      .docs-icon-img {
        filter: var(--ddocs-primary-icon);
      }
    }
  }
}

// Checkmark fix
.checkmark-fix() /* This is for the menus that use the older grayish non-90° checkmark */ { 
  background: none;
  &.goog-menuitem-highlight {
    background-color: var(--ddocs-on-surface-hover);
  }
  .goog-menuitem-checkbox {
    background: no-repeat url(//ssl.gstatic.com/docs/common/material_common_sprite477.svg) 0 -1056px;
    filter: invert(100%) opacity(80%);
    height: 21px;
    margin-top: -9px;
    top: 50%;
  }
  &.apps-menuitem .goog-menuitem-checkbox {
    left: -1px;
  }
}

// Sliders
.slider(@orientation: "horizontal") {
  .docs-material-slider-track-on {
    background-color: var(--ddocs-primary);
    border-color: $background-color;
    border-radius: 50cqh;
    height: if(@orientation = "horizontal", 0.25rem);
  }
  .docs-material-slider-track-off {
    background-color: var(--ddocs-surface-container-highest);
    border-color: $background-color;
    border-radius: 50cqh;
    height: if(@orientation = "horizontal", 0.25rem);
  }
  .docs-material-slider-thumb {
    .docs-material-slider-focus-ring {
      background-color: var(--ddocs-primary-focus);
      top: -14px;
    }
    .docs-material-slider-thumb-grabber {
      background-color: var(--ddocs-primary);
      border-color: $background-color;
      bottom: -11px;
      box-shadow: var(--ddocs-level1);
    }
  }
}

// Tabs
.tabs() {
  .docs-tabbar-tab {
    color: var(--ddocs-on-surface-variant);
    transition: var(--off);
  }
  .docs-tabbar-tab-selected {
    color: var(--ddocs-primary) !important;
  }
  .docs-tabbar-tab-hover {
    background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-hover-state-layer-opacity)));
    color: var(--ddocs-on-surface);
    transition: var(--on);
  }
  .docs-tabbar-tab-active {
    .animate-ripple();
    background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-pressed-state-layer-opacity)));
    color: var(--ddocs-on-surface);
  }
  
  .docs-tabbar-tablabel {
    color: inherit;
  }
  .docs-tabbar-tab-selected::before /* Selected tab’s underline */ {
    border-top-color: currentColor;
  }
}

@-moz-document url-prefix("https://docs.google.com/presentation/d/") {
  // Top area
  
  // File name
  #docs-title-widget {
    div.docs-title-input-label {
      color: var(--ddocs-on-surface);
    }
    input.docs-title-input {
      caret-color: var(--ddocs-primary);
      height: 22px;
      transition: var(--off);
      &:hover {
        border-color: var(--ddocs-outline);
        transition: var(--on);
      }
      &:focus {
        border: 1px solid var(--ddocs-primary) !important;
        box-shadow: inset 0 0 0 1px var(--ddocs-primary);
        color: var(--ddocs-on-surface);
        margin: 0;
      }
    }
  }
  
  // Star, move, status
  #docs-titlebar .docs-titlebar-badges {
    #docs-star, #docs-folder, #docs-save-indicator-badge {
      .icon-button();
      border-radius: 50cqmin;
      &:has(.docs-icon-star-filled-20-blue600) {
        .icon-button(@role: "primary");
      }
      &:has(.docs-titlebar-badge-selected) {
        background-color: var(--ddocs-on-surface-variant-pressed);
        .animate-ripple();
      }
      
      .docs-save-indicator-icon {
        background: none;
      }
    }
    .docs-save-indicator-caption /* “Saved to Drive, etc” */ {
      color: var(--ddocs-on-surface-variant);
    }
  }
  
  // Revision history, comment history, slideshow, share
  #docs-titlebar-container .docs-titlebar-buttons {
    & #docs-revisions-appbarbutton, #docs-docos-commentsbutton {
      .icon-button();
    }
    & #punch-start-presentation-left {
      .common-button(@type: "outlined");
      border-color: var(--ddocs-outline) !important;
      border-radius: 50cqh 0 0 50cqh !important;
      color: var(--ddocs-on-surface);
      
      &:hover+#punch-start-presentation-right {
        background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-hover-state-layer-opacity)));
        border-color: var(--ddocs-outline) !important;
        transition: var(--on);
      }
      &:focus {
        border-color: var(--ddocs-outline) !important;
      }
      &:focus+#punch-start-presentation-right {
        background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-focus-state-layer-opacity)));
        border-color: var(--ddocs-outline) !important;
      }
    }
    & #punch-start-presentation-right {
      .common-button(@type: "outlined");
      border-color: var(--ddocs-outline) !important;
      border-radius: 0 50cqh 50cqh 0 !important;
      color: var(--ddocs-on-surface) !important;
      
      &:focus {
        background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-focus-state-layer-opacity))) !important;
        border-color: var(--ddocs-outline) !important;
      }
      
      &>.goog-flat-menu-button-dropdown {
        border-color: var(--ddocs-on-surface-variant) transparent;
      }
    }
    & #docs-titlebar-share-client-button>.jfk-button {
      .common-button(@type: "filled tonal", @role: "secondary");
      & .apps-share-sprite {
        filter: invert() hue-rotate(180deg) brightness(95%);
      }
    }
  }
  
  // Menubar
  #docs-menubar .goog-control {
    color: var(--ddocs-on-surface);
    .states();
  }
  
  // Snackbar
  .docs-grille-gm3 .jfk-butterBar, 
  .docs-grille-gm3 .jfk-butterBar-error, 
  .docs-grille-gm3 .jfk-butterBar-info, 
  .docs-grille-gm3 .jfk-butterBar-warning {
    background-color: var(--ddocs-inverse-surface);
    color: var(--ddocs-inverse-on-surface);
  }
  
  // Toolbar
  #docs-bars #docs-toolbar-wrapper.docs-main-toolbars {
    background-color: var(--ddocs-surface-container);
    
    & .goog-toolbar-combo-button {
      background: none;
      color: var(--ddocs-on-surface);
      border-color: var(--ddocs-outline) !important;
      transition: var(--off);
      &:hover {
        border-color: var(--ddocs-on-surface-variant) !important;
        transition: var(--on);
      }
      &:focus-within {
        border: 1px solid var(--ddocs-primary) !important;
        box-shadow: inset 0 0 0 1px var(--ddocs-primary);
        margin: 0 3px;
      }
      
      & .goog-toolbar-combo-button-input {
        caret-color: var(--ddocs-primary);
        color: currentColor;
        &::selection {
          background-color: var(--ddocs-primary);
          color: var(--ddocs-on-primary);
        }
      }
    }
  }
  :is(#lineButton, #arrowButton, #bentConnectorButton, #curvedConnectorButton, #curveButton, #polygonButton, #scribbleButton) .docs-icon-img-container /* Line icon is weird */ {
    opacity: 76%;
  }
  .docs-grille-gm3 #docs-align-palette /* Text align menu */ {
    background-color: var(--ddocs-surface-container-high);
    
    & .goog-palette-table {
      border-collapse: unset;
      border-spacing: 2px;
    }
    
    & .goog-palette-cell {
      border-radius: var(--ddocs-corner-xs);
      color: var(--ddocs-on-surface);
      transition: var(--off);
      &.goog-palette-cell-hover {
        background-color: var(--ddocs-on-surface-hover);
        transition: var(--on);
      }
      &.goog-palette-cell-selected {
        background-color: var(--ddocs-primary-container);
        color: var(--ddocs-on-primary-container);
        &.goog-palette-cell-hover {
          background-color: var(--ddocs-on-primary-container-hover);
        }
      }
    }
    & .goog-palette-active .goog-palette-cell-hover {
      background-color: var(--ddocs-on-surface-pressed);
      .animate-ripple();
    }
    & .goog-palette-active .goog-palette-cell-hover.goog-palette-cell-selected {
      background-color: var(--ddocs-on-primary-container-pressed);
    }
    
    .docs-icon {
      padding: 0 2px 1px 0;
    }
    .goog-palette-cell:not(.goog-palette-cell-selected) .docs-icon-img {
      .on-surface-variant-icon();
    }
    .goog-palette-cell.goog-palette-cell-selected .docs-icon-img {
      filter: var(--ddocs-on-primary-container-icon);
    }
  }
  .docs-grille-gm3 .docs-toolbar-more-bubble /* Truncated toolbar items */ {
    background-color: var(--ddocs-surface-container);
    box-shadow: var(--ddocs-level1);
    
    .docs-toolbar-more-toolbar {
      background: none;
    }
  }
}

@-moz-document url-prefix("https://docs.google.com/presentation/d/") {
  // Main editor
  
  // Background delete
  body {
    background-color: var(--ddocs-background);
  }
  .docs-grille-gm3 #docs-chrome:not(.docs-hub-chrome), .docs-grille-gm3 #docs-header:not(.docs-hub-appbar) .docs-titlebar-buttons /* Top bar */, 
  .docs-grille-gm3 #docs-editor, .docs-grille-gm3 #docs-editor-container, .docs-grille-gm3 .filmstrip, .docs-grille-gm3 #filmstrip-controls, .docs-grille-gm3 #workspace-container, .docs-grille-gm3 #speakernotes-dragger /* Editor */ {
    background: none;
  }
  .docs-grille-gm3 .grid-view .punch-filmstrip-scroll /* Grid view */ {
    background-color: var(--ddocs-background);
  }
  .docs-grille-gm3 #docs-chrome:not(.docs-hub-chrome) {
    border-bottom-color: transparent;
  }
  
  // Filmstrip
  #filmstrip {
    & .punch-filmstrip-cursor /* Line to indicate where drag and drop slides will go */ {
      fill: var(--ddocs-primary);
    }
    
    & .punch-filmstrip-thumbnail {
      .punch-filmstrip-thumbnail-pagenumber {
        fill: var(--ddocs-on-surface);
      }
      .sketchy-page-comment-indicator-icon path, 
      .punch-filmstrip-indicator path {
        fill: var(--ddocs-on-surface-variant);
      }
      .sketchy-comment-indicator-text {
        fill: var(--ddocs-background);
      }
      & .punch-filmstrip-thumbnail-border {
        stroke: var(--ddocs-outline-variant);
        transition: stroke-width 0.1s, stroke 0.15s;
        &[style*="stroke: rgb(199, 199, 199);"] {
          stroke: var(--ddocs-outline);
        }
        &[style*="stroke: rgb(11, 87, 208);"] {
          stroke: var(--ddocs-primary) !important;
        }
      }
      & .punch-filmstrip-thumbnail-border-inner {
        stroke: var(--ddocs-background);
      }
    }
    
    & #punch-total-slide-count {
      background-color: var(--ddocs-inverse-surface);
      color: var(--ddocs-on-inverse-surface);
      opacity: 1;
    }
  }
  
  #filmstrip-controls /* Grid view, hide filmstrip buttons */ {
    #grid-view-toggle {
      .icon-button();
      
      path {
        fill: var(--ddocs-on-surface-variant);
      }
    }
    .punch-filmstrip-controls-visibility-toggle-button {
      .icon-button();
      border-radius: 50%;
      
      .punch-filmstrip-visibility-toggle-icon-container {
        background: transparent;
        
        path[fill="#444746"] {
          fill: var(--ddocs-on-surface-variant);
        }
      }
    }
  }
  .filmstrip-collapsed #filmstrip-controls :is(#filmstrip-grid-view-controls-container, #filmstrip-visibility-controls-container) {
    background-color: var(--ddocs-surface-container);
    border-radius: 50cqmin;
    
    &#filmstrip-grid-view-controls-container {
      margin-left: 1rem;
    }
    .punch-filmstrip-controls-grid-view-toggle {
      margin-left: unset;
    }
  }
  
  // Rulers
  .docs-ruler-face-number {
    color: var(--ddocs-on-surface-variant);
  }
  .docs-ruler :is(.docs-ruler-indent-first-line, .docs-ruler-indent-start, .docs-ruler-indent-end) {
    filter: var(--ddocs-primary-icon);
  }
  #sketchy-horizontal-ruler {
    background: none !important;
    border-bottom-color: var(--ddocs-outline-variant);
    
    .docs-ruler-background-inner {
      background: none;
      border-bottom-color: var(--ddocs-outline);
    }
    
    .docs-ruler-face-minor-division {
      border-left-color: var(--ddocs-outline);
    }
  }
  #sketchy-vertical-ruler {
    background: none !important;
    border-right-color: var(--ddocs-outline-variant);
    
    .docs-ruler-background-inner {
      background: none;
      border-right-color: var(--ddocs-outline);
    }
  }
  
  // Slide
  #canvas:is(.canvas-horiz-border, .canvas-vert-border) {
    background: $border-color;
    border-color: transparent;
  }
  .punch-animation-preview-pane /* When playing animations */ {
    background: transparent !important;
  }
  
  // Grid view
  .punch-filmstrip-controls-size-buttons /* Zoom buttons container */ {
    background-color: var(--ddocs-surface-container);
    
    .goog-flat-button {
      border-radius: 50cqmin;
      .states(@role: "surface-variant");
      path {
        fill: var(--ddocs-on-surface-variant);
      }
    }
  }
  
  // Comments
  .docs-grille-gm3 .docos-anchoreddocoview /* Comments */ {
    // Card
    &:not(.docos-docoview-active) {
      .states(@role: "surface-container");
    }
    &.docos-docoview-active {
      background-color: var(--ddocs-surface-container) !important;
    }
    
    // Icon buttons
    .docos-replyview-resolve-button {
      .icon-button(@role: "primary");
      border-radius: 50cqh;
    }
    .docos-docomenu-dropdown {
      .icon-button();
      
      .docos-icon-img {
        filter: invert() brightness(80%);
      }
    }
    
    // Text
    .docos-anchoredreplyview-author {
      color: var(--ddocs-on-surface);
    }
    .docos-anchoredreplyview-timestamp, 
    .docos-action-text, 
    .docos-streamdocoview-timestamp, 
    .docos-anchoredreplyview-body {
      color: var(--ddocs-on-surface-variant);
    }
    
    // Divider between comment and its replies
    .docos-anchoredreplyview {
      border-top-color: var(--ddocs-outline-variant); 
    }
    
    // Show more replies button
    .docos-showrepliesbutton-line {
      border-top-color: var(--ddocs-outline-variant);
    }
    .docos-showrepliesbutton-collapsed-internal-container {
      background-color: var(--ddocs-surface-container);
      transition: var(--off);
      
      .docos-showrepliesbutton-collapsed-internal {
        .common-button(@type: "text");
      }
    }
    &:hover .docos-showrepliesbutton-collapsed-internal-container {
      background-color: color-mix(in srgb, var(--ddocs-surface-container), var(--ddocs-on-surface) var(--ddocs-hover-state-layer-opacity));
      transition: var(--on);
    }
  }
  .docs-grille-gm3 .docos-anchoreddocoview .docos-anchoredreplyview /* Replies */, 
  .docs-grille-gm3 .docos-anchoreddocoview-input-pane /* Text box section */ {
    background: none !important;
  }
  
  // Speaker notes
  #speakernotes-container {
    #speakernotes-dragger {
      --speakernotes-dragger: var(--ddocs-outline);
      &:hover, &.speakernotes-dragger-dragging {
        background: none !important;
        --speakernotes-dragger: var(--ddocs-on-surface-variant);
      }
      & .speakernotes-dragger-thumb {
        background-color: var(--speakernotes-dragger);
      }
    }
    #speakernotes {
      background-color: var(--ddocs-surface-container-low);
      
      #speakernotes-workspace {
        background: none;
        filter: invert() hue-rotate(180deg) contrast(80%);
      }
    }
  }
}

@-moz-document url-prefix("https://docs.google.com/presentation/d/") {
  // Menus
  
  // Layouts
  .goog-palette.punch-layouts-palette {
    overflow-y: unset !important;
    padding: 0 !important;
    
    .goog-palette-cell {
      .docs-preview-palette-item {
        border-color: transparent;
        border-radius: var(--ddocs-corner-m);
        overflow: hidden;
        padding: 0;
        transition: var(--off);
      }
      &.goog-palette-cell-hover:not(.goog-palette-cell-selected) {
        .docs-preview-palette-item {
          border-color: var(--ddocs-on-surface-variant);
          transition: var(--on);
        }
      }
    }
    .goog-palette-cell-selected {
      .docs-preview-palette-item {
        border: 1px solid var(--ddocs-primary);
        margin: 1px;
        outline: 1px solid var(--ddocs-primary);
        outline-offset: -2px;
      }
      .punch-layouts-palette-label {
        background-color: transparent;
      }
    }
    &.goog-palette-active .goog-palette-cell-hover:not(.goog-palette-cell-selected) .docs-preview-palette-item {
      outline: 1px solid var(--ddocs-on-surface-variant);
      outline-offset: -2px;
    }
  }
  
  // Shape menu
  .goog-menu:has(.rectangle-icon):has(.callout-icon) .docs-icon-img-container {
    filter: brightness(2.1) saturate(0);
  }
  .goog-menu.ia-tight-menu .shape-palette {
    .goog-palette-cell {
      border-radius: 50cqmin;
      outline: 6px solid transparent;
      transition: var(--off), outline 0.25s ease;
    }
    .goog-palette-cell-hover {
      background: var(--ddocs-on-surface-hover);
      outline: 6px solid $background;
      transition: var(--on), outline 0.02s ease-in;
    }
    &.goog-palette-active .goog-palette-cell-hover {
      background: var(--ddocs-on-surface-pressed);
      outline: 6px solid $background;
    }
    .shape-icon {
      filter: contrast(50%) sepia() invert() hue-rotate(-23deg) saturate(9%) brightness(1.5);
    }
  }
  
  // Line menu
  .goog-menu:has(.sketchy-icon-line):has(.sketchy-icon-scribble) .docs-icon-img-container {
    filter: brightness(1.75) saturate(.5);
  }
  
  // Apply checkmark fix
  body.docs-grille-gm3 {
    .goog-menu {
      & .goog-option-selected {
        .checkmark-fix();
        & .goog-menuitem-checkbox {
          left: 9px;
        }
      }
    }
  }
}

@-moz-document url-prefix("https://docs.google.com/presentation/d/") {
  // Dialogs
  .docs-gm .modal-dialog, .docs-material-gm-dialog {
    background: var(--ddocs-surface-container);
    box-shadow: var(--ddocs-level3);
    border: none;
    border-radius: var(--ddocs-corner-xl);
    color: var(--ddocs-on-surface);
    
    // Titlebar
    .modal-dialog-title, .docs-material-gm-dialog-title-text {
      background: transparent;
      color: inherit;
    }
    .modal-dialog-title-text {
      color: inherit;
    }
    .modal-dialog-title-close {
      .states();
      opacity: 1;
      
      &::after {
        filter: invert(90%);
      }
    }
    .docs-material-gm-dialog-title-close {
      .icon-button();
      box-sizing: border-box;
      height: 2rem;
      padding: 0.25rem;
      top: 22px;
      width: 2rem;
    }
    
    // Content
    .modal-dialog-content, .docs-material-gm-dialog-content {
      background: transparent;
      color: inherit;
      
      a {
        color: var(--ddocs-primary);
      }
    }
  }
  
  // Custom dialog things
  .docs-grille-gm3 .modal-dialog {
    .punch-bg-options-content {
      color: inherit;
    }

    .docs-copydocdialog-appsscript-button, 
    .docs-copydocdialog-destination-button /* Copy document file location fields */ {
      border-color: var(--ddocs-outline);
      border-radius: var(--ddocs-corner-xs);
      transition: var(--off);
      &.jfk-button-hover {
        border-color: var(--ddocs-on-surface);
        box-shadow: none;
        transition: var(--on);
      }
      &.jfk-button-clear-outline /* Corresponds to when the file picker is open */ {
        border-color: var(--ddocs-primary);
        box-shadow: inset 0 0 0 1px var(--ddocs-primary);
      }
      
      :is(.docs-copydocdialog-appsscript-icon, .docs-copydocdialog-openinnew-icon) path {
        fill: var(--ddocs-on-surface-variant);
      }
      span {
        font: 400 0.875rem Roboto,RobotoDraft,Helvetica,Arial,sans-serif;
      }
    }
    .docs-copydocdialog-appsscript-warning /* Copy document appscript file will also be copied */ {
      background-color: var(--ddocs-warning-container);
      color: var(--ddocs-on-warning-container);
      
      path {
        fill: currentColor;
      }
      .docs-copydocdialog-appsscript-warning-msg {
        color: inherit;
      }
    }
    
    // Publish to the web
    .pub-dialog-content {
      .pub-dialog-info {
        color: var(--ddocs-on-surface-variant);
        
        &.pub-dialog-state-published {
          color: var(--ddocs-primary);
        }
      }
      .pub-dialog-tab-bar {
        border-bottom-color: var(--ddocs-outline-variant) !important;
        
        .goog-tab.pub-dialog-tab {
          border: none !important;
          color: var(--ddocs-on-surface-variant);
          height: 100%;
          transition: var(--off);
          &.goog-tab-selected {
            color: var(--ddocs-primary) !important;
          }
          &.goog-tab-hover {
            background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-hover-state-layer-opacity))) !important;
            color: var(--ddocs-on-surface);
            transition: var(--on);
          }
          &.goog-tab-active {
            background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-pressed-state-layer-opacity))) !important;
            .animate-ripple();
          }
          &.goog-tab-selected::after {
            border-radius: 3px 3px 0 0;
            border-top: 3px solid var(--ddocs-primary);
            bottom: 0;
            content: "";
            display: block;
            position: absolute;
            width: inherit;
          }
        }
      }
      .pub-dialog-sep {
        border-top-color: var(--ddocs-outline-variant);
      }
      .pub-dialog-zippy-header {
        color: var(--ddocs-on-surface);
        
        .pub-dialog-settings-zippy-icon {
          filter: invert() opacity(.8);
        }
      }
      #pub-dialog-publish-button:not(.jfk-button-disabled) {
        color: var(--ddocs-primary);
      }
    }
    
    // Document details
    &.docs-details-dialog {
      .docs-details-field {
        color: var(--ddocs-on-surface-variant);
      }
      .docs-details-value {
        color: var(--ddocs-on-surface);
      }
      .docs-icon-folder {
        filter: var(--white-icons);
      }
    }
    
    // Find & replace
    &.docs-findandreplacedialog .docs-findinput-container /* Find field */ {
      background: none;
      border-color: var(--ddocs-outline);
      transition: var(--off);
      &:hover {
        border-color: var(--ddocs-on-surface);
        transition: var(--on);
      }
      &.docs-findinput-container-focus {
        border-color: var(--ddocs-primary);
      }
      
      .docs-findinput-input {
        caret-color: var(--ddocs-primary);
        color: var(--ddocs-on-surface);
      }
      .docs-findinput-count {
        color: var(--ddocs-on-surface-variant);
      }
    }
    
    // Edit guides (layout)
    .sketchy-editguidesdialog {
      .sketchy-editguidesdialog-tab-bar /* I wish Google Docs had just one standard tab bar so I wouldn’t need to make bespoke CSS for each tab bar */ {
        .sketchy-editguidesdialog-tab {
          border-bottom-color: transparent;
          color: var(--ddocs-on-surface-variant);
          transition: var(--off);
          &.goog-tab-hover {
            background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-hover-state-layer-opacity)));
            color: var(--ddocs-on-surface);
            transition: var(--on);
          }
          &.goog-tab-active {
            background-color: color-mix(in srgb, currentColor, transparent calc(100% - var(--ddocs-pressed-state-layer-opacity)));
            color: var(--ddocs-on-surface);
            .animate-ripple();
          }
          &.goog-tab-selected {
            border-bottom-color: currentColor;
            color: var(--ddocs-primary);
          }
        }
      }
      .sketchy-guideslist {
        background: none;
        border-color: var(--ddocs-outline-variant);
        
        .sketchy-guiderow-unit {
          color: var(--ddocs-on-surface-variant);
        }
        .sketchy-guiderow-deletebutton {
          .icon-button();
          border-radius: 50cqmin;
          display: inline-grid;
          height: 2rem;
          place-items: center;
          width: $height;
          
          .goog-flat-button-outer-box {
            padding-left: 1px;
          }
        }
      }
    }
    
    &.docs-preferencesdialog-modal {
      .docs-preferencesdialog-tabbed-menu-tabbar {
        .tabs();
      }
      .docs-preferencesdialog-control .docs-material-gm-checkbox-focused::after /* Preferences dialog implements checkbox state layers in a way that conflicts with how I do it */ {
        background-color: currentColor;
        left: -13px;
        top: -13px;
      }
      .docs-preferencesdialog-subtext, 
      .sketchy-preferencesdialog-auto-fit-label {
        color: var(--ddocs-on-surface);
      }
      .docs-icon-info {
        .on-surface-variant-icon();
      }
      .docs-preferencesdialog-list-title {
        color: var(--ddocs-on-surface-variant);
      }
      .docs-preferencesdialog-list-body {
        background: none;
        border-color: var(--ddocs-outline-variant);
      }
      .docs-preferencesdialog-row .goog-flat-button {
        .icon-button();
        border-radius: 50cqmin;
        height: 32px;
        width: $height;
        &[style*="display: inline;"] {
          display: inline-block !important;
        }
        
        .docs-icon {
          background-image: url("https://www.gstatic.com/images/icons/material/system_gm/2x/clear_white_18dp.png");
          background-position: center;
          background-repeat: no-repeat;
          background-size: 18px;
          height: 32px;
          margin: 0;
          width: $height;
        }
        .docs-icon-img-container {
          display: none;
        }
      }
    }
  }
}
@-moz-document url-prefix("https://docs.google.com/presentation/d/") {
  // Sidebars
  
  // Basic components
  
  // Buttons, icon, titlebar
  .docs-sidebar-gm-titlebar-icon-button {
    .icon-button();
  }
  
  // Collapsible sections
  .punch-sidebar-tile-chevron .docs-icon-img {
    .on-surface-variant-icon();
  }
  .punch-sidebar-tile-header-text, 
  .punch-sidebar-tile-header-subtext {
    color: var(--ddocs-on-surface);
  }
  
  // Text fields
  .punch-sidebar-tile-type-select {
    background: transparent;
  }
  
  // Diagrams sidebar
  .docs-grille-gm3 .sketchy-diagrams-sidebar {
    background: var(--ddocs-surface-container);
    
    .sketchy-diagrams-sidebar-title {
      background: var(--ddocs-surface-container);
      border: none;
      color: var(--ddocs-on-surface);
      transition: 0.1s background;
      &.sketchy-diagrams-sidebar-title-shadow, 
      &:has(+.sketchy-diagrams-sidebar-content .sketchy-diagrams-thumbnail-select:not([style="display: none;"])>.sketchy-diagrams-thumbnail-select-shadow) {
        background: var(--ddocs-surface-container-high);
        box-shadow: none;
      }
      
      .sketchy-diagrams-sidebar-title-icon g[fill="#F9AB00"] {
        fill: var(--ddocs-primary);
      }
      .sketchy-diagrams-sidebar-title-back-icon {
        .icon-button();
        border-radius: 50cqmin;
        display: grid;
        height: 2rem;
        left: -5px;
        margin-right: 12px;
        place-items: center;
        position: relative;
        width: $height;
        
        .docs-icon {
          margin: 0;
          padding: 0 3px 3px 0;
        }
      }
    }
    
    .sketchy-diagrams-sidebar-content {
      background: none;
      
      // Select category
      .sketchy-diagrams-sidebar-categories {
        scrollbar-gutter: stable both-edges;
        
        .sketchy-diagrams-category-button {
          border-color: var(--ddocs-outline);
          border-radius: var(--ddocs-corner-m);
          color: var(--ddocs-on-surface);
          margin: 0 auto 1rem;
          transition: var(--off);
          
          .sketchy-diagrams-category-button-thumbnail {
            border-color: transparent;
          }
          .sketchy-diagrams-category-button-heading {
            background-color: color-mix(in srgb, var(--ddocs-surface-container), transparent 12%);
            backdrop-filter: blur(4px);
            border-radius: 0 0 var(--ddocs-corner-m) var(--ddocs-corner-m);
            transition: var(--off);
            
            .sketchy-diagrams-category-button-next-icon {
              opacity: 1;
              
              .docs-icon-next {
                .on-surface-variant-icon();
              }
            }
          }
          &:hover {
            background-color: var(--ddocs-on-surface-hover);
            box-shadow: none;
            transition: var(--on);
            
            .sketchy-diagrams-category-button-heading {
              background-color: color-mix(in srgb, #2c2f33, transparent 12%);
              transition: var(--on);
            }
          }
          &:focus {
            background-color: var(--ddocs-on-surface-focus);
            
            .sketchy-diagrams-category-button-heading {
              background-color: color-mix(in srgb, #35383c, transparent 12%);
            }
          }
        }
      }
      
      // Select chart design
      .sketchy-diagrams-thumbnail-select-toolbar {
        background-color: var(--ddocs-surface-container);
        border: none;
        transition: 0.1s background-color;
        
        &.sketchy-diagrams-thumbnail-select-shadow {
          background-color: var(--ddocs-surface-container-high);
          box-shadow: none;
        }
      }
      .sketchy-diagrams-thumbnail-select-scroll {
        scrollbar-gutter: stable both-edges;
        top: 146px;
        
        .docs-thumbnailcontainer-horizontal {
          margin: 0 auto;
          padding-top: unset;
          width: min-content;
          
          .docs-gm-thumbnailcontrol {
            margin: .5rem 0;
            padding: 0;
          }
          
          .docs-thumbnailcontrol-thumbnailcontainer {
            border: 1px solid var(--ddocs-outline);
            border-radius: var(--ddocs-corner-m);
            color: var(--ddocs-on-surface-variant);
            overflow: hidden;
            transition: var(--off);
          }
          .docs-gm-thumbnailcontrol-hover .docs-thumbnailcontrol-thumbnailcontainer {
            background-color: var(--ddocs-on-surface-hover);
            box-shadow: none;
            transition: var(--on);
          }
          .docs-gm-thumbnailcontrol-focused .docs-thumbnailcontrol-thumbnailcontainer {
            background-color: var(--ddocs-on-surface-focus);
          }
          .docs-gm-thumbnailcontrol-active .docs-thumbnailcontrol-thumbnailcontainer {
            background-color: var(--ddocs-on-surface-pressed);
            .animate-ripple();
          }
        }
      }
    }
  }
  
  // Extension sidebar
  .docs-grille-gm3 :is(.addon-sidebar, .script-application-sidebar) {
    background-color: var(--ddocs-surface-container);
    border-left: none;
    border-radius: 16px;
    height: calc(100vh - 65px - 16px) !important;
    overflow: hidden;
    top: 65px !important;
    
    .addon-sidebar-header,
    .script-application-sidebar-header {
      align-items: center;
      background-color: var(--ddocs-surface-container);
      border: none;
      color: var(--ddocs-on-surface);
      display: flex;
      font: 500 16px Google Sans,Roboto,RobotoDraft,Helvetica,Arial,sans-serif;
      height: 56px;
      justify-content: space-between;
      padding: 0 16px;
      
      .addon-sidebar-close,
      .script-application-sidebar-close {
        .icon-button();
        border-radius: 50%;
        height: 32px;
        position: relative;
        right: -7px;
        top: unset;
        width: $height;
        
        .docs-icon {
          margin: 7px;
          user-select: none;
        }
      }
    }
    
    .addon-sidebar-content {
      background-color: var(--ddocs-surface-container-low);
      color: var(--ddocs-on-surface);
      
      .addon-sidebar-card {
        border-bottom-color: var(--ddocs-outline-variant);
        &:last-of-type {
          border-bottom: none;
        }
      }
      .addon-sidebar-card-title-caption {
        color: inherit;
        max-width: 200px;
        white-space: unset;
      }
      .addon-sidebar-card-category, 
      .addon-sidebar-card-summary {
        color: var(--ddocs-on-surface-variant);
      }
      .addon-sidebar-card-check svg {
        fill: var(--ddocs-tertiary);
      }
    }    
    .script-application-sidebar-content {
      top: 56px;
    }
  }
  body.docs-grille-gm3:has(#viewModeButton .docs-icon-expand-more-20) :is(.addon-sidebar, .script-application-sidebar) {
    height: calc(100vh - 6px - 16px) !important;
    top: 6px !important;
  }
  
  // Motion sidebar
  .docs-gm .motion-ui.punch-animation-sidebar {
    background-color: var(--ddocs-surface-container);
    color: var(--ddocs-on-surface);
    
    .punch-animation-sidebar-header {
      background-color: var(--ddocs-surface-container);
      border-bottom-color: var(--ddocs-outline-variant);
      color: var(--ddocs-on-surface);
      
      .docs-gm-sidebar-icon {
        g[fill="#f9ab00"] {
          fill: var(--ddocs-primary);
        }
        circle[fill="#FFF"] {
          fill: var(--ddocs-surface-container);
        }
      }
    }
    
    .punch-animation-sidebar-transition-header,
    .punch-animation-sidebar-animation-header, 
    .punch-sidebar-tile-options {
      background: transparent;
    }
    
    .punch-transition-tile .punch-sidebar-tile-thumbnail path[fill="#80868b"] {
      fill: var(--ddocs-on-surface-variant);
    }
    
    .punch-sidebar-tile-duration {
      .docs-material-slider {
        .slider();
      }
      &.punch-toggle-slider-disabled {
        filter: saturate(0) opacity(38%);
      }
    }
    
    .punch-animation-sidebar-tile-container, 
    .punch-animation-sidebar-controls, 
    .punch-sidebar-tile-header {
      background: var(--ddocs-surface-container);
      border-top-color: var(--ddocs-outline-variant);
    }
    
    .punch-sidebar-tile-delete .docs-icon-delete-grey600-24 /* Delete animation garbage can */ {
      filter: var(--white-icons);
    }
    
    .punch-animation-sidebar-add-section {
      border-bottom-color: var(--ddocs-outline-variant);
      
      .punch-animation-sidebar-add /* + Add animation */ {
        .common-button(@type: "outlined");
        border-radius: var(--ddocs-corner-s) !important;
        
        .punch-animation-sidebar-add-icon path[fill="#f29900"] {
          fill: currentColor;
        }
      }
    }
    
    // Playhead
    .punch-animation-sidebar-playhead {
      filter: hue-rotate(106deg) saturate(49%) brightness(87.5%);
    }
    
    // Play/Stop button
    .punch-animation-sidebar-play, .punch-animation-sidebar-stop {
      .common-button();
    }
  }
  
  // Themes sidebar
  .docs-gm .punch-theme-sidebar {
    background-color: var(--ddocs-surface-container);
    
    &>.punch-theme-sidebar-header {
      background-color: var(--ddocs-surface-container);
      border-bottom-color: var(--ddocs-outline-variant);
      color: var(--ddocs-on-surface);
      
      & g[fill="#F9AB00"] {
        fill: var(--ddocs-primary);
      }
    }
    
    & .punch-theme-sidebar-in-presentation-header {
      background-color: transparent;
      color: var(--ddocs-on-surface);
      border-bottom-color: var(--ddocs-outline-variant);
      transition: var(--off);
      &:hover {
        background-color: color-mix(in srgb, var(--ddocs-on-surface), transparent calc(100% - var(--ddocs-hover-state-layer-opacity)));
        transition: var(--on);
      }
      &:focus {
        background-color: color-mix(in srgb, var(--ddocs-on-surface), transparent calc(100% - var(--ddocs-focus-state-layer-opacity)));
        transition: background-color 0.5s;
      }
      &.goog-zippy-expanded {
        background-color: var(--ddocs-surface-container-highest);
        &:hover {
          background-color: color-mix(in srgb, var(--ddocs-surface-container-highest), var(--ddocs-on-surface) var(--ddocs-hover-state-layer-opacity));
        }
        &:focus {
          background-color: color-mix(in srgb, var(--ddocs-surface-container-highest), var(--ddocs-on-surface) var(--ddocs-focus-state-layer-opacity));
          transition: background-color 0.5s;
        }
      }
      & :is(.punch-theme-sidebar-arrow-collapsed, .punch-theme-sidebar-arrow-expanded) .docs-icon-img {
        filter: var(--white-icons);
      }
      
      &+div {
        &>.punch-theme-sidebar-in-presentation-content {
          background-color: transparent;
          transition: background-color 0.5s;
        }
        &>.punch-theme-sidebar-in-presentation-content:not([style*="margin-top: -186px;"]) {
          background-color: var(--ddocs-surface-container-highest);
        }
      }
    }
    
    & .docs-thumbnailcontainer {
      text-align: center;
    }
    
    & .docs-gm-thumbnailcontrol /* Theme thumbnails */ {
      text-align: left;
      & .docs-thumbnailcontrol-thumbnailcontainer {
        border-color: var(--ddocs-outline-variant);
        transition: var(--off);
      }
      &.docs-gm-thumbnailcontrol-hover .docs-thumbnailcontrol-thumbnailcontainer {
        border-color: var(--ddocs-outline);
        transition: var(--on);
      }
      &.docs-gm-thumbnailcontrol-focused .docs-thumbnailcontrol-thumbnailcontainer {
        border-color: var(--ddocs-primary);
        transition: var(--on);
      }
      
      &>.docs-thumbnailcontrol-title {
        color: var(--ddocs-on-surface);
      }
    }
    
    & .punch-theme-sidebar-import-theme {
      border-top-color: var(--ddocs-outline-variant);
      
      & .jfk-button {
        .common-button(@type: "filled tonal"; @role: "secondary");
      }
    }
  }
}
